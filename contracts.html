<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK • Contract</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #ffffff;
    --panel: #ffffff;
    --ink: #1a1a1a;
    --muted:#6b7280;
    --gold:#c9a227; /* warm gold */
    --gold-deep:#a98813;
    --line:#e5e7eb;
    --chip:#111;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  .wrap{max-width:980px;margin:24px auto;padding:16px}
  .card{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.06);
    margin-bottom:16px;
    overflow:hidden;
  }
  .header{
    display:flex;gap:16px;align-items:center;justify-content:space-between;
    padding:16px;
    background: #111; /* black banner */
    color:#fff;
    border:1px solid rgba(255,255,255,.06);
    border-radius:16px;
  }
  .brand{
    display:flex;align-items:center;gap:16px;min-width:0;
  }
  .brand img{
    width:84px;height:84px;object-fit:cover;border-radius:12px; /* no outline, no fade */
    display:block; background:#fff;
  }
  .brand .addr{
    line-height:1.2;
    font-weight:700;
    color:#fff;
  }
  .brand .addr small{display:block;font-weight:600;color:#ddd;margin-top:4px}
  .actions{display:flex;gap:12px;flex-wrap:wrap}
  button.btn{
    appearance:none;border:0;cursor:pointer;
    padding:12px 18px;border-radius:12px;font-weight:700;
  }
  .btn-gold{background:var(--gold);color:#111}
  .btn-gold:active{transform:translateY(1px)}
  .btn-dark{background:#2b2b2b;color:#fff}

  .section{padding:16px 16px 8px}
  .section h2{
    margin:0 0 12px;font-size:22px;letter-spacing:.2px;
    font-weight:800;color:var(--gold);
  }

  .grid{
    display:grid;gap:12px;
    grid-template-columns:1fr;
  }
  @media(min-width:680px){
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
  }
  label{font-size:13px;color:var(--muted);font-weight:600}
  input,textarea,select{
    width:100%;padding:14px 12px;border:1px solid var(--line);
    border-radius:12px;background:#fff;font:inherit;color:var(--ink);
  }
  textarea{min-height:110px;resize:vertical}

  .table{width:100%;border-collapse:separate;border-spacing:0 8px}
  .table th{font-size:12px;color:var(--muted);text-align:left;font-weight:700;padding:0 8px 4px}
  .table td{padding:0 8px}
  .pill{
    display:inline-flex;align-items:center;gap:10px;
    padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff
  }
  .inline{display:flex;align-items:center;gap:10px;margin:8px 0}
  .totals{
    border-top:2px solid #111; margin-top:10px; padding-top:12px;
  }
  .totals .row{display:flex;justify-content:space-between;margin:6px 0}
  .totals .grand{font-size:22px;font-weight:800;color:var(--gold)}
  .chip{
    background:var(--chip);color:#fff;border-radius:999px;padding:6px 10px;font-size:12px
  }

  /* T&Cs + Waiver */
  .tcs{padding:16px}
  .tcs h3{margin:0 0 8px;font-size:18px;color:var(--ink)}
  .tcs ol{margin:8px 0 0 18px;padding:0}
  .tcs li{margin:4px 0}
  .waiver{padding:16px;border:1px solid #f0d2d2;border-radius:12px;background:#fff}
  .waiver.flash{animation:flash 0.6s ease-in-out 10;} /* 0.6s * 10 = 6s */
  @keyframes flash{
    0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,0);background:#fff}
    50%{box-shadow:0 0 0 4px rgba(220,38,38,.35);background:#ffe5e5}
  }
  .waiver .box{
    border:2px solid #dc2626;border-radius:10px;padding:12px;background:#fff;color:#111
  }

  /* Signatures */
  .sigs{display:grid;gap:16px}
  @media(min-width:680px){ .sigs{grid-template-columns:1fr 1fr} }
  .sig{
    border:1px dashed #c7c7c7;border-radius:12px;padding:8px;background:#fafafa;
    page-break-inside: avoid; break-inside: avoid; /* keep on same PDF page */
  }
  .sig canvas{width:100%;height:180px;border-radius:8px;background:#fff;display:block}
  .sig .meta{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
  .small{font-size:12px;color:var(--muted)}

  /* Ensure blocks don’t split across pages in PDF */
  .no-split{page-break-inside: avoid; break-inside: avoid}

  /* Footer */
  .foot{text-align:center;color:#9ca3af;font-size:12px;margin:24px 0}
</style>
</head>
<body>
<div class="wrap" id="contractRoot">
  <!-- Header / Brand -->
  <div class="header no-split">
    <div class="brand">
      <img src="./warmupuklogo.jpg" alt="Warm Up UK logo" id="brandLogo">
      <div class="addr">
        <div>321–323 Romford High Road,<br>Essex, RM6 6AX</div>
        <small>Office: 01708 300670</small>
      </div>
    </div>
    <div class="actions">
      <button id="btnPdf" class="btn btn-gold">Generate PDF</button>
      <button id="btnReset" class="btn btn-dark">Reset Form</button>
    </div>
  </div>

  <!-- Customer -->
  <div class="card section">
    <h2>Customer</h2>
    <div class="grid grid-2">
      <div><label>Customer Name</label><input id="custName" placeholder="Full name"></div>
      <div><label>Phone (WhatsApp)</label><input id="custPhone" placeholder="07..."></div>
      <div><label>Email</label><input id="custEmail" placeholder="name@email.com"></div>
      <div><label>Install / Survey Date</label><input id="date" type="date"></div>
      <div><label>Address Line 1</label><input id="addr1" placeholder="Street & number"></div>
      <div><label>Town / City</label><input id="town" placeholder="Town / City"></div>
      <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX"></div>
      <div><label>Order Notes (optional)</label><input id="notes" placeholder="Special instructions / access, preferred days, etc."></div>
    </div>
  </div>

  <!-- Products & Pricing -->
  <div class="card section no-split" id="pricingCard">
    <h2>Products &amp; Pricing</h2>

    <table class="table" id="linesTbl">
      <thead>
        <tr>
          <th style="width:36%">ITEM</th>
          <th style="width:18%">m²</th>
          <th style="width:18%">£ / UNIT</th>
          <th style="width:18%">LINE TOTAL (£)</th>
          <th style="width:10%"></th>
        </tr>
      </thead>
      <tbody id="bodyLines"></tbody>
    </table>

    <div class="inline">
      <button class="btn btn-dark" id="addLine">+ Add line</button>
      <span class="pill">
        <input id="incAdmin" type="checkbox" checked>
        <label for="incAdmin">Include admin fee (£150)</label>
      </span>
      <span class="pill">
        <input id="incVat" type="checkbox">
        <label for="incVat">Add VAT (20%)</label>
      </span>
    </div>

    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subTot">£0.00</span></div>
      <div class="row"><span>Admin Fee</span><span id="adminFee">£150.00</span></div>
      <div class="row"><span>VAT</span><span id="vatVal">£0.00</span></div>
      <div class="row grand"><span>Total</span><span id="grandTotal">£150.00</span></div>
      <div class="small">All prices in GBP. Figures auto-update.</div>
    </div>
  </div>

  <!-- Terms & Conditions -->
  <div class="card tcs no-split" id="tcsBlock">
    <h2>Terms &amp; Conditions (Summary)</h2>
    <ol>
      <li>All quotes are valid for 30 days unless stated otherwise.</li>
      <li>Access to the work area, clear of personal belongings, is required.</li>
      <li>Balance due on completion unless a different schedule is agreed in writing.</li>
      <li>Manufacturer warranties apply to materials; workmanship guaranteed 12 months.</li>
      <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
    </ol>
  </div>

  <!-- Waiver -->
  <div class="card section no-split" id="waiverCard">
    <h2>Express Waiver (Optional)</h2>
    <label class="inline" style="margin-top:-4px">
      <input type="checkbox" id="waiverTick">
      <span>I accept the Express Waiver</span>
    </label>
    <div class="waiver" id="waiverPanel">
      <div class="box">
        By selecting the <strong>Express Waiver</strong>, I request works to commence at my
        property without the standard cooling-off period. I acknowledge that once works begin,
        I may be liable for reasonable costs if I later cancel.
      </div>
    </div>
  </div>

  <!-- Signatures -->
  <div class="card section no-split" id="sigSection">
    <h2>Signatures</h2>
    <div class="sigs">
      <div class="sig">
        <div class="small">Customer Signature</div>
        <canvas id="sigCustomer"></canvas>
        <div class="meta">
          <button class="btn btn-dark" data-clear="sigCustomer">Clear</button>
          <span class="small">Sign with your finger</span>
        </div>
      </div>
      <div class="sig">
        <div class="small">Company Signature</div>
        <canvas id="sigCompany"></canvas>
        <div class="meta">
          <button class="btn btn-dark" data-clear="sigCompany">Clear</button>
          <span class="small">Sign with your finger</span>
        </div>
      </div>
    </div>
  </div>

  <div class="foot">© Warm Up UK</div>
</div>

<!-- libs: signature pad + html2pdf -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.2.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<script>
(function(){
  // ---------- helpers ----------
  const fmt = v => "£" + (Math.round(v*100)/100).toFixed(2);
  const qs = s => document.querySelector(s);

  // ---------- dynamic lines ----------
  const body = qs('#bodyLines');
  const addLineBtn = qs('#addLine');
  function addLine(item="", m2=0, unit=0){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="line-item" placeholder="Item" value="${item}"></td>
      <td><input type="number" step="0.01" min="0" class="line-m2" value="${m2}"></td>
      <td><input type="number" step="0.01" min="0" class="line-unit" value="${unit}"></td>
      <td class="line-total">0.00</td>
      <td><button class="btn btn-dark btn-remove" title="Remove">×</button></td>
    `;
    body.appendChild(tr);
    bindRow(tr);
    recalc();
  }
  function bindRow(tr){
    tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', recalc));
    tr.querySelector('.btn-remove').addEventListener('click', () => { tr.remove(); recalc();});
  }
  addLineBtn.addEventListener('click', ()=>addLine());

  // seed one row
  addLine();

  // ---------- totals ----------
  const incAdmin = qs('#incAdmin');
  const incVat   = qs('#incVat');
  const subEl    = qs('#subTot');
  const adminEl  = qs('#adminFee');
  const vatEl    = qs('#vatVal');
  const grandEl  = qs('#grandTotal');

  [incAdmin,incVat].forEach(cb=>cb.addEventListener('change', recalc));

  function recalc(){
    let subtotal = 0;
    body.querySelectorAll('tr').forEach(tr=>{
      const m2   = parseFloat(tr.querySelector('.line-m2').value || 0);
      const unit = parseFloat(tr.querySelector('.line-unit').value || 0);
      const line = m2 * unit;
      subtotal += line;
      tr.querySelector('.line-total').textContent = (Math.round(line*100)/100).toFixed(2);
    });

    const admin = incAdmin.checked ? 150 : 0;
    const beforeVat = subtotal + admin;
    const vat = incVat.checked ? beforeVat * 0.20 : 0;
    const grand = beforeVat + vat;

    subEl.textContent   = fmt(subtotal);
    adminEl.textContent = fmt(admin);
    vatEl.textContent   = fmt(vat);
    grandEl.textContent = fmt(grand);
  }

  // ---------- waiver flash ----------
  const waiverTick  = qs('#waiverTick');
  const waiverPanel = qs('#waiverPanel');
  waiverTick.addEventListener('change', ()=>{
    waiverPanel.classList.remove('flash');
    if(waiverTick.checked){
      // trigger reflow then animate
      void waiverPanel.offsetWidth;
      waiverPanel.classList.add('flash');
    }
  });

  // ---------- signatures ----------
  const sigPadCustomer = new SignaturePad(document.getElementById('sigCustomer'), {minWidth:1,maxWidth:2,penColor:"#111"});
  const sigPadCompany  = new SignaturePad(document.getElementById('sigCompany'),  {minWidth:1,maxWidth:2,penColor:"#111"});
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-clear');
      const pad = id==="sigCustomer" ? sigPadCustomer : sigPadCompany;
      pad.clear();
    });
  });

  // ---------- reset ----------
  qs('#btnReset').addEventListener('click', ()=>{
    document.querySelectorAll('input').forEach(i=>{
      if(i.type==='checkbox'){ i.checked = (i.id==='incAdmin'); }
      else if(i.type==='date'){ i.value = ""; }
      else { i.value = ""; }
    });
    // remove extra rows
    body.innerHTML = "";
    addLine();
    sigPadCustomer.clear(); sigPadCompany.clear();
    recalc();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  // ---------- PDF ----------
  qs('#btnPdf').addEventListener('click', async ()=>{
    // ensure totals up to date
    recalc();

    // temporarily render signatures as images so html2pdf captures them crisply
    const sigImgs = [];
    [['sigCustomer', sigPadCustomer], ['sigCompany', sigPadCompany]].forEach(([id,pad])=>{
      if(!pad.isEmpty()){
        const img = new Image();
        img.src = pad.toDataURL('image/png');
        const canvas = document.getElementById(id);
        img.style.width = canvas.clientWidth+"px";
        img.style.height = canvas.clientHeight+"px";
        canvas.style.display = "none";
        canvas.parentNode.insertBefore(img, canvas.nextSibling);
        sigImgs.push({canvas, img});
      }
    });

    const opt = {
      margin: [10,10,10,10],
      filename: `WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`,
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak: { mode: ['css','legacy'] }
    };
    await html2pdf().set(opt).from(document.getElementById('contractRoot')).save();

    // restore canvases
    sigImgs.forEach(({canvas,img})=>{ img.remove(); canvas.style.display="block"; });
  });

  // mobile safari helper: prevent page split for signatures (runtime height lock)
  function lockSigHeights(){
    document.querySelectorAll('.sig canvas').forEach(c=>{
      c.style.height = Math.max(160, c.clientWidth*0.45) + 'px';
    });
  }
  window.addEventListener('resize', lockSigHeights);
  lockSigHeights();
})();
</script>
</body>
</html>
