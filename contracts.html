<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Warm Up UK – Order Form</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f7f7f9; --line:#e5e6ea; --muted:#666; --gold:#c9a227;
  --danger:#f6d8d6; --danger-line:#e3a3a0;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#000}
img{max-width:100%;display:block}

.container{max-width:860px;margin:14px auto 140px auto;padding:0 14px}
.card{background:#fff;border-radius:14px;padding:18px;border:1px solid var(--line)}

.header{display:flex;gap:16px;align-items:center}
.logo{width:150px;height:auto}
.co-title{font-weight:700;font-size:16px}
.co-address,.co-phone{font-size:14px;color:var(--muted)}
.co-phone a{color:var(--gold);text-decoration:none;font-weight:600}

.section{margin-top:22px}
.section h2{margin:0 0 8px;font-size:22px}
label{font-size:14px;color:var(--muted);margin-bottom:4px;display:block}

input,textarea,select{
  width:100%;padding:14px;border-radius:12px;border:1px solid var(--line);font-size:16px;background:#fff;
}
textarea{min-height:90px;resize:vertical}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:600px){.grid-2{grid-template-columns:1fr}}

.table{display:grid;gap:12px;margin-top:10px}

/* --- CLEAN STACKED PRODUCT ROWS --- */
.product-item{border:1px solid var(--line);border-radius:12px;padding:12px;display:grid;gap:10px;background:#fff}
.product-top select{width:100%}
.product-sub{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
@media(max-width:600px){.product-sub{grid-template-columns:1fr}}

.remove-btn{background:#fff;border:1px solid var(--line);padding:10px 12px;border-radius:10px;font-size:14px}

.totals{margin-top:12px;display:grid;gap:6px}
.totals .row{display:flex;justify-content:space-between}
.grand{font-size:22px;font-weight:700}

.waiver{background:var(--danger);border:2px solid var(--danger-line);border-radius:14px;padding:14px;margin-top:20px}
.flash{animation:flash .7s ease-in-out infinite}
@keyframes flash{50%{box-shadow:0 0 0 6px rgba(255,0,0,.2)}}

.sig-card{border:1px solid var(--line);padding:12px;border-radius:14px;margin-top:14px;background:#fff}
canvas{width:100%;height:240px;border-radius:12px;background:#fff;touch-action:none}

.actions{
  position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);
  padding:12px;display:flex;gap:10px;justify-content:center;z-index:100
}
.btn{padding:14px 16px;border-radius:12px;font-weight:700;font-size:16px;border:1px solid var(--line);cursor:pointer}
.btn.gold{background:var(--gold);border:none;color:#111}
.btn.light{background:#eef0f4}
</style>
</head>

<body>

<div class="container" id="formRoot">

<div class="card">
  <div class="header">
    <img src="warmupuklogo.jpg" class="logo">
    <div>
      <div class="co-title">WARM UP UK LIMITED</div>
      <div class="co-address">321–323 Romford High Road, Essex, RM6 6AX</div>
      <div class="co-phone">Office: <a href="tel:01708300670">01708 300670</a></div>
    </div>
  </div>

  <div class="section">
    <h2>Customer & Job Details</h2>
    <label>Customer Name</label><input id="custName">
    <div class="grid-2">
      <div><label>Phone (WhatsApp)</label><input id="custPhone"></div>
      <div><label>Email</label><input id="custEmail" type="email"></div>
    </div>
    <label>Install / Survey Date</label><input id="jobDate" type="date">
    <label>Installation Address</label><input id="siteAddr">
  </div>

  <div class="section">
    <h2>Products & Pricing</h2>
    <div id="products" class="table"></div>
    <button id="addProduct" class="btn light">+ Add product</button>

    <div class="totals">
      <div class="row"><div>Subtotal</div><div>£<span id="sub">0.00</span></div></div>
      <div class="row"><div>Admin Fee</div><div>£150.00</div></div>
      <div class="row"><label><input type="checkbox" id="vat"> Include VAT (20%)</label><div>£<span id="vatVal">0.00</span></div></div>
      <div class="row grand"><div>Grand Total</div><div>£<span id="grand">150.00</span></div></div>
    </div>
  </div>

  <div class="waiver" id="waiverBox">
    <h3>Express Waiver</h3>
    <p>Checking "I agree" instructs us to proceed immediately and waives the cooling-off period.</p>
    <label><input type="checkbox" id="agree"> I agree to the Express Waiver and authorise works to proceed.</label>
  </div>

  <div class="section">
    <h2>Signatures</h2>

    <div class="sig-card">
      <strong>Customer Signature</strong>
      <canvas id="sigCustomer"></canvas>
      <button class="btn light" data-clear="sigCustomer">Clear</button>
    </div>

    <div class="sig-card">
      <strong>Company Rep Signature</strong>
      <canvas id="sigCompany"></canvas>
      <button class="btn light" data-clear="sigCompany">Clear</button>
    </div>
  </div>

</div>
</div>

<div class="actions">
  <button class="btn light" id="clearForm">Clear Form</button>
  <button class="btn gold" id="generate">Generate PDF</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@5.0.4/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<script>
const PRODUCTS=[
  {label:"Loft Insulation – 270mm Fibreglass",unit:18},
  {label:"SuperQuilt Multifoil",unit:35},
  {label:"TLX Silver",unit:48},
  {label:"Spray Foam Removal",unit:28},
  {label:"Loft Boarding",unit:30}
];

function addProduct(){
  const wrap=document.createElement('div');
  wrap.className='product-item';
  wrap.innerHTML=`
    <div class="product-top"><select class="prod">
      ${PRODUCTS.map((p,i)=>`<option value="${i}">${p.label}</option>`).join("")}
    </select></div>
    <div class="product-sub">
      <input class="qty" placeholder="m²" inputmode="numeric">
      <input class="unit" placeholder="£/m²" inputmode="decimal">
      <input class="line" placeholder="Total" readonly>
    </div>
    <button class="remove-btn">Remove</button>
  `;
  document.getElementById('products').appendChild(wrap);

  const prod=wrap.querySelector('.prod');
  const qty=wrap.querySelector('.qty');
  const unit=wrap.querySelector('.unit');
  const line=wrap.querySelector('.line');

  unit.value=PRODUCTS[0].unit;

  function calc(){
    line.value=((qty.value*unit.value)||0).toFixed(2);
    totals();
  }
  prod.onchange=()=>{unit.value=PRODUCTS[prod.value].unit;calc()};
  qty.oninput=calc; unit.oninput=calc;
  wrap.querySelector('.remove-btn').onclick=()=>{wrap.remove();totals()};
  calc();
}
document.getElementById('addProduct').onclick=addProduct;
addProduct();

function totals(){
  let s=0;document.querySelectorAll('.line').forEach(l=>s+=+l.value||0);
  const admin=150;
  const v=document.getElementById('vat').checked?(s+admin)*0.2:0;
  document.getElementById('sub').textContent=s.toFixed(2);
  document.getElementById('vatVal').textContent=v.toFixed(2);
  document.getElementById('grand').textContent=(s+admin+v).toFixed(2);
}
document.getElementById('vat').onchange=totals;

function sig(id){
  const c=document.getElementById(id);
  const pad=new SignaturePad(c,{penColor:"#111"});
  function resize(){
    let r=window.devicePixelRatio||1;
    c.width=c.offsetWidth*r;
    c.height=240*r;
    c.getContext("2d").scale(r,r);
    pad.clear();
  }
  resize();window.addEventListener('resize',resize);
  return pad;
}
const padC=sig('sigCustomer'), padR=sig('sigCompany');
document.querySelectorAll('[data-clear]').forEach(b=>b.onclick=()=>({sigCustomer:padC,sigCompany:padR}[b.dataset.clear].clear()));

document.getElementById('clearForm').onclick=()=>location.reload();

document.getElementById('generate').onclick=()=>{
  if(!document.getElementById('agree').checked){
    document.getElementById('waiverBox').classList.add('flash');return;
  }
  const bar=document.querySelector('.actions');
  bar.style.display='none';
  html2pdf().from(document.getElementById('formRoot')).save().then(()=>{bar.style.display='flex'});
};
</script>
</body>
</html>
