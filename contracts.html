<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
  />
  <title>Customer Satisfaction – Completed Works</title>

  <!-- PDF + Canvas libraries -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- SignaturePad -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/5.1.1/signature_pad.umd.min.js"></script>

  <style>
    :root {
      --brand: #000000;
      --accent: #d4af37; /* gold */
      --border: #dddddd;
      --bg: #f7f7f8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
        sans-serif;
      background: var(--bg);
      color: #111;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      max-width: 900px;
      margin: 16px auto 32px;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      padding: 20px;
    }

    header {
      border-bottom: 2px solid var(--accent);
      padding-bottom: 12px;
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .logo-wrap {
      flex: 0 0 auto;
    }

    .logo-wrap img {
      height: 100px; /* bigger logo */
      width: auto;
      display: block;
    }

    .header-text {
      flex: 1 1 200px;
      min-width: 0;
    }

    header h1 {
      margin: 0 0 6px 0;
      font-size: 1.4rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      word-spacing: 0.2em;
    }

    header h1 span.brand {
      color: var(--accent);
    }

    header p {
      margin: 0;
      font-size: 0.85rem;
      opacity: 0.8;
    }

    .title-row {
      margin: 10px 0 18px 0;
      padding: 10px 12px;
      border-left: 4px solid var(--accent);
      background: #faf7f0;
      border-radius: 6px;
    }

    .title-row h2 {
      margin: 0 0 4px 0;
      font-size: 1.1rem;
    }

    .title-row p {
      margin: 0;
      font-size: 0.9rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 14px;
    }

    @media (min-width: 720px) {
      .form-grid-2 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 18px;
      }
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 9px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.95rem;
      background: #fff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    select {
      cursor: pointer;
    }

    .hint {
      font-size: 0.8rem;
      opacity: 0.75;
      margin-top: 2px;
    }

    .section-title {
      margin: 18px 0 10px 0;
      font-size: 1rem;
      font-weight: 600;
      padding-bottom: 4px;
      border-bottom: 1px solid #eee;
    }

    .signature-section {
      margin-top: 16px;
    }

    .signature-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 18px;
    }

    @media (min-width: 720px) {
      .signature-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .signature-card {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      background: #fcfcfc;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .signature-card h3 {
      margin: 0;
      font-size: 0.95rem;
    }

    .sig-box {
      border: 1px dashed #b5b5b5;
      border-radius: 6px;
      height: 120px;
      background: #fff;
      margin-top: 4px;
      position: relative;
      overflow: hidden;
    }

    .sig-box canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .sig-label {
      font-size: 0.8rem;
      opacity: 0.75;
      position: absolute;
      bottom: 6px;
      right: 8px;
      pointer-events: none;
      background: rgba(255, 255, 255, 0.7);
      padding: 2px 4px;
      border-radius: 4px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.8rem;
      border: 1px solid var(--accent);
      background: #fff;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn.primary {
      background: var(--accent);
      color: #000;
      font-weight: 600;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .footer-note {
      margin-top: 18px;
      font-size: 0.8rem;
      opacity: 0.8;
      text-align: center;
    }

    .footer-meta {
      margin-top: 4px;
      font-size: 0.75rem;
      opacity: 0.75;
    }

    .actions-bottom {
      margin-top: 16px;
      display: flex;
      justify-content: flex-end;
    }

    /* Flashing gold prompt for satisfaction dropdown */
    @keyframes goldPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7);
      }
      70% {
        box-shadow: 0 0 0 9px rgba(212, 175, 55, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(212, 175, 55, 0);
      }
    }

    select.attention {
      border-color: var(--accent);
      animation: goldPulse 1.4s infinite;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Everything that goes onto the PDF is inside this card -->
    <div class="card" id="satisfaction-form">
      <header>
        <div class="logo-wrap">
          <!-- make sure this file exists in the repo root -->
          <img src="warmupuklogo.jpg" alt="Warm Up UK logo" />
        </div>
        <div class="header-text">
          <h1>
            <span class="brand">WARM UP UK</span> – Customer Satisfaction
          </h1>
          <p>Customer satisfaction of completed works form</p>
        </div>
      </header>

      <div class="title-row">
        <h2>Confirmation of Completed Works</h2>
        <p>
          Please complete this form to confirm the works carried out at the
          property and your satisfaction with the installation.
        </p>
      </div>

      <!-- Client details -->
      <div class="form-grid">
        <div>
          <label for="client-name">Client name</label>
          <input
            type="text"
            id="client-name"
            name="client-name"
            placeholder="Enter client full name"
          />
        </div>

        <div>
          <label for="installation-address">Installation address</label>
          <textarea
            id="installation-address"
            name="installation-address"
            placeholder="House number/name, street, town, postcode"
          ></textarea>
        </div>

        <div class="form-grid-2">
          <div>
            <label for="completion-date">Date of completion</label>
            <input type="date" id="completion-date" name="completion-date" />
            <div class="hint">Date the installation was completed</div>
          </div>

          <div>
            <label for="satisfied"
              >Are you 100% satisfied with the works completed?</label
            >
            <select id="satisfied" name="satisfied">
              <option value="">Please select…</option>
              <option value="yes">Yes – I am 100% satisfied</option>
              <option value="no">No – I am not fully satisfied</option>
            </select>
            <div class="hint">
              If “No”, please ensure details are recorded on your job notes.
            </div>
          </div>
        </div>
      </div>

      <!-- Signatures -->
      <div class="signature-section">
        <div class="section-title">Signatures</div>

        <div class="signature-grid">
          <!-- Client signature -->
          <div class="signature-card">
            <h3>Client confirmation</h3>
            <label for="client-print">Client name (printed)</label>
            <input
              type="text"
              id="client-print"
              name="client-print"
              placeholder="Client to print full name"
            />

            <div class="sig-box">
              <canvas id="client-signature"></canvas>
              <span class="sig-label">Client signature</span>
            </div>

            <div class="btn-row">
              <button type="button" class="btn" id="clear-client">
                Clear signature
              </button>
            </div>
          </div>

          <!-- Installer signature -->
          <div class="signature-card">
            <h3>Installer confirmation</h3>
            <label for="installer-name">Installer name</label>
            <input
              type="text"
              id="installer-name"
              name="installer-name"
              placeholder="Installer to print full name"
            />

            <div class="sig-box">
              <canvas id="installer-signature"></canvas>
              <span class="sig-label">Installer signature</span>
            </div>

            <div class="btn-row">
              <button type="button" class="btn" id="clear-installer">
                Clear signature
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-note">
        <div>
          This form is to be completed at the point of handover when all agreed
          works have been finished.
        </div>
        <div class="footer-meta">
          Warm Up UK, 321–323 Romford High Road, Essex, RM6 6AX · Company Reg:
          16431384 · Email: hello@warmupuk.com
        </div>
      </div>
    </div>

    <!-- PDF action button -->
    <div class="actions-bottom">
      <button type="button" class="btn primary" id="download-pdf">
        Download PDF
      </button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const pads = {};

      function initSignaturePad(canvasId) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return null;

        const parentBox = canvas.parentElement;

        function resizeCanvas() {
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          const width = parentBox.offsetWidth;
          const height = parentBox.offsetHeight;

          canvas.width = width * ratio;
          canvas.height = height * ratio;

          const ctx = canvas.getContext("2d");
          ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
        }

        resizeCanvas();

        const pad = new SignaturePad(canvas, {
          penColor: "#000000",
          backgroundColor: "rgba(255,255,255,0)",
        });

        // Keep signature when resizing
        window.addEventListener("resize", function () {
          const data = pad.isEmpty() ? null : pad.toData();
          resizeCanvas();
          pad.clear();
          if (data) {
            try {
              pad.fromData(data);
            } catch (e) {
              // ignore if restore fails
            }
          }
        });

        pads[canvasId] = pad;
        return pad;
      }

      // Init pads
      initSignaturePad("client-signature");
      initSignaturePad("installer-signature");

      // Clear buttons
      const clearClientBtn = document.getElementById("clear-client");
      if (clearClientBtn) {
        clearClientBtn.addEventListener("click", function () {
          if (pads["client-signature"]) pads["client-signature"].clear();
        });
      }

      const clearInstallerBtn = document.getElementById("clear-installer");
      if (clearInstallerBtn) {
        clearInstallerBtn.addEventListener("click", function () {
          if (pads["installer-signature"]) pads["installer-signature"].clear();
        });
      }

      // Flashing gold for satisfaction until chosen
      const satisfiedSelect = document.getElementById("satisfied");
      if (satisfiedSelect) {
        satisfiedSelect.classList.add("attention");
        satisfiedSelect.addEventListener("change", function () {
          if (this.value) {
            this.classList.remove("attention");
          } else {
            this.classList.add("attention");
          }
        });
      }

      // PDF download
      const downloadBtn = document.getElementById("download-pdf");
      if (downloadBtn) {
        downloadBtn.addEventListener("click", async function () {
          const form = document.getElementById("satisfaction-form");
          if (!form) return;

          downloadBtn.disabled = true;
          downloadBtn.textContent = "Generating…";

          try {
            const canvas = await html2canvas(form, {
              scale: 2,
              useCORS: true,
            });

            const imgData = canvas.toDataURL("image/png");
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF("p", "mm", "a4");

            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const imgProps = pdf.getImageProperties(imgData);
            const imgWidth = imgProps.width;
            const imgHeight = imgProps.height;

            // Scale to fit inside a single A4 page (no cut off)
            const scale = Math.min(
              pageWidth / imgWidth,
              pageHeight / imgHeight
            );
            const pdfWidth = imgWidth * scale;
            const pdfHeight = imgHeight * scale;
            const marginX = (pageWidth - pdfWidth) / 2;
            const marginY = 0;

            pdf.addImage(
              imgData,
              "PNG",
              marginX,
              marginY,
              pdfWidth,
              pdfHeight
            );

            const clientName = (
              document.getElementById("client-name")?.value || "client"
            )
              .trim()
              .replace(/[^a-z0-9]+/gi, "-")
              .toLowerCase();

            const fileName = clientName
              ? `warmupuk-satisfaction-${clientName}.pdf`
              : "warmupuk-satisfaction-form.pdf";

            pdf.save(fileName);
          } catch (e) {
            alert("There was a problem generating the PDF.");
            console.error(e);
          } finally {
            downloadBtn.disabled = false;
            downloadBtn.textContent = "Download PDF";
          }
        });
      }
    });
  </script>
</body>
</html>
