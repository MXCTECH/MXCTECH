<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WARM UP UK • Contract Builder</title>

<!-- --- Fonts (system fallback for speed on mobile) --- -->
<style>
  :root{
    --gold:#d6b24b;
    --gold-deep:#b6902f;
    --black:#0f0f10;
    --ink:#1a1a1a;
    --ink-60:#1a1a1a99;
    --border:#e8e8e8;
    --panel:#ffffff;
    --radius:16px;
    --radius-sm:12px;
    --shadow:0 8px 28px rgba(0,0,0,.08);
  }
  html,body{
    background:#fff;
    color:var(--ink);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    line-height:1.45;
    -webkit-font-smoothing:antialiased;
    text-rendering:optimizeLegibility;
    margin:0;
  }
  .container{max-width:980px;margin:28px auto;padding:0 16px;}
  /* Header card */
  .hero{
    background:var(--black);
    color:#fff;
    border-radius:var(--radius);
    padding:20px;
    box-shadow:var(--shadow);
    position:relative;
    display:flex;
    align-items:center;
    gap:16px;
  }
  .logo-wrap{
    width:110px;height:110px;flex:0 0 auto;
    border-radius:18px; /* NO border, just soft mask */
    overflow:hidden; background:#000; /* ensures no white outline */
  }
  .logo-wrap img{
    width:100%;height:100%;object-fit:cover;display:block;
  }
  .hero-main{flex:1 1 auto;min-width:0}
  .addr{
    font-weight:700;letter-spacing:.2px;
    font-size:22px;line-height:1.25;margin:0 0 10px 0;
  }
  .hero-btns{display:flex;gap:12px;flex-wrap:wrap}
  .btn{
    appearance:none;border:0;cursor:pointer;
    padding:12px 18px;border-radius:12px;font-weight:700;
    transition:transform .06s ease, box-shadow .2s ease, background .2s;
  }
  .btn-gold{background:var(--gold);color:#000}
  .btn-gold:active{transform:translateY(1px)}
  .btn-dark{background:#2b2b2c;color:#fff}
  /* Cards */
  .card{
    background:var(--panel);border-radius:var(--radius);
    padding:18px;box-shadow:var(--shadow);margin-top:18px;border:1px solid var(--border);
  }
  .h2{font-size:26px;margin:0 0 14px 0;color:var(--ink);font-weight:800}
  /* Form */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .grid-1{grid-template-columns:1fr}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} .addr{font-size:18px} .logo-wrap{width:84px;height:84px}}
  label{font-size:13px;color:var(--ink-60);display:block;margin:10px 0 6px}
  input,select,textarea{
    width:100%;padding:14px 12px;border:1px solid var(--border);
    border-radius:12px;background:#fff;font-size:16px;outline:none;
  }
  input:focus,select:focus,textarea:focus{border-color:#d5d5d5;box-shadow:0 0 0 3px rgba(214,178,75,.15)}
  /* Table */
  table{width:100%;border-collapse:separate;border-spacing:0 10px;}
  th{font-size:13px;text-transform:uppercase;letter-spacing:.08em;color:var(--ink-60);text-align:left;padding:0 8px}
  td{background:#fff;border:1px solid var(--border);padding:8px;border-radius:10px}
  td input{border:0;width:100%;padding:10px 8px;background:transparent}
  .col-remove{width:48px;text-align:center}
  .chip{
    display:inline-flex;align-items:center;gap:10px;margin:8px 12px 0 0
  }
  .chip input{width:auto}
  .totals{border-top:2px solid #111;margin-top:8px;padding-top:10px}
  .totals .row{display:flex;justify-content:space-between;margin:6px 0}
  .grand{font-weight:900;font-size:22px;color:var(--gold-deep)}
  /* Waiver */
  .waiver-box{
    border:2px solid #b72525;border-radius:14px;padding:14px 16px;background:#fff5f5;
    transition:background .2s, box-shadow .2s, border-color .2s;
  }
  /* Flash animation for 6s when selected */
  @keyframes waiverFlash {
    0%,100% { background:#fff5f5; border-color:#b72525; }
    50% { background:#ffeded; border-color:#ff2d2d; box-shadow:0 0 0 6px rgba(255,45,45,.15); }
  }
  .flash-6s{ animation:waiverFlash .8s ease-in-out 7; } /* ~5.6s; plus start/end => about 6s */

  /* Signatures */
  .sig{
    border:1px dashed #cfcfcf;border-radius:12px;background:#fff;position:relative;height:180px
  }
  .sig canvas{width:100%;height:100%}
  .sig-toolbar{display:flex;justify-content:flex-end;gap:10px;margin-top:8px}
  .btn-mini{padding:8px 12px;border-radius:10px;font-size:13px}
  /* Footer small */
  .muted{color:#888;font-size:12px}
</style>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <section class="hero">
      <div class="logo-wrap">
        <img src="./warmupuklogo.jpg" alt="WARM UP UK Logo">
      </div>
      <div class="hero-main">
        <p class="addr">321–323 Romford High Road, Essex, RM6 6AX</p>
        <div class="hero-btns">
          <button id="btnPdf" class="btn btn-gold">Generate PDF</button>
          <button id="btnReset" class="btn btn-dark">Reset Form</button>
        </div>
      </div>
    </section>

    <!-- CUSTOMER -->
    <section class="card">
      <h2 class="h2">Customer</h2>
      <div class="grid">
        <div>
          <label>Customer Name</label>
          <input id="custName" placeholder="Full name">
        </div>
        <div>
          <label>Phone (WhatsApp)</label>
          <input id="custPhone" placeholder="07...">
        </div>
        <div>
          <label>Email</label>
          <input id="custEmail" placeholder="name@email.com" type="email">
        </div>
        <div>
          <label>Install / Survey Date</label>
          <input id="jobDate" type="date">
        </div>

        <div>
          <label>Address Line 1</label>
          <input id="addr1" placeholder="Street & number">
        </div>
        <div>
          <label>Town / City</label>
          <input id="city" placeholder="Town / City">
        </div>
        <div>
          <label>Postcode</label>
          <input id="postcode" placeholder="e.g. RM6 6AX">
        </div>
        <div>
          <label>Rep (optional)</label>
          <input id="rep" placeholder="Rep name">
        </div>
      </div>
    </section>

    <!-- PRODUCTS -->
    <section class="card" id="productsCard">
      <h2 class="h2">Products &amp; Pricing</h2>

      <table id="lines">
        <thead>
          <tr>
            <th style="width:38%">Item</th>
            <th style="width:18%">M²</th>
            <th style="width:18%">£ / Unit</th>
            <th style="width:18%">Line Total (£)</th>
            <th class="col-remove"></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div>
        <button class="btn btn-dark" id="btnAdd">+ Add line</button>
      </div>

      <div class="chip">
        <input type="checkbox" id="toggleAdmin" checked>
        <label for="toggleAdmin">Include Admin Fee (<strong>£150</strong>)</label>
      </div>
      <div class="chip">
        <input type="checkbox" id="toggleVAT">
        <label for="toggleVAT">Add VAT (20%)</label>
      </div>

      <div class="totals">
        <div class="row"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
        <div class="row"><span>Admin Fee</span><span id="adminFee">£150.00</span></div>
        <div class="row"><span>VAT</span><span id="vat">£0.00</span></div>
        <div class="row grand"><span>Total</span><span id="grand">£0.00</span></div>
        <p class="muted">All prices in GBP. Figures auto-update.</p>
      </div>
    </section>

    <!-- EXPRESS WAIVER -->
    <section class="card">
      <h2 class="h2">Express Waiver (Optional)</h2>
      <div class="grid">
        <div>
          <div class="chip">
            <input type="checkbox" id="waiverTick">
            <label for="waiverTick"><strong>I accept the Express Waiver</strong></label>
          </div>
          <div id="waiver" class="waiver-box" style="margin-top:10px;">
            By selecting the Express Waiver, I request works to commence at my property
            without the standard cooling-off period. I acknowledge that once works begin,
            I may be liable for reasonable costs if I later cancel.
          </div>
        </div>
      </div>
    </section>

    <!-- SIGNATURES -->
    <section class="card">
      <h2 class="h2">Signatures</h2>
      <label>Customer Signature</label>
      <div class="sig"><canvas id="sigCust"></canvas></div>
      <div class="sig-toolbar">
        <button class="btn btn-dark btn-mini" id="clearCust">Clear</button>
      </div>

      <label style="margin-top:14px">Company Signature (optional)</label>
      <div class="sig"><canvas id="sigRep"></canvas></div>
      <div class="sig-toolbar">
        <button class="btn btn-dark btn-mini" id="clearRep">Clear</button>
      </div>
    </section>

    <p class="muted" style="text-align:center;margin:20px 0 40px">
      © WARM UP UK — 321–323 Romford High Road, Essex, RM6 6AX
    </p>

  </div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<script>
/* ---------- Helpers ---------- */
const fmt = n => "£" + (Math.round(n * 100) / 100).toFixed(2);
const byId = id => document.getElementById(id);

/* ---------- Lines (Item, m2, price, total) ---------- */
const tbody = byId('tbody');
function addLine(item='', m2=0, unit=0){
  const tr = document.createElement('tr');

  const tdItem = document.createElement('td');
  const tdM2   = document.createElement('td');
  const tdUnit = document.createElement('td');
  const tdTot  = document.createElement('td');
  const tdRem  = document.createElement('td');

  tdItem.innerHTML = `<input placeholder="Item" value="${item}">`;
  tdM2.innerHTML   = `<input type="number" step="0.01" min="0" value="${m2}">`;
  tdUnit.innerHTML = `<input type="number" step="0.01" min="0" value="${unit}">`;
  tdTot.innerHTML  = `<input type="text" value="0.00" readonly>`;
  tdRem.className  = 'col-remove';
  tdRem.innerHTML  = `<button class="btn btn-dark btn-mini" title="Remove">×</button>`;

  tr.append(tdItem, tdM2, tdUnit, tdTot, tdRem);
  tbody.appendChild(tr);

  const inputs = tr.querySelectorAll('input');
  inputs.forEach(i => i.addEventListener('input', recalc));
  tdRem.querySelector('button').addEventListener('click', () => { tr.remove(); recalc(); });

  recalc();
}
byId('btnAdd').addEventListener('click', () => addLine());

/* ---------- Totals ---------- */
const toggleAdmin = byId('toggleAdmin');
const toggleVAT   = byId('toggleVAT');
[toggleAdmin, toggleVAT].forEach(el => el.addEventListener('change', recalc));

function recalc(){
  let sub = 0;
  tbody.querySelectorAll('tr').forEach(tr => {
    const m2 = parseFloat(tr.children[1].querySelector('input').value) || 0;
    const unit = parseFloat(tr.children[2].querySelector('input').value) || 0;
    const total = m2 * unit;
    tr.children[3].querySelector('input').value = total.toFixed(2);
    sub += total;
  });

  const admin = toggleAdmin.checked ? 150 : 0;
  const vatBase = sub + admin;
  const vat = toggleVAT.checked ? vatBase * 0.20 : 0;
  const grand = sub + admin + vat;

  byId('subtotal').textContent = fmt(sub);
  byId('adminFee').textContent = fmt(admin);
  byId('vat').textContent      = fmt(vat);
  byId('grand').textContent    = fmt(grand);
}
addLine(); // first row by default

/* ---------- Waiver Flash ---------- */
const waiverTick = byId('waiverTick');
const waiverBox  = byId('waiver');
waiverTick.addEventListener('change', () => {
  if (waiverTick.checked){
    waiverBox.classList.remove('flash-6s'); // reset if re-ticked
    void waiverBox.offsetWidth;             // reflow to restart animation
    waiverBox.classList.add('flash-6s');
  } else {
    waiverBox.classList.remove('flash-6s');
  }
});

/* ---------- Signature Pads ---------- */
function makePad(canvasId, clearBtnId){
  const canvas = byId(canvasId);
  const resize = () => {
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width  = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
  };
  resize(); window.addEventListener('resize', resize);
  const pad = new SignaturePad(canvas, {backgroundColor:'rgba(255,255,255,0)', penColor:'#111'});
  byId(clearBtnId).addEventListener('click', () => pad.clear());
  return pad;
}
const padCust = makePad('sigCust','clearCust');
const padRep  = makePad('sigRep','clearRep');

/* ---------- Reset ---------- */
byId('btnReset').addEventListener('click', () => {
  document.querySelectorAll('input').forEach(i=>{
    if (i.type==='checkbox'){ i.checked = (i.id==='toggleAdmin') ? true : false; }
    else if (i.type==='date'){ i.value=''; }
    else if (i.readOnly){ /* leave totals */ }
    else { i.value=''; }
  });
  tbody.innerHTML='';
  addLine();
  padCust.clear(); padRep.clear();
  waiverBox.classList.remove('flash-6s');
  recalc();
});

/* ---------- PDF ---------- */
byId('btnPdf').addEventListener('click', () => {
  // temporarily outline signatures so PDF catches the strokes crisply
  const opt = {
    margin:       6,
    filename:     `WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, useCORS: true, logging: false },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  const source = document.body.cloneNode(true); // clean snapshot
  html2pdf().from(source).set(opt).save();
});
</script>
</body>
</html>
