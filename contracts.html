<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK – Contract Builder</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --gold:#c9a227;
    --gold-deep:#b18f22;
    --black:#111;
    --ink:#222;
    --ink-soft:#4a4a4a;
    --bg:#ffffff;
    --card:#ffffff;
    --line:#e9e9e9;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:980px;margin:24px auto;padding:12px}
  /* Top banner */
  .hero{
    display:grid;grid-template-columns:96px 1fr auto;gap:16px;
    background:#000;border:1px solid rgba(201,162,39,.4);border-radius:16px;padding:16px;align-items:center;
  }
  .hero img.logo{
    width:96px;height:96px;object-fit:cover;border-radius:12px; /* no outline, no fade */
    display:block;background:#fff;
  }
  .hero .addr{color:#fff;font-weight:700;font-size:18px;line-height:1.25}
  .hero .btns{display:flex;gap:12px;align-items:center}
  .btn{
    background:var(--gold);border:none;color:#000;font-weight:700;padding:12px 18px;border-radius:12px;
    cursor:pointer;transition:.15s;box-shadow:0 1px 0 rgba(0,0,0,.15);
  }
  .btn:active{transform:translateY(1px)}
  .btn.dark{background:#2a2a2a;color:#fff}
  .section{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:16px}
  .section h2{margin:0 0 14px;font-size:22px;color:var(--gold);letter-spacing:.2px}
  /* Form */
  label{display:block;font-size:14px;color:var(--ink-soft);margin:10px 0 6px}
  input,select,textarea{
    width:100%;padding:14px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font-size:16px;
  }

  /* Products table */
  .table{width:100%;border-collapse:separate;border-spacing:0 10px}
  .th{font-size:13px;color:#8a8a8a;text-transform:uppercase;letter-spacing:.06em}
  .row{display:grid;grid-template-columns: minmax(90px,1.2fr) 110px 120px 120px 52px; gap:12px; align-items:center; margin-bottom:10px}
  .row input{height:48px}
  .del{width:48px;height:48px;border-radius:10px;border:1px solid var(--line);background:#fff;font-size:20px}
  .add-line{margin-top:8px;border:1px dashed var(--gold);background:#fff}
  .totals{border-top:2px solid #111;margin-top:14px;padding-top:14px}
  .totals .line{display:flex;justify-content:space-between;margin:6px 0}
  .totals .grand{font-weight:800;font-size:22px;color:var(--gold-deep)}
  .inline{display:flex;align-items:center;gap:10px}
  .inline label{margin:0}

  /* Waiver */
  .waiver-box{border:2px solid #d64242;border-radius:12px;padding:14px;background:#fff8f8;transition:background .2s}
  .waiver-flash{animation:flashRed 1s linear 6}
  @keyframes flashRed{
    0%,100%{background:#fff8f8}
    50%{background:#ffb3b3}
  }

  /* Signatures */
  .sig-grid{display:grid;grid-template-columns:1fr;gap:14px}
  .sig label{font-weight:600;color:#444}
  .sig canvas{width:100%;height:170px;border:2px dashed #cfcfcf;border-radius:12px;background:#fff;touch-action:none}
  .sig .toolbar{display:flex;gap:10px;margin-top:8px}
  .mini-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;font-size:14px}

  /* PDF footer (hidden while viewing, shown in PDF) */
  .pdf-footer{margin-top:16px;font-size:12px;color:#666}

  /* Mobile tweaks */
  @media (max-width:720px){
    .hero{grid-template-columns:72px 1fr auto}
    .hero img.logo{width:72px;height:72px}
    .row{grid-template-columns:minmax(70px,1.2fr) 88px 100px 110px 48px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- HERO -->
    <div class="hero">
      <img src="warmupuklogo.jpg" alt="Warm Up UK" class="logo">
      <div class="addr">321–323 Romford High Road, Essex, RM6 6AX</div>
      <div class="btns">
        <button id="btnPdf" class="btn">Generate PDF</button>
        <button id="btnReset" class="btn dark" type="button">Reset Form</button>
      </div>
    </div>

    <!-- CUSTOMER -->
    <div class="section">
      <h2>Customer</h2>
      <label>Customer Name</label>
      <input id="custName" placeholder="Full name">
      <label>Phone (WhatsApp)</label>
      <input id="custPhone" placeholder="07…">
      <label>Email</label>
      <input id="custEmail" placeholder="name@email.com">
      <label>Install / Survey Date</label>
      <input id="date" type="date">
      <label>Address Line 1</label>
      <input id="addr1" placeholder="Street & number">
      <label>Town / City</label>
      <input id="city" placeholder="Town / City">
      <label>Postcode</label>
      <input id="pc" placeholder="RM6 6AX">
    </div>

    <!-- PRODUCTS -->
    <div class="section" id="productsSection">
      <h2>Products & Pricing</h2>

      <div class="row th">
        <div>Item</div><div>m²</div><div>£ / unit</div><div>Line total (£)</div><div></div>
      </div>

      <div id="lines"></div>

      <button id="addLine" class="btn add-line" type="button">+ Add line</button>

      <div class="section totals">
        <div class="line inline">
          <div class="inline">
            <strong>Include Admin Fee (£150)</strong>
          </div>
          <div class="inline">
            <input id="adminOn" type="checkbox" checked disabled>
            <label for="adminOn">Auto-applies</label>
          </div>
        </div>

        <div class="line inline" style="justify-content:space-between">
          <div class="inline">
            <input id="vatOn" type="checkbox">
            <label for="vatOn">Add VAT (20%)</label>
          </div>
        </div>

        <div class="line"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
        <div class="line"><span>Admin Fee</span><span id="adminFee">£150.00</span></div>
        <div class="line"><span>VAT</span><span id="vat">£0.00</span></div>
        <div class="line grand"><span>Total</span><span id="grand">£0.00</span></div>
        <div style="font-size:12px;color:#6a6a6a;margin-top:8px">All prices in GBP. Figures auto-update.</div>
      </div>
    </div>

    <!-- WAIVER -->
    <div class="section" id="waiverSection">
      <h2>Express Waiver (Optional)</h2>
      <div class="inline" style="gap:12px;margin-bottom:10px">
        <input id="waiverTick" type="checkbox">
        <label for="waiverTick" style="font-weight:700;color:#222">I accept the Express Waiver</label>
      </div>
      <div id="waiverBox" class="waiver-box">
        By selecting the Express Waiver, I request works to commence at my property without
        the standard cooling-off period. I acknowledge that once works begin, I may be liable
        for reasonable costs if I later cancel.
      </div>
    </div>

    <!-- SIGNATURES -->
    <div class="section">
      <h2>Signatures</h2>
      <div class="sig-grid">
        <div class="sig">
          <label>Customer Signature</label>
          <canvas id="sigCustomer"></canvas>
          <div class="toolbar">
            <button class="mini-btn" type="button" data-clear="sigCustomer">Clear</button>
          </div>
        </div>
        <div class="sig">
          <label>Company Signature</label>
          <canvas id="sigCompany"></canvas>
          <div class="toolbar">
            <button class="mini-btn" type="button" data-clear="sigCompany">Clear</button>
          </div>
        </div>
      </div>
      <div class="pdf-footer">Warm Up UK · 321–323 Romford High Road, Essex, RM6 6AX</div>
    </div>
  </div>

<!-- html2canvas + jsPDF for PDF generation -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
(function(){
  // ---------- Helpers ----------
  const gbp = n => "£" + (n || 0).toFixed(2);
  const q = sel => document.querySelector(sel);
  const QA = sel => Array.from(document.querySelectorAll(sel));

  // ---------- Product lines ----------
  const linesWrap = q("#lines");
  function makeLine(){
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <input class="item" placeholder="Item">
      <input class="m2" inputmode="decimal" value="0">
      <input class="unit" inputmode="decimal" value="0.00">
      <input class="total" value="0.00" readonly>
      <button class="del" type="button" aria-label="Delete line">×</button>
    `;
    // events
    row.querySelector(".m2").addEventListener("input", recalc);
    row.querySelector(".unit").addEventListener("input", recalc);
    row.querySelector(".del").addEventListener("click", () => { row.remove(); recalc(); });
    linesWrap.appendChild(row);
    recalc();
  }
  q("#addLine").addEventListener("click", makeLine);
  // start with one line
  makeLine();

  // ---------- Totals ----------
  const adminFeeFixed = 150;
  function recalc(){
    let subtotal = 0;
    QA("#lines .row").forEach(r=>{
      const m2 = parseFloat(r.querySelector(".m2").value) || 0;
      const unit = parseFloat(r.querySelector(".unit").value) || 0;
      const line = m2 * unit;
      r.querySelector(".total").value = line.toFixed(2);
      subtotal += line;
    });
    const vatOn = q("#vatOn").checked;
    const admin = adminFeeFixed;
    const vat = vatOn ? (subtotal + admin) * 0.2 : 0;
    const grand = subtotal + admin + vat;

    q("#subtotal").textContent = gbp(subtotal);
    q("#adminFee").textContent = gbp(admin);
    q("#vat").textContent = gbp(vat);
    q("#grand").textContent = gbp(grand);
  }
  q("#vatOn").addEventListener("change", recalc);

  // ---------- Waiver flash ----------
  const waiverTick = q("#waiverTick");
  const waiverBox = q("#waiverBox");
  waiverTick.addEventListener("change", ()=>{
    if(waiverTick.checked){
      waiverBox.classList.add("waiver-flash");
      setTimeout(()=>waiverBox.classList.remove("waiver-flash"), 6000);
    }
  });

  // ---------- Signature pads ----------
  function SigPad(canvasId){
    const c = q("#"+canvasId);
    const ctx = c.getContext("2d");
    let drawing = false, last = null;

    function size(){ // resize for crisp drawing
      const rect = c.getBoundingClientRect();
      c.width = rect.width * devicePixelRatio;
      c.height = rect.height * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
      ctx.lineWidth = 2; ctx.lineCap = "round"; ctx.strokeStyle = "#000";
      ctx.fillStyle = "#fff"; ctx.fillRect(0,0,rect.width,rect.height);
    }
    size(); new ResizeObserver(size).observe(c);

    function point(e){
      const t = e.touches ? e.touches[0] : e;
      const r = c.getBoundingClientRect();
      return {x: (t.clientX - r.left), y: (t.clientY - r.top)};
    }
    function down(e){ drawing = true; last = point(e); e.preventDefault(); }
    function move(e){
      if(!drawing) return;
      const p = point(e);
      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      last = p;
      e.preventDefault();
    }
    function up(){ drawing = false; }

    c.addEventListener("pointerdown", down);
    c.addEventListener("pointermove", move);
    window.addEventListener("pointerup", up);
    // touch aliases (for older iOS)
    c.addEventListener("touchstart", down, {passive:false});
    c.addEventListener("touchmove", move, {passive:false});
    window.addEventListener("touchend", up);

    return {
      clear(){ size(); },
      toDataURL(){ return c.toDataURL("image/png"); }
    };
  }
  const sigCustomer = SigPad("sigCustomer");
  const sigCompany = SigPad("sigCompany");
  QA("[data-clear]").forEach(b=>{
    b.addEventListener("click", ()=> {
      (b.getAttribute("data-clear")==="sigCustomer" ? sigCustomer : sigCompany).clear();
    });
  });

  // ---------- Reset ----------
  q("#btnReset").addEventListener("click", ()=>{
    document.querySelectorAll("input").forEach(el=>{
      if(el.type==="checkbox"){ if(el.id==="vatOn") el.checked=false; else el.checked=false; }
      else if(el.type==="date"){ el.value=""; }
      else if(el.classList.contains("total")){ el.value="0.00"; }
      else if(el.classList.contains("m2") || el.classList.contains("unit")){ el.value = el.classList.contains("m2") ? "0" : "0.00"; }
      else if(!el.readOnly){ el.value=""; }
    });
    // keep one empty line
    QA("#lines .row").forEach((r,i)=>{ if(i>0) r.remove(); });
    sigCustomer.clear(); sigCompany.clear();
    recalc();
    window.scrollTo({top:0,behavior:"smooth"});
  });

  // ---------- PDF ----------
  q("#btnPdf").addEventListener("click", async ()=>{
    // ensure latest totals rendered
    recalc();
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'pt', 'a4');
    const pageW = pdf.internal.pageSize.getWidth();
    // capture the main content
    const node = document.querySelector('.wrap');
    const canvas = await html2canvas(node, {scale:2, useCORS:true});
    const img = canvas.toDataURL('image/png');
    const imgW = pageW - 40; // 20pt margins
    const imgH = canvas.height * imgW / canvas.width;
    let y = 20;
    pdf.addImage(img, 'PNG', 20, y, imgW, imgH, undefined, 'FAST');
    pdf.save('WarmUpUK-Contract.pdf');
  });

  // initial totals
  recalc();
})();
</script>
</body>
</html>
