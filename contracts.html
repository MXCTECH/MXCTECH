<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WARM UP UK • Contract Builder</title>

<!-- Fonts (system stack for speed) -->
<style>
  :root{
    --gold:#d4af37;
    --gold-dark:#b8962e;
    --black:#0f0f10;
    --ink:#1a1a1a;
    --muted:#666;
    --card:#ffffff;
    --line:#e9e9ee;
    --danger:#ff2d2d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#fff;color:var(--ink);font:16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  /* Header */
  .hero{
    background:linear-gradient(180deg, rgba(0,0,0,.94), rgba(0,0,0,.92));
    color:#fff;border-radius:16px;padding:18px;border:1px solid rgba(212,175,55,.35);
    box-shadow:0 8px 24px rgba(0,0,0,.12);
  }
  .hero-grid{display:grid;grid-template-columns:84px 1fr auto;gap:16px;align-items:center}
  .brand-logo{
    width:84px;height:84px;border-radius:12px;overflow:hidden;border:2px solid rgba(212,175,55,.85);background:#fff;
    display:flex;align-items:center;justify-content:center;
  }
  .brand-logo img{max-width:100%;max-height:100%;display:block}
  .addr{font-weight:600}
  .addr small{display:block;color:#ddd;font-weight:500}
  .btns{display:flex;gap:12px;flex-wrap:wrap}
  .btn{
    appearance:none;border:0;cursor:pointer;padding:12px 18px;border-radius:12px;font-weight:700;
  }
  .btn-gold{background:var(--gold);color:#111;box-shadow:0 4px 0 var(--gold-dark)}
  .btn-dark{background:#333;color:#fff}
  .btn:active{transform:translateY(1px)}
  /* Cards */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;margin:16px 0}
  .card h2{margin:0 0 12px;font-size:22px;letter-spacing:.2px;color:#000}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){.grid.two{grid-template-columns:1fr 1fr}}
  input,select,textarea{
    width:100%;padding:14px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font:inherit;color:inherit
  }
  textarea{min-height:110px;resize:vertical}
  .label{font-weight:600;color:#000;margin-top:6px}
  .section-title{font-weight:800;color:var(--gold);font-size:26px;margin:6px 0 14px}
  /* Products table */
  .table{width:100%;border-collapse:separate;border-spacing:12px 8px}
  .table th{font-size:13px;text-transform:uppercase;letter-spacing:.08em;color:#5a5a5a;text-align:left}
  .rm{background:#111;color:#fff;border-radius:10px;border:0;padding:8px 10px}
  .inline{display:flex;align-items:center;gap:10px}
  .chip{display:inline-flex;align-items:center;gap:10px;background:#f7f7fb;border:1px solid var(--line);padding:12px 14px;border-radius:14px}
  .chip input[type=checkbox]{width:20px;height:20px}
  .totals{border-top:3px solid #111;margin-top:12px;padding-top:12px}
  .totals .row{display:flex;justify-content:space-between;margin:6px 0}
  .total-num{font-size:28px;font-weight:800;color:var(--gold)}
  /* T&Cs & waiver */
  .tcs li{margin:8px 0}
  .waiver-box{border:2px solid #cc3a3a;background:#fff4f4;padding:14px;border-radius:12px}
  .waiver-flash{animation:flash 500ms ease-in-out infinite alternate}
  @keyframes flash{from{background:#fff4f4;border-color:#ff5a5a}to{background:#ffe9e9;border-color:#ff0000}}
  /* Signatures */
  .sigs{display:grid;gap:16px}
  @media(min-width:720px){.sigs{grid-template-columns:1fr 1fr}}
  .sig-pad{border:2px dashed #bbb;border-radius:12px;background:#fff;height:180px}
  .sig-actions{display:flex;gap:8px;margin-top:8px}
  .no-break{page-break-inside:avoid}
  /* Footer tiny */
  .tiny{color:#777;font-size:12px}
</style>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <div class="hero no-break" id="headerCard">
      <div class="hero-grid">
        <div class="brand-logo">
          <img src="warmupuklogo.jpg" alt="WARM UP UK logo" />
        </div>
        <div class="addr">
          <div style="font-size:28px;line-height:1.05;font-weight:800;letter-spacing:.5px">WARM UP UK</div>
          321–323 Romford High Road, Essex, RM6 6AX
          <small>Office: <a href="tel:01708300670" style="color:#9ed0ff">01708 300670</a></small>
        </div>
        <div class="btns">
          <button class="btn btn-gold" id="btnPdf" type="button">Generate PDF</button>
          <button class="btn btn-dark" id="btnReset" type="button">Reset Form</button>
        </div>
      </div>
    </div>

    <!-- Customer -->
    <div class="card">
      <div class="section-title">Customer</div>
      <div class="grid two">
        <div>
          <div class="label">Customer Name</div>
          <input id="custName" placeholder="Full name">
        </div>
        <div>
          <div class="label">Phone (WhatsApp)</div>
          <input id="custPhone" placeholder="07...">
        </div>
        <div>
          <div class="label">Email</div>
          <input id="custEmail" placeholder="name@email.com">
        </div>
        <div>
          <div class="label">Install / Survey Date</div>
          <input id="installDate" type="date">
        </div>
        <div>
          <div class="label">Address Line 1</div>
          <input id="addr1" placeholder="Street & number">
        </div>
        <div>
          <div class="label">Town / City</div>
          <input id="city" placeholder="Town / City">
        </div>
        <div>
          <div class="label">Postcode</div>
          <input id="postcode" placeholder="e.g. RM6 6AX">
        </div>
        <div>
          <div class="label">Order Notes (optional)</div>
          <input id="notes" placeholder="Special instructions / access, preferred days, etc.">
        </div>
      </div>
    </div>

    <!-- Products -->
    <div class="card no-break" id="productsCard">
      <div class="section-title">Products &amp; Pricing</div>
      <table class="table" id="lines">
        <thead>
          <tr>
            <th style="width:32%">Item</th>
            <th style="width:18%">m²</th>
            <th style="width:20%">£ / unit</th>
            <th style="width:20%">Line total (£)</th>
            <th style="width:10%"></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="inline" style="gap:12px;margin:6px 0 10px">
        <button type="button" class="rm" id="addLine">+ Add line</button>

        <label class="chip">
          <input type="checkbox" id="adminFee" checked>
          <span>Include admin fee (£150)</span>
        </label>

        <label class="chip">
          <input type="checkbox" id="addVat">
          <span>Add VAT (20%)</span>
        </label>
      </div>

      <div class="totals">
        <div class="row"><span>Subtotal</span><span id="subTot">£0.00</span></div>
        <div class="row"><span>Admin Fee</span><span id="adminTot">£150.00</span></div>
        <div class="row"><span>VAT</span><span id="vatTot">£0.00</span></div>
        <div class="row" style="align-items:end"><span class="section-title" style="margin:0">Total</span><span class="total-num" id="grandTot">£150.00</span></div>
        <div class="tiny">All prices in GBP. Figures auto-update.</div>
      </div>
    </div>

    <!-- Terms -->
    <div class="card no-break" id="tcsCard">
      <h2>Terms &amp; Conditions (Summary)</h2>
      <ol class="tcs">
        <li>All quotes are valid for 30 days unless stated otherwise.</li>
        <li>Access to the work area, clear of personal belongings, is required.</li>
        <li>Balance due on completion unless a different schedule is agreed in writing.</li>
        <li>Manufacturer warranties apply to materials used.</li>
        <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
      </ol>
    </div>

    <!-- Waiver -->
    <div class="card no-break" id="waiverCard">
      <h2>Express Waiver (Optional)</h2>
      <label class="inline" style="gap:8px;margin:6px 0 10px">
        <input type="checkbox" id="waiverChk">
        <strong>I accept the Express Waiver</strong>
      </label>
      <div class="waiver-box" id="waiverBox">
        By selecting the Express Waiver, I request works to commence at my property without the
        standard cooling-off period. I acknowledge that once works begin, I may be liable for
        reasonable costs if I later cancel.
      </div>
    </div>

    <!-- Signatures -->
    <div class="card no-break" id="sigCard">
      <h2>Signatures</h2>
      <div class="sigs">
        <div>
          <div class="label">Customer Signature</div>
          <canvas id="sig1" class="sig-pad"></canvas>
          <div class="sig-actions">
            <button class="btn btn-dark" id="clear1" type="button">Clear</button>
          </div>
        </div>
        <div>
          <div class="label">Company Signature</div>
          <canvas id="sig2" class="sig-pad"></canvas>
          <div class="sig-actions">
            <button class="btn btn-dark" id="clear2" type="button">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tiny" style="margin:16px 0;text-align:center">
      © WARM UP UK
    </div>
  </div>

<script>
/* ---------- helpers ---------- */
const fmt = n => "£" + (Number(n||0).toFixed(2));
function el(id){return document.getElementById(id)}

/* ---------- dynamic line items ---------- */
const tbody = el('tbody');
function addRow(item='', m2=0, unit=0){
  const tr = document.createElement('tr');

  const tdItem = document.createElement('td');
  const tdM2 = document.createElement('td');
  const tdUnit = document.createElement('td');
  const tdLine = document.createElement('td');
  const tdDel = document.createElement('td');

  tdItem.innerHTML = `<input placeholder="Item" value="${item}">`;
  tdM2.innerHTML = `<input type="number" min="0" step="0.01" placeholder="0" value="${m2}">`;
  tdUnit.innerHTML = `<input type="number" min="0" step="0.01" placeholder="0.00" value="${unit}">`;
  tdLine.innerHTML = `<input readonly placeholder="0.00">`;
  tdDel.innerHTML = `<button type="button" class="rm" title="Remove">×</button>`;

  tr.append(tdItem, tdM2, tdUnit, tdLine, tdDel);
  tbody.appendChild(tr);

  tr.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('input', recalc);
  });
  tdDel.querySelector('button').addEventListener('click', ()=>{
    tr.remove(); recalc();
  });
  recalc();
}
el('addLine').addEventListener('click', ()=>addRow());

/* ---------- totals ---------- */
function recalc(){
  let subtotal = 0;
  tbody.querySelectorAll('tr').forEach(tr=>{
    const m2 = parseFloat(tr.children[1].querySelector('input').value)||0;
    const unit = parseFloat(tr.children[2].querySelector('input').value)||0;
    const line = m2 * unit;
    tr.children[3].querySelector('input').value = line.toFixed(2);
    subtotal += line;
  });
  const admin = el('adminFee').checked ? 150 : 0;
  const vat = el('addVat').checked ? (subtotal + admin) * 0.2 : 0;
  el('subTot').textContent = fmt(subtotal);
  el('adminTot').textContent = fmt(admin);
  el('vatTot').textContent = fmt(vat);
  el('grandTot').textContent = fmt(subtotal + admin + vat);
}
el('adminFee').addEventListener('change', recalc);
el('addVat').addEventListener('change', recalc);

/* start with one line */
addRow();

/* ---------- waiver flash ---------- */
const waiverChk = el('waiverChk');
const waiverBox = el('waiverBox');
waiverChk.addEventListener('change', ()=>{
  if(waiverChk.checked){
    waiverBox.classList.add('waiver-flash');
    setTimeout(()=>waiverBox.classList.remove('waiver-flash'), 6000); // ~6s
  }else{
    waiverBox.classList.remove('waiver-flash');
  }
});

/* ---------- signature pads ---------- */
let sigPad1, sigPad2;
function initPads(){
  sigPad1 = new SignaturePad(document.getElementById('sig1'), {backgroundColor:'rgba(255,255,255,0)', penColor:'#000'});
  sigPad2 = new SignaturePad(document.getElementById('sig2'), {backgroundColor:'rgba(255,255,255,0)', penColor:'#000'});
}
function resizePads(){
  [sigPad1, sigPad2].forEach((pad,i)=>{
    const canvas = document.getElementById(i===0?'sig1':'sig2');
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    const ctx = canvas.getContext('2d'); ctx.scale(ratio, ratio);
    if (pad) pad.clear();
  });
}
window.addEventListener('resize', resizePads);
window.addEventListener('orientationchange', resizePads);
initPads(); resizePads();
el('clear1').addEventListener('click', ()=>sigPad1.clear());
el('clear2').addEventListener('click', ()=>sigPad2.clear());

/* ---------- reset ---------- */
el('btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('input').forEach(i=>{
    if(['checkbox','date','number','text','email'].includes(i.type)){
      if(i.type==='checkbox') i.checked = (i.id==='adminFee'); else i.value='';
    }
  });
  tbody.innerHTML=''; addRow(); recalc();
  sigPad1.clear(); sigPad2.clear();
  window.scrollTo({top:0,behavior:'smooth'});
});

/* ---------- PDF ---------- */
el('btnPdf').addEventListener('click', async ()=>{
  // Ensure numbers are up to date
  recalc();

  // duplicate signature images into inline <img> so html2canvas captures reliably
  const sigImg1 = sigPad1.isEmpty()?null:sigPad1.toDataURL('image/png');
  const sigImg2 = sigPad2.isEmpty()?null:sigPad2.toDataURL('image/png');
  // Temporarily place images under canvases
  const i1 = document.createElement('img'); const i2 = document.createElement('img');
  if(sigImg1){ i1.src = sigImg1; i1.style.width='100%'; i1.style.marginTop='-178px'; i1.style.opacity='0'; el('sig1').after(i1); }
  if(sigImg2){ i2.src = sigImg2; i2.style.width='100%'; i2.style.marginTop='-178px'; i2.style.opacity='0'; el('sig2').after(i2); }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({unit:'pt', format:'a4', compress:true});
  const a4w = 595.28, a4h = 841.89, margin = 28;

  const pages = [ 'headerCard','productsCard','tcsCard','waiverCard','sigCard' ];
  let y = margin;

  // Add customer card first, so everything appears before products if taller.
  pages.splice(1,0,''); // placeholder
  pages[1] = document.querySelectorAll('.card')[0].id; // the customer card's id

  for(const id of pages){
    const node = document.getElementById(id);
    node.classList.add('no-break');
    const canvas = await html2canvas(node,{scale:2,backgroundColor:'#ffffff'});
    const img = canvas.toDataURL('image/jpeg',0.95);
    const w = a4w - margin*2;
    const h = canvas.height * (w/canvas.width);

    if(y + h > a4h - margin){ pdf.addPage(); y = margin; }
    pdf.addImage(img,'JPEG',margin,y,w,h);
    y += h + 10;
  }

  // Cleanup temp images
  i1.remove(); i2.remove();

  pdf.save(`WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`);
});

/* prevent accidental form submit scrolling/page jump */
document.querySelectorAll('button').forEach(b=>b.addEventListener('click',e=>e.preventDefault()));
</script>
</body>
</html>
