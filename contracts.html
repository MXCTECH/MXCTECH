<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WARM UP UK • Contract Builder</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- Signature Pad & html2pdf (bundles html2canvas + jsPDF) -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.2.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
  :root{
    --bg:#ffffff;
    --card:#ffffff;
    --ink:#0f0f10;
    --muted:#6f6f73;
    --gold:#d4af37;
    --gold-deep:#b9921b;
    --border:#e7e7ea;
    --chip:#111214;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.35}
  .page{max-width:980px;margin:24px auto;padding:0 16px 64px}
  .header{
    background:#0c0c0d; color:#fff; border-radius:18px; padding:20px 20px; display:grid;
    grid-template-columns:80px 1fr auto; gap:16px; align-items:center; border:1px solid rgba(212,175,55,.30);
    box-shadow:0 10px 20px rgba(0,0,0,.08);
  }
  .logoWrap{width:80px;height:80px;border-radius:14px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;border:0}
  .logoWrap img{width:100%;height:100%;object-fit:cover;display:block} /* no outline / no fade */
  .headText{display:flex;flex-direction:column;gap:4px}
  .brand{font-weight:800;letter-spacing:.06em;font-size:20px;color:#fff}
  .addr{color:#fff;opacity:.92;font-weight:600}
  .office{margin-top:4px}
  .office a{color:#c6d7ff;text-decoration:none}
  .btnRow{display:flex;gap:12px;align-items:center}
  .btn{appearance:none;border:0;border-radius:12px;padding:14px 18px;font-weight:700;cursor:pointer}
  .btnGold{background:linear-gradient(180deg,var(--gold),var(--gold-deep));color:#141414}
  .btnDark{background:#2a2b2f;color:#fff}
  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:20px;margin-top:18px}
  h2.section{margin:0 0 14px 0;font-size:26px;color:#1a1a1c}
  label.small{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type="text"], input[type="email"], input[type="tel"], input[type="date"], textarea, select{
    width:100%;padding:14px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;font-size:16px
  }
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .grid4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px}
  .chips{display:flex;gap:16px;align-items:center;margin-top:10px}
  .chip{display:flex;gap:10px;align-items:center;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#fff}
  .chip input{transform:scale(1.2)}
  .totals{margin-top:14px;border-top:3px solid #111; padding-top:12px}
  .rowFlex{display:flex;justify-content:space-between;align-items:center;margin:6px 0;font-weight:600}
  .rowFlex.total{font-size:28px;color:var(--gold-deep);font-weight:800}
  .productsTable{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 42px;gap:10px;align-items:end}
  .addLine{background:#0f0f10;color:#fff;border:0;border-radius:12px;padding:12px 14px;font-weight:700}
  .del{width:42px;height:42px;border-radius:10px;border:0;background:#111;color:#fff;font-weight:800}
  .noteBox{min-height:110px}
  /* Waiver flashing */
  .waiverBox{border:2px solid #d64545;border-radius:14px;padding:14px;margin-top:12px;background:#fff5f5}
  .waiverBox.flash{animation:flashRed 0.8s ease-in-out 7}
  @keyframes flashRed{
    0%,100%{background:#fff5f5;border-color:#d64545}
    50%{background:#ffcece;border-color:#ff2e2e}
  }
  /* Signatures */
  .sigGrid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .sigPad{border:2px dashed #cfcfd4;border-radius:14px;background:#fff;overflow:hidden}
  .sigPad canvas{width:100%;height:180px;display:block}
  .sigLbl{font-weight:700;margin:10px 0 6px}
  .sigActions{margin-top:6px}
  .smBtn{background:#2a2b2f;color:#fff;border:0;border-radius:10px;padding:8px 10px;font-weight:700}
  .help{font-size:12px;color:var(--muted)}
  /* Keep PDF to one page comfortably on phones */
  @media print{
    .btnRow{display:none}
    body{background:#fff}
  }
  @media (max-width:700px){
    .header{grid-template-columns:70px 1fr;grid-auto-rows:auto}
    .btnRow{grid-column:1/ -1}
    .logoWrap{width:70px;height:70px}
  }
</style>
</head>
<body>
<div class="page" id="pageRoot">

  <!-- HEADER -->
  <div class="header">
    <div class="logoWrap">
      <img src="warmupuklogo.jpg" alt="WARM UP UK logo" />
    </div>
    <div class="headText">
      <div class="brand">WARM UP UK</div>
      <div class="addr">
        321–323 Romford High Road, Essex, RM6 6AX
        <div class="office">Office: <a href="tel:01708300670">01708 300670</a></div>
      </div>
    </div>
    <div class="btnRow">
      <button class="btn btnGold" id="btnPdf">Generate PDF</button>
      <button class="btn btnDark" id="btnReset">Reset Form</button>
    </div>
  </div>

  <!-- CUSTOMER -->
  <div class="card">
    <h2 class="section">Customer</h2>
    <div class="grid2">
      <div>
        <label class="small">Customer Name</label>
        <input id="custName" type="text" placeholder="Full name">
      </div>
      <div>
        <label class="small">Phone (WhatsApp)</label>
        <input id="custPhone" type="tel" placeholder="07...">
      </div>
    </div>
    <div class="grid2" style="margin-top:12px">
      <div>
        <label class="small">Email</label>
        <input id="custEmail" type="email" placeholder="name@email.com">
      </div>
      <div>
        <label class="small">Install / Survey Date</label>
        <input id="jobDate" type="date">
      </div>
    </div>
    <div class="grid2" style="margin-top:12px">
      <div>
        <label class="small">Address Line 1</label>
        <input id="addr1" type="text" placeholder="Street & number">
      </div>
      <div>
        <label class="small">Town / City</label>
        <input id="town" type="text" placeholder="Town / City">
      </div>
    </div>
    <div class="grid3" style="margin-top:12px">
      <div>
        <label class="small">Postcode</label>
        <input id="postcode" type="text" placeholder="e.g. RM6 6AX">
      </div>
      <div>
        <label class="small">Order Notes (optional)</label>
        <input id="orderNotes" type="text" placeholder="Special instructions / access, preferred days, etc.">
      </div>
      <div></div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div class="card" id="productsCard">
    <h2 class="section">Products & Pricing</h2>

    <div id="lines"></div>
    <div style="margin-top:10px;display:flex;gap:12px;align-items:center;">
      <button type="button" class="addLine" id="addLine">+ Add line</button>
      <div class="chip"><input id="adminToggle" type="checkbox" checked> <label for="adminToggle">Include admin fee (£150)</label></div>
      <div class="chip"><input id="vatToggle" type="checkbox"> <label for="vatToggle">Add VAT (20%)</label></div>
    </div>

    <div class="totals">
      <div class="rowFlex"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
      <div class="rowFlex"><span>Admin Fee</span><span id="adminFee">£150.00</span></div>
      <div class="rowFlex"><span>VAT</span><span id="vat">£0.00</span></div>
      <div class="rowFlex total"><span>Total</span><span id="grandTotal">£150.00</span></div>
      <div class="help">All prices in GBP. Figures auto-update.</div>
    </div>
  </div>

  <!-- TERMS -->
  <div class="card" id="termsCard">
    <h2 class="section">Terms & Conditions (Summary)</h2>
    <ol style="padding-left:18px;margin:0;display:grid;gap:10px">
      <li>All quotes are valid for 30 days unless stated otherwise.</li>
      <li>Access to the work area, clear of personal belongings, is required.</li>
      <li>Balance due on completion unless a different schedule is agreed in writing.</li>
      <li>Manufacturer warranties apply to materials; workmanship warranty applies to installation.</li>
      <li>Any extra works not listed on this order will be quoted separately.</li>
      <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
    </ol>
  </div>

  <!-- WAIVER -->
  <div class="card">
    <h2 class="section">Express Waiver (Optional)</h2>
    <div class="chips">
      <label class="chip">
        <input id="waiverChk" type="checkbox"> I accept the Express Waiver
      </label>
    </div>
    <div id="waiverBox" class="waiverBox">
      By selecting the Express Waiver, I request works to commence at my property without the standard cooling-off period. I acknowledge that once works begin, I may be liable for reasonable costs if I later cancel.
    </div>
  </div>

  <!-- SIGNATURES -->
  <div class="card" id="signCard">
    <h2 class="section">Signatures</h2>
    <div class="sigGrid">
      <div>
        <div class="sigLbl">Customer Signature</div>
        <div class="sigPad"><canvas id="sigCustomer"></canvas></div>
        <div class="sigActions"><button class="smBtn" id="clearCustomer">Clear</button></div>
      </div>
      <div>
        <div class="sigLbl">Company Signature</div>
        <div class="sigPad"><canvas id="sigCompany"></canvas></div>
        <div class="sigActions"><button class="smBtn" id="clearCompany">Clear</button></div>
      </div>
    </div>
  </div>

</div>

<script>
/* ---------- Utilities ---------- */
const fmt = n => "£" + (Math.round(n * 100) / 100).toFixed(2);

/* ---------- Dynamic Lines (Item, m2, £/unit, Line total) ---------- */
const linesWrap = document.getElementById('lines');
let lineId = 0;
function addLine(value={item:'', m2:'0', unit:'0'}){
  const id = ++lineId;
  const row = document.createElement('div');
  row.className = 'productsTable';
  row.dataset.id = id;
  row.innerHTML = `
    <div>
      <label class="small">Item</label>
      <input data-k="item" type="text" placeholder="Item">
    </div>
    <div>
      <label class="small">m²</label>
      <input data-k="m2" type="number" min="0" step="0.01" value="${value.m2||0}">
    </div>
    <div>
      <label class="small">£ / UNIT</label>
      <input data-k="unit" type="number" min="0" step="0.01" value="${value.unit||0}">
    </div>
    <div>
      <label class="small">LINE TOTAL (£)</label>
      <input data-k="total" type="text" value="0.00" readonly>
    </div>
    <button type="button" class="del" aria-label="Delete">×</button>
  `;
  linesWrap.appendChild(row);
  row.querySelectorAll('input[data-k="m2"], input[data-k="unit"]').forEach(inp=>{
    inp.addEventListener('input', recalc);
  });
  row.querySelector('.del').addEventListener('click', ()=>{
    row.remove(); recalc();
  });
  recalc();
}
document.getElementById('addLine').addEventListener('click', ()=>addLine());
addLine(); // first line

/* ---------- Admin / VAT ---------- */
const adminToggle = document.getElementById('adminToggle');
const vatToggle = document.getElementById('vatToggle');
adminToggle.addEventListener('change', recalc);
vatToggle.addEventListener('change', recalc);

/* ---------- Totals ---------- */
function recalc(){
  let subtotal = 0;
  linesWrap.querySelectorAll('.productsTable').forEach(row=>{
    const m2 = parseFloat(row.querySelector('input[data-k="m2"]').value || 0);
    const unit = parseFloat(row.querySelector('input[data-k="unit"]').value || 0);
    const line = m2 * unit;
    row.querySelector('input[data-k="total"]').value = (Math.round(line*100)/100).toFixed(2);
    subtotal += line;
  });
  const admin = adminToggle.checked ? 150 : 0;
  const beforeVAT = subtotal + admin;
  const vat = vatToggle.checked ? beforeVAT * 0.20 : 0;
  const grand = beforeVAT + vat;

  document.getElementById('subtotal').textContent = fmt(subtotal);
  document.getElementById('adminFee').textContent = fmt(admin);
  document.getElementById('vat').textContent = fmt(vat);
  document.getElementById('grandTotal').textContent = fmt(grand);
}
recalc();

/* ---------- Waiver Flash ---------- */
const waiverChk = document.getElementById('waiverChk');
const waiverBox = document.getElementById('waiverBox');
waiverChk.addEventListener('change', ()=>{
  if(waiverChk.checked){
    waiverBox.classList.remove('flash'); // restart animation if re-clicked
    void waiverBox.offsetWidth;
    waiverBox.classList.add('flash'); // ~6s (0.8s × 7)
  }else{
    waiverBox.classList.remove('flash');
  }
});

/* ---------- Signatures ---------- */
const custPad = new SignaturePad(document.getElementById('sigCustomer'), {backgroundColor:'#ffffff'});
const compPad = new SignaturePad(document.getElementById('sigCompany'), {backgroundColor:'#ffffff'});
document.getElementById('clearCustomer').onclick = ()=>custPad.clear();
document.getElementById('clearCompany').onclick  = ()=>compPad.clear();

/* Resize canvases to device pixel ratio for crisp signing */
function resizeCanvases(){
  [custPad, compPad].forEach(p=>{
    const canvas = p.canvas;
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
    p.clear();
  });
}
window.addEventListener('resize', resizeCanvases);
resizeCanvases();

/* ---------- Reset ---------- */
document.getElementById('btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('input[type="text"],input[type="email"],input[type="tel"],input[type="date"]').forEach(i=>i.value='');
  linesWrap.innerHTML=''; addLine();
  adminToggle.checked = true; vatToggle.checked = false;
  waiverChk.checked = false; waiverBox.classList.remove('flash');
  custPad.clear(); compPad.clear(); recalc();
  window.scrollTo({top:0, behavior:'smooth'});
});

/* ---------- PDF (single A4 page if possible) ---------- */
document.getElementById('btnPdf').addEventListener('click', ()=>{
  // Temporarily render signatures as images so html2pdf captures them
  function sigToImg(pad){
    if (pad.isEmpty()) return null;
    const img = new Image(); img.src = pad.toDataURL("image/png");
    img.style.width = "100%"; img.style.height = "180px"; img.style.display="block";
    return img;
  }
  const custC = custPad.canvas, compC = compPad.canvas;
  const custImg = sigToImg(custPad), compImg = sigToImg(compPad);
  if (custImg){ custC.replaceWith(custImg); }
  if (compImg){ compC.replaceWith(compImg); }

  const opt = {
    margin:       6,
    filename:     `WARMUP-UK-Contract-${(new Date()).toISOString().slice(0,10)}.pdf`,
    image:        { type: 'jpeg', quality: 0.95 },
    html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
    pagebreak:    { mode:['avoid-all','css','legacy'] }
  };
  const source = document.getElementById('pageRoot');

  html2pdf().set(opt).from(source).save().then(()=>{
    // restore canvases
    if (custImg){ custImg.replaceWith(custC); }
    if (compImg){ compImg.replaceWith(compC); }
    resizeCanvases();
  });
});
</script>
</body>
</html>
