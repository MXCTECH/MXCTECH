<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK – Contract & Order Form</title>

<!-- ====== Minimal, stable styling (no jumping / no header) ====== -->
<style>
  :root{
    --bg:#ffffff;
    --ink:#111;
    --muted:#666;
    --gold:#C9A54F;
    --gold-deep:#A28635;
    --line:#e6e6e6;
    --accent:#f7f4ea;
    --danger:#d93025;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:16px;line-height:1.3}
  *{box-sizing:border-box}
  .page{
    max-width: 900px;
    margin: 24px auto 40px;
    padding: 16px;
  }
  .brand {
    display:flex;align-items:center;gap:16px;margin-bottom:8px;
  }
  .brand img{
    height:64px;width:auto;display:block;object-fit:contain;
  }
  .brand h1{display:none} /* no header text, just logo as requested */

  .company-details{
    border:1px solid var(--line);
    padding:10px 12px;
    border-radius:8px;
    background:#fafafa;
    font-size:15px;
  }
  .company-details b{color:var(--gold-deep)}

  .bar{
    margin:16px 0 8px;
    padding-bottom:6px;
    border-bottom:2px solid var(--gold);
    font-weight:700;
    letter-spacing:.3px;
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
  }
  label{font-weight:600;font-size:14px}
  input,select,textarea{
    width:100%;padding:10px 12px;border:1px solid var(--line);
    border-radius:8px;background:#fff;font-size:16px;
  }
  textarea{min-height:90px;resize:vertical}

  /* Products table */
  .products{
    border:1px solid var(--line);
    border-radius:10px;overflow:hidden;
  }
  .products header{
    display:grid;grid-template-columns: 2fr 1fr 1fr 1fr auto;
    gap:8px;background:var(--accent);padding:10px 12px;font-weight:700
  }
  .products .row{
    display:grid;grid-template-columns: 2fr 1fr 1fr 1fr auto;
    gap:8px;padding:10px 12px;border-top:1px solid var(--line);align-items:center;
  }
  .icon-btn{
    border:1px solid var(--line);background:#fff;border-radius:8px;padding:8px 10px;font-size:16px;cursor:pointer
  }
  .icon-btn:hover{background:#f6f6f6}
  .add-line{
    width:100%;margin-top:8px;padding:10px;border:1px dashed var(--gold);background:#fff;border-radius:10px;font-weight:600;cursor:pointer
  }

  /* Totals */
  .totals{
    margin-top:12px;border:1px solid var(--line);border-radius:10px;padding:12px;background:#fff
  }
  .totals .row{
    display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-top:1px dashed #eee
  }
  .totals .row:first-child{border-top:none}
  .money{font-variant-numeric: tabular-nums}
  .gold{color:var(--gold-deep);font-weight:700}

  .switch{
    display:inline-flex;align-items:center;gap:8px;user-select:none;cursor:pointer
  }
  .switch input{appearance:none;width:42px;height:24px;background:#ddd;border-radius:999px;position:relative;outline:none;transition:.2s}
  .switch input:checked{background:#b7a064}
  .switch input::after{
    content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#fff;transition:.2s
  }
  .switch input:checked::after{left:21px}

  /* Waiver – subtle flash */
  .waiver{
    border:2px solid var(--danger);border-radius:12px;padding:12px;margin-top:8px;background:#fff5f4;
    animation: pulse 1.8s ease-in-out infinite;
  }
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(217,48,37,.15)}
    70%{box-shadow:0 0 0 10px rgba(217,48,37,0)}
    100%{box-shadow:0 0 0 0 rgba(217,48,37,0)}
  }
  .waiver h3{margin:0 0 6px}
  .agree-line{
    display:flex;align-items:center;gap:10px;margin-top:8px;flex-wrap:wrap
  }
  .agree-line input[type="checkbox"]{width:20px;height:20px}

  /* Terms */
  .terms{
    border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;margin-top:12px
  }
  .terms ol{margin:0 0 0 18px;padding:0}
  .terms li{margin:6px 0}

  /* Signatures */
  .signatures{
    display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px
  }
  .sig-box{border:1px dashed #bbb;border-radius:12px;padding:8px;background:#fff}
  .sig-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .sig-pad{width:100%;height:180px;background:#fff;border:1px solid #ddd;border-radius:8px}
  .sig-actions{display:flex;gap:8px;margin-top:6px}

  /* Actions at very bottom */
  .actions{
    margin-top:18px;display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end
  }
  .btn{
    border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer;font-size:16px
  }
  .btn.gold{background:var(--gold);color:#fff}
  .btn.gold:hover{background:var(--gold-deep)}
  .btn.clear{background:#eee}
  .btn.clear:hover{background:#e2e2e2}

  /* Print/PDF helpers */
  .pdf-page{
    background:#fff;color:#000;padding:0;margin:0
  }
  .no-print{ }
  @media print{
    .no-print{display:none!important}
    body{background:#fff}
  }

  /* Mobile tweaks */
  @media (max-width: 780px){
    .grid{grid-template-columns:1fr}
    .products header,.products .row{grid-template-columns: 1.2fr .8fr .8fr .8fr auto}
    .signatures{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div id="page" class="page">
    <!-- BRAND (logo only) -->
    <div class="brand">
      <img src="warmupuklogo.jpg" alt="Warm Up UK logo" />
    </div>

    <!-- COMPANY DETAILS (edit in CONFIG in JS if you prefer dynamic fill) -->
    <div id="companyDetails" class="company-details">
      <div><b>Warm Up UK Limited</b></div>
      <div>Fitzwilliam House, Middle Bank, Doncaster, England, DN4 5NG</div>
      <div>Tel: 01708 300670 • Mobile: 07470 474 774 • Email: info@warmupuk.co.uk</div>
    </div>

    <!-- CUSTOMER / JOB INFO -->
    <div class="bar">Order Details</div>
    <div class="grid" aria-label="Customer and Job Information">
      <div>
        <label for="custName">Customer Name</label>
        <input id="custName" placeholder="Full name" />
      </div>
      <div>
        <label for="custPhone">Phone</label>
        <input id="custPhone" placeholder="07…" inputmode="tel" />
      </div>
      <div>
        <label for="custEmail">Email</label>
        <input id="custEmail" placeholder="name@example.com" inputmode="email" />
      </div>
      <div>
        <label for="custAddress">Installation Address</label>
        <input id="custAddress" placeholder="House/Street, Town, Postcode" />
      </div>
      <div>
        <label for="agent">Agent</label>
        <input id="agent" placeholder="Agent name" />
      </div>
      <div>
        <label for="confirmer">Confirmer</label>
        <input id="confirmer" placeholder="Confirmer name" />
      </div>
      <div>
        <label for="orderDate">Order Date</label>
        <input id="orderDate" type="date" />
      </div>
      <div>
        <label for="installDate">Target Install Date</label>
        <input id="installDate" type="date" />
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="bar">Products</div>
    <div id="products" class="products" role="table" aria-label="Products table">
      <header role="rowgroup">
        <div>Description</div>
        <div>Qty</div>
        <div>Unit (£)</div>
        <div>Line (£)</div>
        <div></div>
      </header>
      <div id="productRows"></div>
    </div>
    <button id="addLine" class="add-line no-print" type="button">+ Add Product Line</button>

    <!-- TOTALS -->
    <div class="totals" id="totals">
      <div class="row">
        <div>Subtotal</div>
        <div class="money" id="subTotal">£0.00</div>
      </div>
      <div class="row">
        <div>Admin Fee (fixed)</div>
        <div class="money" id="adminFee">£150.00</div>
      </div>
      <div class="row">
        <div class="switch">
          <label for="vatToggle" class="switch">
            <input id="vatToggle" type="checkbox" />
          </label>
          <span>Apply VAT (20%)</span>
        </div>
        <div class="money" id="vatAmount">£0.00</div>
      </div>
      <div class="row" style="border-top:2px solid var(--gold)">
        <div class="gold">Grand Total</div>
        <div class="money gold" id="grandTotal">£150.00</div>
      </div>
    </div>

    <!-- WAIVER -->
    <div class="bar">Express Waiver</div>
    <div class="waiver">
      <h3>Customer Waiver of Cooling-Off Period</h3>
      <p>
        I request immediate supply and installation services and agree to waive my 14-day cooling-off
        period so work can begin sooner. I understand my statutory rights are unaffected.
      </p>
      <div class="agree-line">
        <input id="agreeWaiver" type="checkbox" />
        <label for="agreeWaiver" style="font-weight:600">I agree to the above waiver and terms.</label>
      </div>
    </div>

    <!-- TERMS -->
    <div class="bar">Terms & Conditions (Summary)</div>
    <div class="terms">
      <ol>
        <li>All prices are in GBP and valid for 30 days unless stated otherwise.</li>
        <li>Deposits are non-refundable once materials are ordered.</li>
        <li>Access, power, and clear working areas must be provided by the customer.</li>
        <li>Any unforeseen works will be quoted and agreed prior to proceeding.</li>
        <li>Manufacturer warranties apply alongside our workmanship guarantee.</li>
        <li>Waste disposal will be carried out according to regulations.</li>
        <li>Payment terms: balance due on completion unless otherwise agreed in writing.</li>
        <li>Title of goods remains with Warm Up UK Ltd until paid in full.</li>
      </ol>
    </div>

    <!-- SIGNATURES -->
    <div class="bar">Signatures</div>
    <div class="signatures">
      <div class="sig-box">
        <div class="sig-top">
          <div><b>Customer Signature</b></div>
          <button class="icon-btn no-print" type="button" data-clear="sigCustomer">Clear</button>
        </div>
        <canvas id="sigCustomer" class="sig-pad" aria-label="Customer signature area"></canvas>
      </div>

      <div class="sig-box">
        <div class="sig-top">
          <div><b>Company Representative</b></div>
          <button class="icon-btn no-print" type="button" data-clear="sigCompany">Clear</button>
        </div>
        <canvas id="sigCompany" class="sig-pad" aria-label="Company representative signature area"></canvas>
      </div>
    </div>

    <!-- FINAL ACTIONS AT BOTTOM -->
    <div class="actions no-print">
      <button id="clearForm" class="btn clear" type="button">Clear Form</button>
      <button id="generatePdf" class="btn gold" type="button">Generate PDF</button>
    </div>
  </div>

  <!-- ====== Libraries (CDN) ====== -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.2.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <!-- ====== Behaviour ====== -->
  <script>
  /************* CONFIG – edit these if needed *************/
  const CONFIG = {
    companyName: "Warm Up UK Limited",
    addressLine: "Fitzwilliam House, Middle Bank, Doncaster, England, DN4 5NG",
    phoneOffice: "01708 300670",
    phoneMobile: "07470 474 774",
    email: "info@warmupuk.co.uk",
    adminFee: 150,
    vatRate: 0.20,
    defaultUnit: 650, // default unit price suggestion
    productOptions: [
      "Cavity Wall Insulation – Rockwool",
      "Loft Insulation – Fibreglass",
      "Pitched Roof – Multifoil (YBS SuperQuilt/TLX Silver)",
      "Pitched Roof – PIR Board",
      "Spray Foam Removal – Closed Cell",
      "Spray Foam Removal – Open Cell",
      "Loft Boarding",
      "Ventilation – Soffit/Tile Vents",
      "Eaves Clearance & Top-up",
      "Waste Removal / Skip"
    ]
  };

  // Inject company details if you want to change dynamically
  (function initCompanyDetails(){
    const el = document.getElementById('companyDetails');
    el.innerHTML = `
      <div><b>${CONFIG.companyName}</b></div>
      <div>${CONFIG.addressLine}</div>
      <div>Tel: ${CONFIG.phoneOffice} • Mobile: ${CONFIG.phoneMobile} • Email: ${CONFIG.email}</div>
    `;
  })();

  // Helpers
  const money = n => "£" + (Number(n||0).toFixed(2));
  const el = id => document.getElementById(id);

  // PRODUCTS
  const productRowsEl = el('productRows');
  const addLineBtn = el('addLine');

  function makeSelect(options){
    const s = document.createElement('select');
    CONFIG.productOptions.forEach(opt=>{
      const o = document.createElement('option');
      o.value = opt; o.textContent = opt;
      s.appendChild(o);
    });
    return s;
  }

  function productRow(){
    const row = document.createElement('div');
    row.className = 'row';

    const desc = makeSelect(CONFIG.productOptions);
    desc.setAttribute('aria-label','Product description');

    const qty = document.createElement('input');
    qty.type='number'; qty.min='0'; qty.step='1'; qty.placeholder='0';

    const unit = document.createElement('input');
    unit.type='number'; unit.min='0'; unit.step='0.01';
    unit.placeholder=CONFIG.defaultUnit.toString();

    const line = document.createElement('input');
    line.type='text'; line.readOnly=true; line.tabIndex=-1;

    const del = document.createElement('button');
    del.type='button'; del.className='icon-btn'; del.textContent='Remove';

    // events
    function recalc(){
      const q = parseFloat(qty.value||0);
      const u = parseFloat(unit.value || CONFIG.defaultUnit || 0);
      const v = q*u;
      line.value = money(v);
      computeTotals();
    }
    qty.addEventListener('input', recalc);
    unit.addEventListener('input', recalc);
    del.addEventListener('click', ()=>{ row.remove(); computeTotals(); });

    // mount
    row.append(desc, qty, unit, line, del);
    return row;
  }

  function computeTotals(){
    // subtotal
    let subtotal = 0;
    productRowsEl.querySelectorAll('.row').forEach(r=>{
      const qty = parseFloat(r.children[1].value||0);
      const unit = parseFloat(r.children[2].value||CONFIG.defaultUnit||0);
      subtotal += (qty*unit)||0;
    });
    const admin = CONFIG.adminFee;
    const vatOn = el('vatToggle').checked;
    const vatAmount = vatOn ? (subtotal + admin) * CONFIG.vatRate : 0;
    const grand = subtotal + admin + vatAmount;

    el('subTotal').textContent = money(subtotal);
    el('adminFee').textContent = money(admin);
    el('vatAmount').textContent = money(vatAmount);
    el('grandTotal').textContent = money(grand);
  }

  addLineBtn.addEventListener('click', ()=>{
    productRowsEl.appendChild(productRow());
  });

  // start with one line
  productRowsEl.appendChild(productRow());

  // VAT toggle
  el('vatToggle').addEventListener('change', computeTotals);

  // SIGNATURES
  const sigPads = {
    customer: new SignaturePad(el('sigCustomer'), {penColor:"#000"}),
    company:  new SignaturePad(el('sigCompany'),  {penColor:"#000"})
  };
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-clear');
      const pad = id==='sigCustomer' ? sigPads.customer : sigPads.company;
      pad.clear();
    });
  });

  // CLEAR FORM
  el('clearForm').addEventListener('click', ()=>{
    ['custName','custPhone','custEmail','custAddress','agent','confirmer','orderDate','installDate']
      .forEach(id=>{ el(id).value=''; });
    productRowsEl.innerHTML='';
    productRowsEl.appendChild(productRow());
    el('vatToggle').checked=false;
    el('agreeWaiver').checked=false;
    computeTotals();
    sigPads.customer.clear();
    sigPads.company.clear();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  // PDF
  el('generatePdf').addEventListener('click', async ()=>{
    // Ensure “I agree” checked and signatures provided
    if(!el('agreeWaiver').checked){
      alert('Please tick “I agree” in the waiver before generating the PDF.');
      return;
    }
    if(sigPads.customer.isEmpty()){
      alert('Customer signature is required.');
      return;
    }

    computeTotals(); // final calc

    // Create a clone to keep layout stable for PDF
    const page = el('page');
    const clone = page.cloneNode(true);
    clone.id = 'pdfPage';
    clone.classList.add('pdf-page');

    // Insert inline signature images into clone
    const custSigImg = clone.querySelector('#sigCustomer');
    const compSigImg = clone.querySelector('#sigCompany');

    function replaceCanvasWithImg(origId, inClone){
      const img = document.createElement('img');
      img.style.width='100%'; img.style.height='180px'; img.style.objectFit='contain'; img.style.border='1px solid #ddd'; img.style.borderRadius='8px';
      // data
      const data = (origId==='sigCustomer' ? sigPads.customer : sigPads.company).toDataURL('image/png');
      img.src = data;
      const canvas = inClone.querySelector('#'+origId);
      canvas.replaceWith(img);
    }
    replaceCanvasWithImg('sigCustomer', clone);
    if(!sigPads.company.isEmpty()){
      replaceCanvasWithImg('sigCompany', clone);
    }

    // Hide buttons in clone
    clone.querySelectorAll('.no-print').forEach(n=>n.remove());

    // Add to DOM (off-screen), render, then remove
    clone.style.position='fixed';
    clone.style.left='-10000px';
    document.body.appendChild(clone);

    const opt = {
      margin:       [8,8,8,8],
      filename:     `WarmUpUK_Contract_${(new Date()).toISOString().slice(0,10)}.pdf`,
      image:        { type: 'jpeg', quality: 0.96 },
      html2canvas:  { scale: 2, useCORS: true, logging: false },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    await html2pdf().set(opt).from(clone).save();

    document.body.removeChild(clone);
  });

  // Ensure initial totals
  computeTotals();

  // iOS input zoom mitigation: keep font-size >= 16px already. Also avoid scroll jumps:
  document.addEventListener('touchstart', ()=>{}, {passive:true});
  </script>
</body>
</html>
