<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK – Contract & Order Form</title>

<!-- libs (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@5.0.4/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<style>
  :root{
    --bg:#0e0e11;
    --card:#ffffff;
    --ink:#111;
    --muted:#5b5b63;
    --gold:#caa245;
    --soft:#f4f5f7;
    --danger:#f7d7cf;
    --danger-border:#e49383;
    --ring:#d9dadf;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#fafafa;color:var(--ink);font:16px/1.4 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Helvetica,Arial,sans-serif}
  .wrap{max-width:860px;margin:18px auto 120px;padding:0 14px}
  header.company{
    background:#0f1013;color:#fff;border-radius:18px;padding:16px 18px;display:flex;gap:14px;align-items:center;
    box-shadow:0 8px 30px rgba(0,0,0,.15)
  }
  header.company img.logo{
    width:68px;height:68px;object-fit:contain;border-radius:12px;background:#1111;display:block
  }
  .co-lines{flex:1;min-width:0}
  .co-name{font-weight:700;letter-spacing:.2px;margin:2px 0 6px}
  .co-addr,.co-tel{margin:0;font-size:14px;color:#e6e6e6}
  .co-tel a{color:var(--gold);text-decoration:none}
  .card{background:var(--card);border-radius:16px;border:1px solid #eee;margin-top:18px;overflow:hidden}
  .card .card-h{
    font-weight:800;font-size:26px;padding:18px 18px 8px;letter-spacing:.3px
  }
  .card .card-b{padding:14px 18px 22px}
  label{display:block;font-weight:600;margin:12px 0 8px}
  input,select,textarea{
    width:100%;padding:14px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff;
    font:16px/1.2 inherit
  }
  textarea{min-height:110px;resize:vertical}

  /* Products table */
  .table{border:1px solid #e5e6ea;border-radius:16px;overflow:hidden;background:#fff}
  .thead{display:grid;grid-template-columns:1.6fr .6fr .6fr .8fr .6fr;background:#0f1013;color:#fff;font-weight:700}
  .thead div{padding:14px 12px}
  .row{display:grid;grid-template-columns:1.6fr .6fr .6fr .8fr .6fr;gap:0;border-top:1px solid #ececf0;align-items:center}
  .row > *{padding:10px 10px}
  .row select,.row input{width:100%}
  .remove-btn{border:1px solid #eee;border-radius:12px;background:#f7f7f9;padding:10px 12px}
  .add-product{margin:12px 0}
  .add-product button{border:2px dashed #d3d5db;padding:12px 14px;background:#fff;border-radius:14px}

  .totals{padding:12px}
  .totals .line{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
  .grand{font-weight:800;font-size:22px}
  .vat-wrap{display:flex;align-items:center;gap:10px;margin-top:8px}

  /* Waiver */
  .waiver{border:2px solid var(--danger-border);background:#fdeeea;border-radius:16px;padding:16px 16px 8px}
  .waiver.flash{animation:flash 1.2s ease-in-out infinite}
  @keyframes flash{
    0%,100%{box-shadow:0 0 0 0 rgba(228,147,131,.45)}
    50%{box-shadow:0 0 0 8px rgba(228,147,131,.15)}
  }

  /* Signatures */
  .sigs{display:grid;grid-template-columns:1fr;gap:14px}
  .sig-card{background:#fff;border:1px solid #ececf0;border-radius:16px;padding:12px}
  .sig-title{font-weight:700;margin:4px 0 10px}
  canvas.signature{width:100%;height:160px;border:1px dashed #cfd2da;border-radius:12px;background:#fff;touch-action:none}
  .sig-actions{display:flex;gap:10px;margin-top:8px}
  .sig-actions button{padding:8px 12px;border-radius:10px;border:1px solid #e2e3e8;background:#f7f8fb}

  /* T&Cs */
  .tcs{background:#f7f8fc;border:1px solid #ececf0;border-radius:16px;padding:14px}
  .tcs ol{padding-left:18px;margin:8px 0}
  .tcs li{margin:6px 0}

  /* Footer buttons */
  .actions{
    position:sticky;bottom:0;z-index:40;background:linear-gradient(to top, rgba(250,250,250,1), rgba(250,250,250,.92));
    padding:12px 0 16px;margin-top:14px
  }
  .btns{display:flex;gap:14px;justify-content:flex-end}
  .btn{border:1px solid #dee0e6;border-radius:14px;padding:12px 16px;background:#fff}
  .btn.primary{background:var(--gold);border-color:#b9963e;color:#111;font-weight:700}

  /* Black products header on small screens too */
  @media (max-width:560px){
    .thead, .row{grid-template-columns:1.2fr .6fr .6fr .8fr .6fr}
    .co-name{font-size:16px}
    header.company img.logo{width:74px;height:74px}
    .card .card-h{font-size:24px}
    .btns{justify-content:space-between}
  }

  /* Print / PDF hints */
  @media print{
    .actions{display:none !important}
    .wrap{margin:0;padding:0}
  }
</style>
</head>
<body>
  <div class="wrap" id="formArea">
    <!-- Company block (logo + address only) -->
    <header class="company" aria-label="Company header">
      <img class="logo" src="warmupuklogo.jpg" alt="Warm Up UK logo">
      <div class="co-lines">
        <div class="co-name">WARM UP UK LIMITED</div>
        <p class="co-addr">321–323 Romford High Road, Essex, RM6 6AX</p>
        <p class="co-tel">Office: <a href="tel:01708300670">01708 300670</a></p>
      </div>
    </header>

    <!-- Customer & Job -->
    <section class="card">
      <div class="card-h">Customer</div>
      <div class="card-b">
        <label>Customer Name</label>
        <input id="custName" placeholder="Full name">

        <label>Phone (WhatsApp)</label>
        <input id="custPhone" placeholder="07..." inputmode="tel">

        <label>Email</label>
        <input id="custEmail" type="email" placeholder="name@email.com">

        <label>Install / Survey Date</label>
        <input id="jobDate" type="date">
      </div>
    </section>

    <section class="card">
      <div class="card-h">Property Address</div>
      <div class="card-b">
        <label>Street &amp; Number</label>
        <input id="addr1" placeholder="House No, Street, Town, Postcode">
        <label>Area (Optional)</label>
        <input id="addr2" placeholder="Area (Optional)">
      </div>
    </section>

    <section class="card">
      <div class="card-h">Team</div>
      <div class="card-b">
        <label>Sales Agent</label>
        <input id="agent" placeholder="Sales Agent name">
        <label>Confirmer</label>
        <input id="confirmer" placeholder="Confirmer name">
        <label>Notes</label>
        <textarea id="notes" placeholder="Any special instructions or access notes..."></textarea>
      </div>
    </section>

    <!-- Products -->
    <section class="card" id="productsCard">
      <div class="card-h">Products &amp; Pricing</div>
      <div class="card-b">
        <div class="table" id="productsTable">
          <div class="thead">
            <div>Product</div><div>Qty</div><div>Unit (£)</div><div>Line Total (£)</div><div>Action</div>
          </div>
          <!-- rows go here -->
        </div>

        <div class="add-product">
          <button type="button" id="addProductBtn">+ Add product</button>
        </div>

        <div class="totals">
          <div class="line"><span>Subtotal</span><strong id="subtotal">£0.00</strong></div>
          <div class="line"><span>Admin fee</span><strong id="admin">£150.00</strong></div>
          <div class="vat-wrap">
            <input id="includeVAT" type="checkbox" />
            <label for="includeVAT" style="margin:0;font-weight:600">Include VAT (20%)</label>
            <div style="margin-left:auto"><strong id="vat">£0.00</strong></div>
          </div>
          <hr style="border:none;border-top:1px solid #ececf0;margin:10px 0">
          <div class="line grand"><span>Grand Total</span><span id="grand">£150.00</span></div>
        </div>

        <div class="waiver flash" id="waiverBox">
          <div style="font-weight:800;font-size:22px;margin-bottom:8px">Express Waiver</div>
          <p style="margin:6px 2px 10px">
            By checking “I agree”, the customer instructs Warm Up UK to proceed without delay and acknowledges that
            the standard cooling-off period is waived.
          </p>
          <div class="vat-wrap">
            <input id="agreeWaiver" type="checkbox" />
            <label for="agreeWaiver" style="margin:0;font-weight:700">
              I agree to the Express Waiver and authorise works to proceed.
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- Signatures -->
    <section class="card">
      <div class="card-h">Signatures</div>
      <div class="card-b">
        <div class="sigs">
          <div class="sig-card">
            <div class="sig-title">Customer Signature</div>
            <canvas id="sigCustomer" class="signature"></canvas>
            <div class="sig-actions">
              <button type="button" data-clear="sigCustomer">Clear</button>
            </div>
          </div>
          <div class="sig-card">
            <div class="sig-title">Company Rep Signature</div>
            <canvas id="sigCompany" class="signature"></canvas>
            <div class="sig-actions">
              <button type="button" data-clear="sigCompany">Clear</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- T&Cs -->
    <section class="card">
      <div class="card-h">Terms &amp; Conditions (Summary)</div>
      <div class="card-b">
        <div class="tcs">
          <ol>
            <li>All quotations are valid for 30 days unless stated otherwise.</li>
            <li>Payment terms are due on completion unless agreed in writing.</li>
            <li>Prices include a £150 admin fee; VAT is added if selected.</li>
            <li>Customer confirms access, power, and safe working conditions.</li>
            <li>Materials remain property of Warm Up UK until paid in full.</li>
            <li>Any variations must be agreed and may affect price and dates.</li>
            <li>Waste removal is as specified; additional removal is chargeable.</li>
            <li>By signing, the customer agrees to these terms and any attached specification.</li>
          </ol>
        </div>
      </div>
    </section>
  </div>

  <!-- Sticky bottom buttons -->
  <div class="actions">
    <div class="wrap">
      <div class="btns">
        <button class="btn" id="clearBtn">Clear Form</button>
        <button class="btn primary" id="pdfBtn">Generate PDF</button>
      </div>
    </div>
  </div>

<script>
/* --------- Products data & helpers ---------- */
const productOptions = [
  {label:"Loft Insulation – 270mm Fibreglass (per m²)", price:18},
  {label:"TLX Silver (per m²)", price:42},
  {label:"YBS SuperQuilt (per m²)", price:38},
  {label:"Spray Foam Removal (per m²)", price:45},
  {label:"Loft Boarding (per m²)", price:30},
  {label:"Cavity Wall Insulation – Rockwool (per m²)", price:22}
];

const fmt = n => "£" + (Math.round(n*100)/100).toFixed(2);

const table = document.getElementById('productsTable');
const addBtn = document.getElementById('addProductBtn');
const subtotalEl = document.getElementById('subtotal');
const adminEl = document.getElementById('admin');
const vatEl = document.getElementById('vat');
const grandEl = document.getElementById('grand');
const vatChk = document.getElementById('includeVAT');

function makeRow(defaultIndex=0){
  const r = document.createElement('div');
  r.className = 'row';

  // Product select
  const prodCell = document.createElement('div');
  const sel = document.createElement('select');
  productOptions.forEach((p,i)=>{
    const o=document.createElement('option');
    o.value=i; o.textContent=p.label; sel.appendChild(o);
  });
  sel.value = defaultIndex;
  prodCell.appendChild(sel);

  // Qty
  const qtyCell = document.createElement('div');
  const qty = document.createElement('input');
  qty.type='number'; qty.min='0'; qty.step='1'; qty.value='0';
  qtyCell.appendChild(qty);

  // Unit
  const unitCell = document.createElement('div');
  const unit = document.createElement('input');
  unit.type='number'; unit.min='0'; unit.step='0.01';
  unit.value = productOptions[defaultIndex].price;
  unitCell.appendChild(unit);

  // Line total (read only display)
  const totalCell = document.createElement('div');
  const total = document.createElement('input');
  total.type='text'; total.readOnly=true; total.value=fmt(0);
  totalCell.appendChild(total);

  // Remove
  const remCell = document.createElement('div');
  const rem = document.createElement('button');
  rem.className='remove-btn'; rem.type='button'; rem.textContent='Remove';
  remCell.appendChild(rem);

  r.append(prodCell, qtyCell, unitCell, totalCell, remCell);
  table.appendChild(r);

  function recalc(){
    const lt = (+qty.value||0) * (+unit.value||0);
    total.value = fmt(lt);
    totals();
  }
  sel.addEventListener('change', ()=>{ unit.value = productOptions[+sel.value].price; recalc(); });
  qty.addEventListener('input', recalc);
  unit.addEventListener('input', recalc);
  rem.addEventListener('click', ()=>{ r.remove(); totals(); });

  recalc();
}

function totals(){
  let subtotal = 0;
  document.querySelectorAll('.row').forEach(row=>{
    const t = row.querySelector('div:nth-child(4) input').value.replace(/[£,]/g,'') || 0;
    subtotal += parseFloat(t);
  });
  const admin = 150;
  const vat = vatChk.checked ? 0.20*(subtotal+admin) : 0;
  const grand = subtotal + admin + vat;

  subtotalEl.textContent = fmt(subtotal);
  adminEl.textContent = fmt(admin);
  vatEl.textContent = fmt(vat);
  grandEl.textContent = fmt(grand);
}
vatChk.addEventListener('change', totals);
addBtn.addEventListener('click', ()=>makeRow());
makeRow(); // start with one line

/* --------- Waiver flash toggle ---------- */
const waiver = document.getElementById('waiverBox');
const agree = document.getElementById('agreeWaiver');
agree.addEventListener('change', ()=>{ waiver.classList.toggle('flash', !agree.checked); });
waiver.classList.add('flash');

/* --------- Signature pads (mobile-friendly) ---------- */
function createPad(id){
  const canvas = document.getElementById(id);
  const pad = new SignaturePad(canvas,{minWidth:0.8,maxWidth:2.0,penColor:"#111"});
  function resize(){
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
    pad.clear();
  }
  window.addEventListener('resize', resize);
  resize();
  return pad;
}
const padCustomer = createPad('sigCustomer');
const padCompany  = createPad('sigCompany');

document.querySelectorAll('[data-clear]').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const id = btn.getAttribute('data-clear');
    if(id==='sigCustomer') padCustomer.clear();
    if(id==='sigCompany')  padCompany.clear();
  });
});

/* --------- Clear form ---------- */
document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.querySelectorAll('input, textarea').forEach(el=>{
    if(el.type==='checkbox'){ el.checked=false; }
    else if(el.id==='includeVAT'){ el.checked=false; }
    else if(el.type!=='date'){ el.value=''; }
  });
  document.querySelectorAll('.row').forEach((r,i)=>{ if(i>0) r.remove(); });
  // reset first row values
  const firstRow = document.querySelector('.row');
  if(firstRow){
    firstRow.querySelector('select').value=0;
    firstRow.querySelector('div:nth-child(2) input').value='0';
    firstRow.querySelector('div:nth-child(3) input').value=productOptions[0].price;
    firstRow.querySelector('div:nth-child(4) input').value=fmt(0);
  }
  padCustomer.clear(); padCompany.clear();
  waiver.classList.add('flash');
  totals();
});

/* --------- Generate PDF ---------- */
document.getElementById('pdfBtn').addEventListener('click', ()=>{
  if(!agree.checked){
    waiver.scrollIntoView({behavior:'smooth',block:'center'});
    waiver.classList.add('flash');
    return;
  }
  // temporarily render signatures as images inside DOM so html2pdf captures crisp strokes
  function injectSig(canvas){
    if(canvas && !canvas.classList.contains('has-img')){
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png');
      img.style.width="100%"; img.style.height="auto";
      img.style.borderRadius="12px";
      canvas.after(img);
      canvas.dataset.injected = "1";
      canvas.style.display="none";
    }
  }
  injectSig(document.getElementById('sigCustomer'));
  injectSig(document.getElementById('sigCompany'));

  const opt = {
    filename: `WarmUpUK_Contract_${(new Date()).toISOString().slice(0,10)}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS:true },
    jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' },
    pagebreak: { mode:['css','legacy'] }
  };
  html2pdf().set(opt).from(document.getElementById('formArea')).save().then(()=>{
    // restore canvases
    document.querySelectorAll('canvas.signature').forEach(c=>{
      if(c.dataset.injected==="1"){
        c.style.display='block';
        if(c.nextSibling && c.nextSibling.tagName==='IMG') c.nextSibling.remove();
        delete c.dataset.injected;
      }
    });
  });
});
</script>
</body>
</html>
