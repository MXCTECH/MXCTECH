<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK • Contract Builder</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f0f0f; --panel:#171717; --ink:#e8e8e8;
    --muted:#9aa0a6; --gold:#d4af37; --gold-2:#b48c13; --accent:#ffd166;
    --danger-bg:#ffe9e9; --danger:#b00020;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:960px;margin:24px auto;padding:0 16px}
  .card{background:linear-gradient(180deg,#151515 0%, #121212 100%); border:1px solid rgba(212,175,55,.4);
        border-radius:18px;padding:18px 18px 14px 18px; box-shadow:0 6px 22px rgba(0,0,0,.35)}
  .header{display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
  .brand{
    display:flex; gap:14px; align-items:center;
  }
  .brand-logo{
    width:56px;height:56px;border-radius:12px;overflow:hidden;background:#222;border:1px solid rgba(212,175,55,.45);
    display:grid;place-items:center;
  }
  .brand-logo img{max-width:100%;max-height:100%;display:block}
  .brand-title{display:flex;flex-direction:column}
  .brand-name{font-weight:800;letter-spacing:.2rem;font-size:28px;line-height:1;margin:0}
  .brand-name span{display:block}
  .brand-addr{margin-top:8px;color:var(--muted);font-size:14px;line-height:1.35}
  .btns{display:flex;gap:12px;flex-wrap:wrap}
  button{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn-gold{background:var(--gold);color:#242424}
  .btn-dark{background:#232323;color:#e9e9e9;border:1px solid #2f2f2f}
  .btn-red{background:#8a1212;color:#fff}
  h2{margin:22px 0 10px 0;font-size:20px;letter-spacing:.06rem;color:var(--gold)}
  .section{margin-top:18px;background:var(--panel);border:1px solid #202020;border-radius:14px;padding:16px}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:2fr 1.2fr 1.2fr} }
  label{font-size:13px;color:var(--muted)}
  input,select,textarea{
    width:100%;background:#121212;color:#eaeaea;border:1px solid #2a2a2a;border-radius:12px;padding:12px;
    outline:none;transition:border .15s
  }
  input:focus,select:focus,textarea:focus{border-color:#3d3d3d}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{font-size:14px}
  th{color:var(--muted);font-weight:700;text-align:left;padding:4px 8px}
  td{padding:6px 8px}
  .tbl-row{background:#101010;border:1px solid #242424;border-radius:12px}
  .tbl-row input{background:#0f0f0f}
  .add-line{display:inline-block;margin-top:8px;border:1px dashed #666;padding:8px 10px;border-radius:10px;cursor:pointer}
  .totals{margin-top:10px;border-top:1px solid #303030;padding-top:12px}
  .totals .row{display:flex;justify-content:space-between;margin:4px 0}
  .totals .grand{font-size:22px;font-weight:800;color:var(--accent)}
  .waiver{background:var(--danger-bg);color:#222;border-left:6px solid var(--danger);border-radius:12px;padding:14px}
  .sig-wrap{display:grid;gap:14px}
  @media(min-width:720px){ .sig-wrap{grid-template-columns:1fr 1fr} }
  .sig{background:#0f0f0f;border:1px dashed #555;border-radius:12px;height:180px;position:relative}
  .sig label{position:absolute;top:8px;left:12px;color:#aaa}
  .sig canvas{width:100%;height:100%}
  .mini{font-size:12px;color:#9aa0a6}
  .footer-note{margin-top:18px;color:#8c8c8c;font-size:12px;text-align:center}
  .hide-text{position:absolute;left:-9999px}
</style>
</head>
<body>
<div class="wrap" id="capture">
  <!-- HEADER -->
  <div class="card">
    <div class="header">
      <div class="brand">
        <div class="brand-logo">
          <img src="./warmupuklogo.jpg" alt="Warm Up UK logo" onerror="this.style.display='none'">
        </div>
        <div class="brand-title">
          <!-- Visible big text removed per request; keep small hidden for accessibility -->
          <h1 class="hide-text">WARM UP UK</h1>
          <div class="brand-addr">
            321–323 Romford High Road, Essex, RM6 6AX
          </div>
        </div>
      </div>
      <div class="btns">
        <button class="btn-gold" id="btnPdf">Generate PDF</button>
        <button class="btn-dark" id="btnWhatsApp">Send to WhatsApp</button>
        <button class="btn-dark" id="btnReset">Reset Form</button>
      </div>
    </div>
  </div>

  <!-- CUSTOMER -->
  <div class="section">
    <h2>Customer</h2>
    <div class="grid grid-2">
      <div><label>Customer Name</label><input id="custName" placeholder="Full name"></div>
      <div><label>Phone (WhatsApp)</label><input id="custPhone" placeholder="07..."></div>
      <div><label>Email</label><input id="custEmail" type="email" placeholder="name@email.com"></div>
      <div><label>Install / Survey Date</label><input id="date" type="date"></div>
      <div><label>Address Line 1</label><input id="addr1" placeholder="Street & number"></div>
      <div><label>Town / City</label><input id="city" placeholder="Town / City"></div>
      <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX"></div>
      <div><label>Job Type</label>
        <select id="jobType">
          <option>Loft Insulation</option>
          <option>Pitched Roof Insulation</option>
          <option>Cavity Wall Insulation</option>
          <option>Spray Foam Removal</option>
          <option>Loft Boarding</option>
        </select>
      </div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div class="section">
    <h2>Products & Pricing</h2>
    <table id="linesTbl">
      <thead>
        <tr>
          <th style="width:25%">Product</th>
          <th>Description</th>
          <th style="width:90px">Qty</th>
          <th style="width:120px">Unit (£)</th>
          <th style="width:120px">Line Total (£)</th>
          <th style="width:44px"></th>
        </tr>
      </thead>
      <tbody id="linesBody"></tbody>
    </table>
    <a class="add-line" id="addLine">+ Add line</a>

    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
      <div class="row"><span>Admin Fee (fixed)</span><span id="adminFee">£150.00</span></div>
      <div class="row">
        <span><label><input type="checkbox" id="vatToggle"> Add VAT (20%)</label></span>
        <span id="vat">£0.00</span>
      </div>
      <div class="row grand"><span>Total</span><span id="grand">£0.00</span></div>
      <div class="mini">All prices in GBP. Figures auto-update.</div>
    </div>
  </div>

  <!-- WAIVER -->
  <div class="section">
    <h2>Express Waiver (Optional)</h2>
    <div class="waiver">
      <label><input type="checkbox" id="waiverCheck"> I accept the Express Waiver and request an expedited installation/survey.</label>
      <p class="mini">By checking this box, the customer asks us to begin work before the cooling-off period ends.</p>
    </div>
  </div>

  <!-- SIGNATURES -->
  <div class="section">
    <h2>Signatures</h2>
    <div class="sig-wrap">
      <div>
        <div class="sig" id="sigCustomer"><label>Customer Signature</label><canvas></canvas></div>
        <div class="mini"><button class="btn-dark" data-clear="#sigCustomer">Clear</button></div>
      </div>
      <div>
        <div class="sig" id="sigCompany"><label>Company Signature</label><canvas></canvas></div>
        <div class="mini"><button class="btn-dark" data-clear="#sigCompany">Clear</button></div>
      </div>
    </div>
  </div>

  <div class="footer-note">Warm Up UK • Company address: 321–323 Romford High Road, Essex, RM6 6AX</div>
</div>

<!-- libs for PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
  // ---------- util ----------
  const £ = s => document.querySelector(s);
  const ££ = s => Array.from(document.querySelectorAll(s));
  const fmt = n => "£" + (Number(n)||0).toFixed(2);

  // ---------- lines ----------
  const body = $('#linesBody');
  function lineTpl(){ 
    const tr = document.createElement('tr'); tr.className='tbl-row';
    tr.innerHTML = `
      <td><select class="p">
            <option>Loft Insulation</option>
            <option>Multifoil Insulation</option>
            <option>Spray Foam Removal</option>
            <option>Loft Boarding</option>
            <option>Other</option>
          </select></td>
      <td><input class="d" placeholder="Notes / m², depth, area"></td>
      <td><input class="q" type="number" min="0" step="1" value="1"></td>
      <td><input class="u" type="number" min="0" step="0.01" value="0"></td>
      <td class="lt">£0.00</td>
      <td><button class="btn-red" title="Delete">×</button></td>`;
    body.appendChild(tr);
    bindRow(tr);
    tot();
  }
  function bindRow(tr){
    const q=tr.querySelector('.q'), u=tr.querySelector('.u');
    q.addEventListener('input', tot); u.addEventListener('input', tot);
    tr.querySelector('button').onclick = () => { tr.remove(); tot(); };
  }
  $('#addLine').onclick = lineTpl;
  lineTpl(); // start with one row

  // ---------- totals ----------
  const ADMIN_FEE = 150;
  $('#vatToggle').addEventListener('change', tot);
  function tot(){
    let subtotal=0;
    ££('#linesBody tr').forEach(tr=>{
      const q=Number(tr.querySelector('.q').value)||0;
      const u=Number(tr.querySelector('.u').value)||0;
      const lt = q*u; subtotal += lt;
      tr.querySelector('.lt').textContent = fmt(lt);
    });
    const vatOn = $('#vatToggle').checked;
    const vat = vatOn ? (subtotal+ADMIN_FEE)*0.20 : 0;
    $('#subtotal').textContent = fmt(subtotal);
    $('#adminFee').textContent = fmt(ADMIN_FEE);
    $('#vat').textContent = fmt(vat);
    $('#grand').textContent = fmt(subtotal+ADMIN_FEE+vat);
  }

  // ---------- signatures ----------
  function makePad(rootSel){
    const root = document.querySelector(rootSel);
    const canvas = root.querySelector('canvas');
    const ctx = canvas.getContext('2d');
    function size(){ canvas.width = root.clientWidth; canvas.height = root.clientHeight; ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#e8e8e8'; }
    size(); addEventListener('resize', size);
    let drawing=false, lx=0, ly=0;
    function start(x,y){ drawing=true; lx=x; ly=y; }
    function draw(x,y){ if(!drawing) return; ctx.beginPath(); ctx.moveTo(lx,ly); ctx.lineTo(x,y); ctx.stroke(); lx=x; ly=y; }
    function end(){ drawing=false; }
    canvas.addEventListener('mousedown',e=>start(e.offsetX,e.offsetY));
    canvas.addEventListener('mousemove',e=>draw(e.offsetX,e.offsetY));
    addEventListener('mouseup',end);
    canvas.addEventListener('touchstart',e=>{ const r=canvas.getBoundingClientRect(); const t=e.touches[0]; start(t.clientX-r.left,t.clientY-r.top)},{passive:true});
    canvas.addEventListener('touchmove',e=>{ const r=canvas.getBoundingClientRect(); const t=e.touches[0]; draw(t.clientX-r.left,t.clientY-r.top)},{passive:true});
    canvas.addEventListener('touchend',end);
    return { clear:()=>ctx.clearRect(0,0,canvas.width,canvas.height), toDataURL:()=>canvas.toDataURL('image/png') };
  }
  const padCustomer = makePad('#sigCustomer');
  const padCompany  = makePad('#sigCompany');
  ££('[data-clear]').forEach(b=>b.onclick=()=>{ const p=b.getAttribute('data-clear'); (p.includes('Customer')?padCustomer:padCompany).clear(); });

  // ---------- WhatsApp ----------
  $('#btnWhatsApp').onclick = ()=>{
    const name = $('#custName').value || 'Customer';
    const total = $('#grand').textContent;
    const addr = `${$('#addr1').value}, ${$('#city').value}, ${$('#postcode').value}`.replaceAll(' ,','').trim();
    const job  = $('#jobType').value;
    const msg = `Warm Up UK Contract Summary%0A%0AName: ${encodeURIComponent(name)}%0AJob: ${encodeURIComponent(job)}%0AAddress: ${encodeURIComponent(addr)}%0ATotal: ${encodeURIComponent(total)}%0A%0AWe will share the full PDF shortly.`;
    const num = ($('#custPhone').value||'').replace(/\D/g,'');
    const url = num ? `https://wa.me/${num}?text=${msg}` : `https://wa.me/?text=${msg}`;
    window.open(url,'_blank');
  };

  // ---------- Reset ----------
  $('#btnReset').onclick = ()=>{
    document.querySelectorAll('input,textarea').forEach(el=>{
      if(el.type==='checkbox') el.checked=false;
      else el.value='';
    });
    $('#linesBody').innerHTML=''; lineTpl(); $('#vatToggle').checked=false; tot();
    padCustomer.clear(); padCompany.clear();
  };

  // ---------- PDF ----------
  $('#btnPdf').onclick = async ()=>{
    // render the card + sections into a PDF
    const { jsPDF } = window.jspdf;
    const node = document.getElementById('capture');
    const canvas = await html2canvas(node,{scale:2,backgroundColor:'#0f0f0f'});
    const img = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p','pt','a4');
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();
    const ratio = Math.min(pageW/canvas.width, pageH/canvas.height);
    const w = canvas.width*ratio, h = canvas.height*ratio;
    let y = 0;
    // if taller than page, split
    if(h<=pageH){
      pdf.addImage(img,'PNG', (pageW-w)/2, 10, w, h);
    }else{
      // slice vertically
      const pageCanvas = document.createElement('canvas');
      const ctx = pageCanvas.getContext('2d');
      const sliceH = Math.floor(canvas.width * (pageH / pageW)); // keep aspect
      pageCanvas.width = canvas.width; pageCanvas.height = sliceH;
      while(y<canvas.height){
        ctx.clearRect(0,0,pageCanvas.width,pageCanvas.height);
        ctx.drawImage(canvas,0,y,canvas.width,sliceH,0,0,canvas.width,sliceH);
        const part = pageCanvas.toDataURL('image/png');
        const ph = pageW*(sliceH/canvas.width);
        pdf.addImage(part,'PNG',0,0,pageW,ph);
        y += sliceH;
        if(y<canvas.height) pdf.addPage();
      }
    }
    pdf.save(`WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`);
  };

  // set default date today
  document.getElementById('date').valueAsDate = new Date();
</script>
</body>
</html>
