<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK • Contract Builder</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --gold:#d4af37;
    --gold-deep:#b18f2a;
    --black:#0e0e0f;
    --ink:#1b1b1d;
    --muted:#6b6b73;
    --card:#ffffff;
    --line:#e9eaee;
    --danger:#ff2d2d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#fff;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif}
  .wrap{max-width:980px;margin:20px auto;padding:16px}
  .header{
    background:var(--black);
    color:#fff;
    border-radius:18px;
    padding:18px;
    display:grid;
    grid-template-columns:88px 1fr auto auto;
    gap:16px;
    align-items:center;
    border:1px solid rgba(212,175,55,.35);
  }
  .brand-logo{
    width:88px;height:88px;border-radius:14px;display:block;object-fit:cover;object-position:center;background:#fff;
  }
  .addr{line-height:1.3}
  .addr b{display:block;font-size:18px;margin-bottom:4px}
  .addr small{display:block;color:#d7d7db;margin-top:4px}

  .btn{
    background:var(--gold);
    border:none;color:#111;font-weight:700;
    padding:12px 16px;border-radius:12px;cursor:pointer;
    box-shadow:0 2px 0 var(--gold-deep);
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#2c2c31;color:#fff;box-shadow:0 2px 0 #1e1e22}

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;padding:18px;margin-top:18px;
  }
  .title{font-weight:800;color:var(--gold);font-size:28px;margin:6px 0 14px}

  label{font-weight:600;color:#333;display:block;margin:8px 0 6px}
  input[type=text], input[type=tel], input[type=email], input[type=date], textarea{
    width:100%;border:1px solid var(--line);border-radius:12px;
    padding:14px 12px;font-size:16px;background:#fff;
  }
  textarea{min-height:110px;resize:vertical}

  /* Products table */
  .table{width:100%;border-collapse:separate;border-spacing:12px 8px}
  .table th{font-size:14px;color:#666;text-transform:uppercase;letter-spacing:.03em;text-align:left}
  .table input{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;font-size:16px}
  .row-actions{display:flex;align-items:center;gap:8px}
  .add-line{display:inline-flex;align-items:center;justify-content:center;
    width:44px;height:44px;border-radius:12px;border:1px dashed var(--ink);background:#fff;cursor:pointer;font-weight:900}
  .remove-line{width:44px;height:44px;border-radius:12px;border:0;background:#000;color:#fff;font-size:20px;cursor:pointer}

  .toggles{display:flex;gap:16px;align-items:center;margin:8px 0 12px}
  .toggle{display:flex;gap:10px;align-items:center;background:#fff;border:1px solid var(--line);padding:10px 12px;border-radius:12px}
  .totals{border-top:2px solid #111;padding-top:10px;margin-top:8px}
  .totals .row{display:flex;justify-content:space-between;margin:6px 0}
  .grand{font-size:28px;font-weight:900;color:var(--gold)}

  /* Terms */
  .tcs ol{margin:6px 0 0 20px}
  .tcs li{margin:8px 0}

  /* Waiver */
  .waiver-box{border:2px solid #e54;border-radius:12px;padding:14px;background:#fff7f7;margin-top:10px}
  .flash{animation:flash-red .8s linear 7;} /* ≈ 5.6s, we’ll also remove after 6s with JS */
  @keyframes flash-red{
    0%,100%{box-shadow:0 0 0 0 rgba(255,45,45,0)}
    50%{box-shadow:0 0 0 6px rgba(255,45,45,.35)}
  }

  /* Signatures */
  .sigs{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .sig-card{border:1px dashed #b9bcc6;border-radius:12px;padding:8px}
  .sig-card h4{margin:6px 0 10px}
  .sig-wrap{background:#fff;height:180px;border:1px dashed #cfd3dc;border-radius:10px;overflow:hidden}
  canvas{width:100%;height:100%}
  .sig-actions{display:flex;gap:10px;margin-top:8px}
  .avoid-break{page-break-inside:avoid;break-inside:avoid}

  @media (max-width:720px){
    .header{grid-template-columns:72px 1fr auto auto}
    .brand-logo{width:72px;height:72px}
    .sigs{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div class="header">
    <img src="warmupuklogo.jpg" alt="Warm Up UK" class="brand-logo" />
    <div class="addr">
      <b>WARM UP UK</b>
      321–323 Romford High Road, Essex, RM6 6AX
      <small>Office: 01708 300670</small>
    </div>
    <button class="btn" id="btnPdf">Generate PDF</button>
    <button class="btn secondary" id="btnReset">Reset Form</button>
  </div>

  <!-- Customer -->
  <div class="card">
    <div class="title">Customer</div>
    <label>Customer Name</label>
    <input id="custName" type="text" placeholder="Full name">

    <label>Phone (WhatsApp)</label>
    <input id="custPhone" type="tel" placeholder="07...">

    <label>Email</label>
    <input id="custEmail" type="email" placeholder="name@email.com">

    <label>Install / Survey Date</label>
    <input id="installDate" type="date">

    <label>Address Line 1</label>
    <input id="addr1" type="text" placeholder="Street & number">

    <label>Town / City</label>
    <input id="town" type="text" placeholder="Town / City">

    <label>Postcode</label>
    <input id="postcode" type="text" placeholder="e.g. RM6 6AX">

    <label>Order Notes (optional)</label>
    <textarea id="notes" placeholder="Special instructions / access, preferred days, etc."></textarea>
  </div>

  <!-- Products -->
  <div class="card" id="productsCard">
    <div class="title">Products &amp; Pricing</div>
    <table class="table" id="lines">
      <thead>
        <tr>
          <th style="width:36%">Item</th>
          <th style="width:16%">m²</th>
          <th style="width:18%">£ / Unit</th>
          <th style="width:18%">Line Total (£)</th>
          <th style="width:12%"></th>
        </tr>
      </thead>
      <tbody id="lineBody"></tbody>
    </table>

    <div class="row-actions">
      <button class="add-line" id="addLine" title="Add line">+</button>
      <div class="toggles">
        <label class="toggle">
          <input id="incAdmin" type="checkbox" checked>
          <span>Include admin fee (£150)</span>
        </label>
        <label class="toggle">
          <input id="addVAT" type="checkbox">
          <span>Add VAT (20%)</span>
        </label>
      </div>
    </div>

    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subtot">£0.00</span></div>
      <div class="row"><span>Admin Fee</span><span id="admin">£150.00</span></div>
      <div class="row"><span>VAT</span><span id="vat">£0.00</span></div>
      <div class="row grand"><span>Total</span><span id="grand">£150.00</span></div>
      <div style="color:#7a7d86;margin-top:6px;font-size:13px">All prices in GBP. Figures auto-update.</div>
    </div>
  </div>

  <!-- Terms -->
  <div class="card tcs">
    <div class="title">Terms &amp; Conditions (Summary)</div>
    <ol>
      <li>All quotes are valid for 30 days unless stated otherwise.</li>
      <li>Access to the work area, clear of personal belongings, is required.</li>
      <li>Balance due on completion unless a different schedule is agreed in writing.</li>
      <li>Manufacturer warranties apply to materials; workmanship warranty per contract.</li>
      <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
      <li>Prices are subject to survey and may change if scope varies.</li>
      <li>Waste removal and site cleanliness included unless noted otherwise.</li>
      <li>Customer confirms they have authority to approve the works.</li>
    </ol>
  </div>

  <!-- Waiver + Signatures (kept together for PDF) -->
  <div class="card avoid-break" id="signingBlock">
    <div class="title">Express Waiver (Optional)</div>
    <label style="display:flex;align-items:center;gap:10px;">
      <input id="waiverTick" type="checkbox">
      <span>I accept the Express Waiver</span>
    </label>
    <div id="waiverBox" class="waiver-box">
      By selecting the Express Waiver, I request works to commence at my property
      without the standard cooling-off period. I acknowledge that once works begin,
      I may be liable for reasonable costs if I later cancel.
    </div>

    <div class="title" style="margin-top:18px">Signatures</div>
    <div class="sigs">
      <div class="sig-card">
        <h4>Customer Signature</h4>
        <div class="sig-wrap"><canvas id="sigCustomer"></canvas></div>
        <div class="sig-actions">
          <button class="btn secondary" id="clearCust">Clear</button>
        </div>
      </div>
      <div class="sig-card">
        <h4>Company Signature</h4>
        <div class="sig-wrap"><canvas id="sigCompany"></canvas></div>
        <div class="sig-actions">
          <button class="btn secondary" id="clearComp">Clear</button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Libraries -->
<script src="https://unpkg.com/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
  /* ---------- Product lines ---------- */
  const lineBody = document.getElementById('lineBody');
  const addLineBtn = document.getElementById('addLine');

  function money(n){ return '£' + (Number(n||0)).toFixed(2); }

  function makeRow(){
    const tr = document.createElement('tr');

    const tdItem = document.createElement('td');
    const tdM2   = document.createElement('td');
    const tdUnit = document.createElement('td');
    const tdTot  = document.createElement('td');
    const tdX    = document.createElement('td');

    const item = document.createElement('input'); item.type='text'; item.placeholder='Item';
    const m2   = document.createElement('input'); m2.type='number'; m2.min='0'; m2.step='0.01'; m2.placeholder='0';
    const unit = document.createElement('input'); unit.type='number'; unit.min='0'; unit.step='0.01'; unit.placeholder='0';
    const total= document.createElement('input'); total.type='text'; total.readOnly=true;

    const del  = document.createElement('button'); del.className='remove-line'; del.textContent='×';

    [item,m2,unit].forEach(el=>el.addEventListener('input',recalc));

    del.addEventListener('click',()=>{ tr.remove(); recalc(); });

    tdItem.appendChild(item);
    tdM2.appendChild(m2);
    tdUnit.appendChild(unit);
    tdTot.appendChild(total);
    tdX.appendChild(del);

    tr.append(tdItem,tdM2,tdUnit,tdTot,tdX);
    lineBody.appendChild(tr);
  }

  addLineBtn.addEventListener('click', makeRow);

  /* ---------- Totals ---------- */
  const incAdmin = document.getElementById('incAdmin');
  const addVAT   = document.getElementById('addVAT');

  const subtotEl = document.getElementById('subtot');
  const adminEl  = document.getElementById('admin');
  const vatEl    = document.getElementById('vat');
  const grandEl  = document.getElementById('grand');

  [incAdmin, addVAT].forEach(cb=>cb.addEventListener('change', recalc));

  function recalc(){
    let subtotal = 0;
    [...lineBody.querySelectorAll('tr')].forEach(tr=>{
      const m2   = parseFloat(tr.children[1].querySelector('input').value)||0;
      const unit = parseFloat(tr.children[2].querySelector('input').value)||0;
      const line = m2 * unit;
      tr.children[3].querySelector('input').value = line.toFixed(2);
      subtotal += line;
    });

    const admin = incAdmin.checked ? 150 : 0;
    const v = addVAT.checked ? 0.20*(subtotal+admin) : 0;

    subtotEl.textContent = money(subtotal);
    adminEl.textContent  = money(admin);
    vatEl.textContent    = money(v);
    grandEl.textContent  = money(subtotal + admin + v);
  }

  /* ---------- First row by default ---------- */
  makeRow(); recalc();

  /* ---------- Waiver flash ---------- */
  const waiverTick = document.getElementById('waiverTick');
  const waiverBox  = document.getElementById('waiverBox');
  waiverTick.addEventListener('change', ()=>{
    if(waiverTick.checked){
      waiverBox.classList.add('flash');
      setTimeout(()=>waiverBox.classList.remove('flash'), 6000);
    }else{
      waiverBox.classList.remove('flash');
    }
  });

  /* ---------- Signatures ---------- */
  const custPad = new SignaturePad(document.getElementById('sigCustomer'), {backgroundColor:'#fff', penColor:'#111'});
  const compPad = new SignaturePad(document.getElementById('sigCompany'), {backgroundColor:'#fff', penColor:'#111'});

  function resizePads(){
    [custPad, compPad].forEach(p=>{
      const canvas = p.canvas;
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width  = canvas.offsetWidth  * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      canvas.getContext("2d").scale(ratio, ratio);
      p.clear();
    });
  }
  window.addEventListener('resize', resizePads);
  resizePads();

  document.getElementById('clearCust').onclick = ()=>custPad.clear();
  document.getElementById('clearComp').onclick = ()=>compPad.clear();

  /* ---------- Reset ---------- */
  document.getElementById('btnReset').addEventListener('click', ()=>{
    document.querySelectorAll('input[type=text], input[type=tel], input[type=email], input[type=date], textarea')
      .forEach(i=>i.value='');

    lineBody.innerHTML=''; makeRow();
    incAdmin.checked = true; addVAT.checked = false;
    waiverTick.checked = false; waiverBox.classList.remove('flash');
    custPad.clear(); compPad.clear();
    recalc();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  /* ---------- PDF ---------- */
  document.getElementById('btnPdf').addEventListener('click', ()=>{
    // Temporarily stamp signature images under the pads so html2pdf captures them crisply
    const custImg = document.createElement('img');
    const compImg = document.createElement('img');
    custImg.src = custPad.isEmpty() ? '' : custPad.toDataURL('image/png');
    compImg.src = compPad.isEmpty() ? '' : compPad.toDataURL('image/png');
    custImg.style.width='100%'; custImg.style.height='180px'; custImg.style.objectFit='contain';
    compImg.style.width='100%'; compImg.style.height='180px'; compImg.style.objectFit='contain';

    const custWrap = document.getElementById('sigCustomer').parentElement;
    const compWrap = document.getElementById('sigCompany').parentElement;
    if(custImg.src) custWrap.appendChild(custImg);
    if(compImg.src) compWrap.appendChild(compImg);

    const opt = {
      margin:       8,
      filename:     'WarmUpUK-Contract.pdf',
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2, useCORS:true, letterRendering:true },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak:    { mode:['css','avoid-all'] }
    };
    html2pdf().set(opt).from(document.body).save().then(()=>{
      // Clean up stamped images
      if(custImg.parentNode) custImg.parentNode.removeChild(custImg);
      if(compImg.parentNode) compImg.parentNode.removeChild(compImg);
    });
  });
</script>
</body>
</html>
