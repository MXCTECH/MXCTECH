<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>WARM UP UK – Contract</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  :root{
    --brand:#000;
    --gold:#d4af37;
    --danger:#c30000;
    --line:#e6e6e6;
    --ink:#111;
    --muted:#666;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    margin:0; background:#f7f7f8; color:var(--ink);
    -webkit-font-smoothing:antialiased; overscroll-behavior:contain;
  }
  input,select,textarea,button{font-size:16px} /* avoid iOS zoom */

  .sheet{max-width:900px;margin:16px auto;padding:14px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.06)}
  header{
    display:grid; grid-template-columns:auto 1fr auto; gap:16px; align-items:center;
    border-bottom:1px solid var(--line); padding-bottom:12px;
  }
  header img.logo{ width:240px; height:auto; object-fit:contain; } /* ~3x bigger */
  .brandblock h1{ margin:0; font-size:28px; letter-spacing:.08em; }
  .brandblock .addr{ margin-top:6px; font-size:14px; line-height:1.35; color:#333; }
  .box{ background:#fafafa; border:1px solid var(--line); padding:10px; border-radius:8px; }
  .box label{ display:block; font-size:12px; color:#555; margin:6px 0 4px; }
  .box input, .box textarea, .box select{ width:100%; border:1px solid #ccc; border-radius:6px; padding:10px; }

  .section-title{ font-weight:800; margin:18px 0 10px; font-size:16px; }

  /* Customer area */
  .meta{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }

  /* Contract/date block (mobile: shows above customer name) */
  .contract-block{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .contract-block input{ background:#fff }

  /* Products list (mobile-first stacked rows) */
  .lines{ display:grid; gap:10px; }
  .line{ border:1px solid var(--line); border-radius:10px; padding:10px; background:#fafafa; }
  .line .prod{ margin-bottom:8px; }
  .line .row3{ display:grid; grid-template-columns:1fr; gap:8px; }
  .line .row3 .cell label{ display:block; font-size:12px; color:#555; margin-bottom:4px; }
  .line .row3 .cell input{ width:100%; border:1px solid #ccc; border-radius:6px; padding:10px; }
  .line .row3 .cell input[readonly]{ background:#f2f2f2; font-weight:700; }

  /* On wider screens, put the three inputs in a row */
  @media (min-width:700px){
    .line .row3{ grid-template-columns: 1fr 1fr 1fr; }
  }

  .controls{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 6px; }
  button{ border:0; padding:12px 14px; border-radius:10px; cursor:pointer; font-weight:800; }
  .btn{ background:#111; color:#fff; }
  .btn.gold{ background:var(--gold); color:#111; }
  .btn.secondary{ background:#333; color:#fff; }
  .btn.danger{ background:var(--danger); color:#fff; }
  button:disabled{ opacity:.6; cursor:not-allowed; }

  /* Totals panel right under lines (to keep on page 1) */
  .totals{ border:1px solid var(--line); border-radius:10px; padding:10px; background:#fff; }
  .totals .row{ display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px dashed #e3e3e3; }
  .totals .row:last-child{ border-bottom:none; }
  .totals .row strong{ font-weight:800; }
  .grand{ font-size:18px; font-weight:900; }
  .fine{ font-size:12px; color:var(--muted); }

  .notes, .waiver, .signatures{ border:1px solid var(--line); border-radius:10px; padding:12px; background:#fff; margin-top:12px; }
  .notes textarea{ width:100%; min-height:120px; }

  .waiver{ border-color:var(--danger); background:#fffafa; position:relative; }
  .waiver .flash{ position:absolute; top:8px; right:12px; font-weight:900; color:#fff; background:var(--danger); padding:4px 8px; border-radius:6px; animation:blink 1s infinite; }
  .waiver.ack .flash{ display:none; }
  @keyframes blink{ 0%,49%{opacity:1} 50%,100%{opacity:.25} }

  .signatures .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .sig{ border:1px dashed #bbb; border-radius:8px; padding:10px; background:#fafafa; }
  .sig label{ display:block; margin-bottom:6px; font-weight:700; }
  .sig canvas{ width:100%; height:200px; background:#fff; border:1px solid #ddd; border-radius:6px; touch-action:none; }
  .sig .under{ display:flex; gap:8px; align-items:center; margin-top:6px; }
  .sig .under input{ flex:1; border:1px solid #ccc; border-radius:6px; padding:10px; }
  .sig .under button{ padding:10px 12px; }

  @media (max-width:720px){
    header{ grid-template-columns:auto 1fr; }
    header .rightcol{ grid-column:1 / -1; }
    /* Move contract/date above customer on mobile */
    .mobile-contract{ grid-column:1 / -1; }
    .meta{ grid-template-columns:1fr; }
    .signatures .grid{ grid-template-columns:1fr; } /* stack signatures */
  }

  .footer-note{ text-align:center; font-size:12px; color:#777; margin-top:10px; }

  /* capture area for PDF page 1 */
  #page1{ padding:12px; }
</style>
</head>
<body>
  <div id="page1" class="sheet">
    <header>
      <img class="logo" src="warmupuklogo.jpg" alt="WARM UP UK logo" />
      <div class="brandblock">
        <h1>WARM UP UK</h1>
        <div class="addr">
          321-323 Romford High Road, Essex RM6 6AX<br />
          <strong>Tel:</strong> 01708 300670
        </div>
      </div>
      <div class="rightcol box" style="max-width:260px">
        <label>Contract #</label>
        <input id="contractNo" readonly />
        <label>Date</label>
        <input id="contractDate" readonly />
      </div>
    </header>

    <!-- MOBILE contract/date placement above customer name -->
    <div class="mobile-contract box" style="display:none">
      <div class="contract-block">
        <div>
          <label>Contract #</label>
          <input id="contractNo_m" readonly />
        </div>
        <div>
          <label>Date</label>
          <input id="contractDate_m" readonly />
        </div>
      </div>
    </div>

    <div class="section-title">Customer</div>
    <div class="meta">
      <div class="box">
        <label>Customer Name</label>
        <input id="custName" placeholder="Full name" />
        <label>Property Address</label>
        <textarea id="custAddr" rows="3" placeholder="House/Street, Town, Postcode"></textarea>
      </div>
      <div class="box">
        <label>Phone</label>
        <input id="custPhone" placeholder="07…" />
        <label>Email</label>
        <input id="custEmail" placeholder="email@example.com" />
      </div>
    </div>

    <div class="box" style="margin-top:12px">
      <label>Proposed Install Date</label>
      <input id="installDate" type="date" />
    </div>

    <div class="section-title">Products / Services</div>
    <div class="lines" id="lines"></div>
    <div class="controls">
      <button type="button" id="addLineBtn" class="btn gold">+ Add Row</button>
      <button type="button" id="removeLineBtn" class="btn gold">− Remove Last</button>
      <button type="button" id="clearLinesBtn" class="btn danger">Clear Lines</button>
    </div>

    <!-- Totals panel directly under product lines to keep on page 1 -->
    <div class="totals" id="totalsPanel">
      <div class="row"><div>Subtotal</div><div>£ <span id="subtotal">0.00</span></div></div>
      <div class="row"><div>Admin Fee</div><div>£ <span id="admin">150.00</span></div></div>
      <div class="row"><div>VAT (20%)</div><div>£ <span id="vat">0.00</span></div></div>
      <div class="row grand"><div>Grand Total</div><div><span id="grand">£150.00</span></div></div>
      <div class="row">
        <div>Less Deposit</div>
        <div style="display:flex; gap:8px; align-items:center">
          £ <input id="deposit" type="number" min="0" step="0.01" value="0" style="width:120px; text-align:right; border:1px solid #ccc; border-radius:6px; padding:8px">
        </div>
      </div>
      <div class="row"><div><strong>Balance Due</strong></div><div><strong id="balance">£150.00</strong></div></div>
      <div class="row" style="border-bottom:none">
        <div class="fine"><label><input type="checkbox" id="applyVAT" /> Apply VAT 20%</label></div>
        <div class="fine">Admin Fee of <strong>£150</strong> is automatically applied.</div>
      </div>
    </div>

    <div class="notes">
      <div class="section-title" style="margin-top:0">Notes</div>
      <textarea id="notes" placeholder="Any specific instructions or clarifications…"></textarea>
    </div>

    <div id="waiver" class="waiver">
      <div class="flash">ACTION REQUIRED</div>
      <div class="section-title" style="margin-top:0; color:var(--danger)">Express Waiver</div>
      <p style="margin:6px 0 10px">
        I request that WARM UP UK begins work before the end of my 14-day cooling-off period. I understand this may
        affect my right to cancel once the work has started and materials have been ordered or installed.
      </p>
      <label style="display:flex; gap:10px; align-items:center; font-weight:600;">
        <input type="checkbox" id="waiverAck" />
        I acknowledge and accept the Express Waiver.
      </label>
    </div>

    <div class="signatures">
      <div class="section-title" style="margin-top:0">Signatures</div>
      <div class="grid">
        <div class="sig">
          <label>Customer Signature</label>
          <canvas id="sigCustomer"></canvas>
          <div class="under">
            <input id="sigCustName" placeholder="Customer printed name" />
            <button type="button" class="btn secondary" data-clear="sigCustomer">Clear</button>
          </div>
        </div>
        <div class="sig">
          <label>Company Signature</label>
          <canvas id="sigCompany"></canvas>
          <div class="under">
            <input id="sigCompName" placeholder="Company representative" />
            <button type="button" class="btn secondary" data-clear="sigCompany">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="pdfBtn" type="button" class="btn" disabled>Generate PDF</button>
      <button id="clearBtn" type="button" class="btn danger">Clear Form</button>
    </div>

    <div class="footer-note">WARM UP UK • 321-323 Romford High Road, Essex RM6 6AX • 01708 300670</div>
  </div>

<script>
(function(){
  /* ---------- DATA ---------- */
  const PRODUCT_OPTIONS = [
    "Loft Insulation 270mm Fibreglass",
    "Multifoil YBS SuperQuilt",
    "Pitched Roof TLX Silver",
    "Cavity Wall Insulation",
    "Spray Foam Removal",
    "Loft Boarding",
    "Ventilation Upgrade",
    "Vermin Treatment",
    "Timber Treatment"
  ];
  const ADMIN_FEE = 150;
  const VAT_RATE  = 0.20;

  /* ---------- EL REFS ---------- */
  const linesEl = document.getElementById('lines');
  const addLineBtn = document.getElementById('addLineBtn');
  const removeLineBtn = document.getElementById('removeLineBtn');
  const clearLinesBtn = document.getElementById('clearLinesBtn');

  const subtotalEl = document.getElementById('subtotal');
  const adminEl    = document.getElementById('admin');
  const vatEl      = document.getElementById('vat');
  const grandEl    = document.getElementById('grand');
  const balanceEl  = document.getElementById('balance');
  const depositEl  = document.getElementById('deposit');
  const vatTick    = document.getElementById('applyVAT');

  const waiverEl   = document.getElementById('waiver');
  const waiverAck  = document.getElementById('waiverAck');
  const pdfBtn     = document.getElementById('pdfBtn');
  const clearBtn   = document.getElementById('clearBtn');

  const contractNo = document.getElementById('contractNo');
  const contractDate = document.getElementById('contractDate');
  const contractNo_m = document.getElementById('contractNo_m');
  const contractDate_m = document.getElementById('contractDate_m');

  const custName = document.getElementById('custName');
  const custAddr = document.getElementById('custAddr');
  const custPhone= document.getElementById('custPhone');
  const custEmail= document.getElementById('custEmail');
  const notes    = document.getElementById('notes');
  const installDate = document.getElementById('installDate');

  /* ---------- HELPERS ---------- */
  function currency(n){ return "£" + (Number(n||0).toFixed(2)); }
  function num(v){ const n=parseFloat(v); return isNaN(n)?0:n; }
  function ukDateString(d){
    const pad=n=>String(n).padStart(2,'0');
    return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()}`;
  }
  function isoDateInput(d){
    const pad=n=>String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }
  function genContractNo(){
    const d=new Date(); const p=n=>String(n).padStart(2,'0');
    return `WUU-${String(d.getFullYear()).slice(-2)}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}-${Math.floor(1000+Math.random()*8999)}`;
  }

  /* ---------- INIT CONTRACT / DATES ---------- */
  function initMeta(){
    const d=new Date();
    const no = genContractNo();
    const dsUK = ukDateString(d);
    contractNo.value = no; contractDate.value = dsUK;
    if(contractNo_m){ contractNo_m.value = no; }
    if(contractDate_m){ contractDate_m.value = dsUK; }
    installDate.value = isoDateInput(d);
  }
  initMeta();

  /* Show the small mobile contract bar when the header condenses */
  function updateMobileHeader(){
    const isMobile = window.innerWidth <= 720;
    document.querySelector('.mobile-contract').style.display = isMobile ? 'block' : 'none';
    if(isMobile){
      contractNo_m.value = contractNo.value;
      contractDate_m.value = contractDate.value;
    }
  }
  updateMobileHeader();
  window.addEventListener('resize', updateMobileHeader);

  /* ---------- PRODUCT LINE BUILDER (stacked mobile layout) ---------- */
  function makeSelect(){
    const sel = document.createElement('select');
    sel.innerHTML = `<option value="" disabled selected>Choose a product…</option>` +
      PRODUCT_OPTIONS.map(p=>`<option value="${p}">${p}</option>`).join('');
    sel.style.width = '100%';
    sel.style.border = '1px solid #ccc';
    sel.style.borderRadius = '6px';
    sel.style.padding = '10px';
    return sel;
  }

  function makeLine(){
    const wrap = document.createElement('div');
    wrap.className = 'line';

    // Product dropdown banner
    const prod = document.createElement('div');
    prod.className = 'prod';
    const sel = makeSelect();
    prod.appendChild(sel);

    // Stacked inputs under the select (mobile-friendly)
    const row3 = document.createElement('div');
    row3.className = 'row3';

    const cQty = document.createElement('div');
    cQty.className = 'cell';
    cQty.innerHTML = `<label>Quantity</label><input type="number" min="0" step="1" value="0">`;

    const cUnit = document.createElement('div');
    cUnit.className = 'cell';
    cUnit.innerHTML = `<label>Unit £</label><input type="number" min="0" step="0.01" value="0">`;

    const cTot = document.createElement('div');
    cTot.className = 'cell';
    cTot.innerHTML = `<label>Line Total</label><input type="text" value="£0.00" readonly>`;

    row3.append(cQty, cUnit, cTot);
    wrap.append(prod, row3);

    const qtyI  = cQty.querySelector('input');
    const unitI = cUnit.querySelector('input');
    const totI  = cTot.querySelector('input');

    function recalcLine(){
      const q = num(qtyI.value), u = num(unitI.value);
      totI.value = currency(q*u);
      recalcTotals();
    }
    qtyI.addEventListener('input', recalcLine);
    unitI.addEventListener('input', recalcLine);

    return wrap;
  }

  function addLine(){ linesEl.appendChild(makeLine()); recalcTotals(); }
  function removeLine(){ if(linesEl.lastElementChild){ linesEl.lastElementChild.remove(); recalcTotals(); } }
  function clearLines(){ linesEl.innerHTML=''; recalcTotals(); }

  addLineBtn.addEventListener('click', addLine);
  removeLineBtn.addEventListener('click', removeLine);
  clearLinesBtn.addEventListener('click', ()=>{ if(confirm('Clear all product lines?')){ clearLines(); addLine(); } });

  // Start with three rows (as you’ve been using)
  addLine(); addLine(); addLine();

  /* ---------- TOTALS ---------- */
  function getSubtotal(){
    let s = 0;
    linesEl.querySelectorAll('.line').forEach(line=>{
      const q = num(line.querySelector('.cell:nth-child(1) input').value);
      const u = num(line.querySelector('.cell:nth-child(2) input').value);
      s += q*u;
    });
    return s;
  }

  function recalcTotals(){
    const subtotal = getSubtotal();
    const admin = ADMIN_FEE;
    const vat = vatTick.checked ? (subtotal + admin) * VAT_RATE : 0;
    const grand = subtotal + admin + vat;
    const deposit = num(depositEl.value);
    const balance = Math.max(grand - deposit, 0);

    subtotalEl.textContent = subtotal.toFixed(2);
    adminEl.textContent = admin.toFixed(2);
    vatEl.textContent = vat.toFixed(2);
    grandEl.textContent = "£" + grand.toFixed(2);
    balanceEl.textContent = "£" + balance.toFixed(2);
  }
  vatTick.addEventListener('change', recalcTotals);
  depositEl.addEventListener('input', recalcTotals);

  /* ---------- SIGNATURES (robust, preserve on rotate) ---------- */
  function makePad(canvas){
    const ctx = canvas.getContext('2d');
    let drawing=false, lastX=0, lastY=0;

    function resizeKeep(){
      // preserve current bitmap
      const old = document.createElement('canvas');
      old.width = canvas.width; old.height = canvas.height;
      old.getContext('2d').drawImage(canvas,0,0);

      const dpr = Math.max(window.devicePixelRatio||1,1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.round(rect.width * dpr);
      canvas.height= Math.round(rect.height* dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#000';
      // redraw preserved
      ctx.drawImage(old,0,0,old.width,old.height,0,0,canvas.width,canvas.height);
    }

    function pos(e){
      const r=canvas.getBoundingClientRect();
      if(e.touches && e.touches[0]) return {x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top};
      return {x:e.clientX-r.left,y:e.clientY-r.top};
    }
    function lockScroll(lock){ document.body.style.overflow = lock ? 'hidden' : ''; }

    function start(e){ drawing=true; lockScroll(true); const p=pos(e); lastX=p.x; lastY=p.y; e.preventDefault();}
    function move(e){ if(!drawing) return; const p=pos(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(p.x,p.y); ctx.stroke(); lastX=p.x; lastY=p.y; e.preventDefault();}
    function end(){ drawing=false; lockScroll(false); }

    // init
    resizeKeep();
    window.addEventListener('resize', resizeKeep);
    window.addEventListener('orientationchange', ()=>setTimeout(resizeKeep, 150));

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', move);
    window.addEventListener('mouseup', end);
    canvas.addEventListener('touchstart', start, {passive:false});
    canvas.addEventListener('touchmove', move, {passive:false});
    window.addEventListener('touchend', end);

    return {
      clear(){ ctx.clearRect(0,0,canvas.width,canvas.height); resizeKeep(); },
      data(){ return canvas.toDataURL('image/png'); }
    }
  }

  const sigCustomerPad = makePad(document.getElementById('sigCustomer'));
  const sigCompanyPad  = makePad(document.getElementById('sigCompany'));
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id=btn.getAttribute('data-clear');
      (id==='sigCustomer'?sigCustomerPad:sigCompanyPad).clear();
    });
  });

  /* ---------- WAIVER GATE ---------- */
  function updateWaiverGate(){
    if(waiverAck.checked){ waiverEl.classList.add('ack'); pdfBtn.disabled=false; }
    else { waiverEl.classList.remove('ack'); pdfBtn.disabled=true; }
  }
  waiverAck.addEventListener('change', updateWaiverGate);
  updateWaiverGate();

  /* ---------- CLEAR FORM ---------- */
  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Clear all fields?')) return;
    [custName,custAddr,custPhone,custEmail,notes].forEach(i=>i.value='');
    linesEl.innerHTML=''; addLine(); addLine(); addLine();
    vatTick.checked=false; depositEl.value="0"; recalcTotals();
    sigCustomerPad.clear(); sigCompanyPad.clear();
    document.getElementById('sigCustName').value='';
    document.getElementById('sigCompName').value='';
    initMeta();
    updateMobileHeader();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  /* ---------- PDF (page1 capture + programmatic page2) ---------- */
  function bakeSignaturesForPDF(){
    // swap canvases for images for page1 capture
    const swaps=[];
    document.querySelectorAll('.signatures canvas').forEach(cv=>{
      const img=document.createElement('img');
      img.src = cv.toDataURL('image/png');
      img.style.width = getComputedStyle(cv).width;
      img.style.height= getComputedStyle(cv).height;
      img.style.border = cv.style.border; img.style.borderRadius=cv.style.borderRadius;
      cv.parentNode.insertBefore(img, cv);
      cv.style.display='none';
      swaps.push({cv,img});
    });
    return ()=>{ swaps.forEach(({cv,img})=>{ img.remove(); cv.style.display=''; }); };
  }

  async function generatePDF(){
    if(!waiverAck.checked){ alert('Please acknowledge the Express Waiver before generating the PDF.'); return; }
    recalcTotals();

    const restore = bakeSignaturesForPDF();
    const node = document.getElementById('page1');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({unit:'mm', format:'a4', orientation:'p'});
    const a4w = pdf.internal.pageSize.getWidth();
    const a4h = pdf.internal.pageSize.getHeight();

    // Ensure full height capture
    const canvas = await html2canvas(node, {
      scale:2, useCORS:true, backgroundColor:'#ffffff',
      windowWidth: node.scrollWidth, windowHeight: node.scrollHeight
    });
    restore();

    // Slice page1 across pages if tall
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const mmPerPx = a4w / canvas.width;
    let topPx = 0; const pageHeightPx = a4h / mmPerPx;
    let first = true;
    while(topPx < canvas.height){
      const sliceHeightPx = Math.min(pageHeightPx, canvas.height - topPx);
      const pageCanvas = document.createElement('canvas');
      pageCanvas.width = canvas.width; pageCanvas.height = sliceHeightPx;
      const ctx = pageCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, topPx, canvas.width, sliceHeightPx, 0, 0, canvas.width, sliceHeightPx);
      const pageImg = pageCanvas.toDataURL('image/jpeg', 0.95);
      if(!first) pdf.addPage();
      pdf.addImage(pageImg, 'JPEG', 0, 0, a4w, sliceHeightPx*mmPerPx);
      first = false; topPx += sliceHeightPx;
    }

    // Page 2: Terms & Conditions + signatures (programmatic layout)
    pdf.addPage();
    const left = 14, right = a4w - 14;
    let y = 16;
    pdf.setFont('helvetica','bold'); pdf.setFontSize(14);
    pdf.text('Terms & Conditions (Summary)', left, y); y += 8;
    pdf.setFont('helvetica','normal'); pdf.setFontSize(11);

    const terms = [
      "1. All works to be carried out by or on behalf of WARM UP UK to agreed specification.",
      "2. Customer responsible for providing safe access to all work areas.",
      "3. Any unforeseen remedial works (e.g., rotten timbers, vermin damage) will be quoted separately.",
      "4. Electrical/ventilation upgrades, if required by building guidance, may be chargeable.",
      "5. Payment terms: unless otherwise stated, balance due on completion.",
      "6. Materials remain property of WARM UP UK until paid in full.",
      "7. Cancellations within 14 days are subject to statutory rights; bespoke materials may incur charges.",
      "8. By signing, the customer confirms accuracy of details and authorises the work as described.",
      "9. VAT: Charged where applicable at the prevailing rate if selected/required.",
      "10. Dispute resolution: Contact us in writing; we aim to resolve issues promptly and fairly."
    ];
    const width = right - left;
    terms.forEach(t=>{
      const lines = pdf.splitTextToSize(t, width);
      pdf.text(lines, left, y);
      y += 7 + (lines.length-1)*5;
    });

    // Signature images & names under T&Cs
    y += 6;
    pdf.setFont('helvetica','bold'); pdf.text('Signatures', left, y); y += 6;
    const custSig = sigCustomerPad.data();
    const compSig = sigCompanyPad.data();
    const sigW = (width - 10) / 2; // two boxes side-by-side
    const sigH = 28;

    // Boxes
    pdf.setFont('helvetica','normal'); pdf.setFontSize(10);
    pdf.text('Customer:', left, y-1);
    pdf.text('Company:', left + sigW + 10, y-1);
    // images
    if(custSig) pdf.addImage(custSig, 'PNG', left, y, sigW, sigH);
    if(compSig) pdf.addImage(compSig, 'PNG', left + sigW + 10, y, sigW, sigH);
    y += sigH + 6;

    // printed names
    const nameCust = (document.getElementById('sigCustName').value||'').trim();
    const nameComp = (document.getElementById('sigCompName').value||'').trim();
    pdf.text(`Printed: ${nameCust||'________________'}`, left, y);
    pdf.text(`Printed: ${nameComp||'________________'}`, left + sigW + 10, y);

    pdf.save(`${contractNo.value || 'WarmUpUK_Contract'}.pdf`);
  }
  document.getElementById('pdfBtn').addEventListener('click', generatePDF);

  /* ---------- ENABLE PDF WHEN WAIVER TICKED ---------- */
  function syncPDFEnable(){ pdfBtn.disabled = !waiverAck.checked; }
  waiverAck.addEventListener('change', syncPDFEnable);

  /* ---------- RECALC ON INPUTS ---------- */
  linesEl.addEventListener('input', recalcTotals);
  recalcTotals();
})();
</script>
</body>
</html>
