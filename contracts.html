<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK • Contract Builder</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #ffffff;                /* page is white */
    --card: #ffffff;              /* cards also white */
    --ink: #101010;               /* primary text (near black) */
    --muted:#666;
    --gold:#d4af37;               /* warm gold */
    --gold-2:#c9a233;
    --line:#e8e8e8;
    --danger:#ffe9e9;
    --danger-line:#d63c3c;
  }

  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--bg);
    color:var(--ink);
    -webkit-font-smoothing:antialiased;
  }

  .wrap{
    max-width:980px;
    margin:auto;
    padding:16px;
  }

  /* Header card */
  .hero{
    background:linear-gradient(180deg,#111 0%, #171717 100%);
    color:#fff;
    border:1px solid rgba(212,175,55,.5);
    border-radius:18px;
    padding:18px;
    display:grid;
    grid-template-columns:110px 1fr auto;
    align-items:center;
    gap:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.16);
  }
  .brand{
    width:100%;
    height:110px;
    border-radius:12px;
    background:#000;
    display:flex;align-items:center;justify-content:center;
    border:1px solid rgba(212,175,55,.35);
    overflow:hidden;
  }
  .brand img{
    display:block;
    width:100%;
    height:100%;
    object-fit:cover;              /* fill the black box as requested */
    object-position:center;
  }
  .addr{
    color:#d7d7d7;
    font-weight:600;
    line-height:1.35;
  }
  .hero-actions{
    display:flex;flex-direction:column;gap:12px;
  }
  .btn{
    appearance:none;border:0;cursor:pointer;
    font-weight:700;font-size:16px;
    padding:12px 18px;border-radius:12px;
    transition:.15s transform ease, .15s box-shadow ease, .15s background-color ease;
    white-space:nowrap;
  }
  .btn:active{transform:translateY(1px)}
  .btn-gold{
    background:linear-gradient(180deg,var(--gold) 0%, var(--gold-2) 100%);
    color:#201a00;
    box-shadow:0 6px 16px rgba(212,175,55,.3);
  }
  .btn-dark{
    background:#232323;color:#fff;border:1px solid #2f2f2f;
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    padding:18px;
    margin-top:18px;
  }
  .card h2{
    margin:0 0 14px;
    font-size:22px;
    letter-spacing:.5px;
    color:#111;
  }

  label{display:block;font-weight:600;margin:10px 0 6px}
  input, select, textarea{
    width:100%;
    font:inherit;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid #dbdbdb;
    background:#fff;
    color:var(--ink);
    outline:none;
  }
  input:focus, select:focus, textarea:focus{border-color:var(--gold)}
  textarea{min-height:120px;resize:vertical}

  /* Products table */
  .table{
    width:100%;border-collapse:collapse;border-spacing:0;margin-top:8px
  }
  .table th,.table td{
    border-bottom:1px solid var(--line);
    padding:10px 8px;text-align:left;font-size:14px;
  }
  .table th{color:#222}
  .num{width:95px}
  .qty{width:80px}
  .product{min-width:180px}
  .desc{min-width:220px}
  .row-actions button{border:0;background:#f3f3f3;padding:6px 10px;border-radius:8px}
  .addline{
    margin:12px 0;border:1px dashed var(--gold);
    background:#fff7da;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer
  }

  .totals{
    margin-top:12px;border-top:2px solid #111;padding-top:8px
  }
  .totals .line{display:flex;justify-content:space-between;margin:6px 0;color:#444}
  .totals .grand{font-size:22px;font-weight:800;color:var(--gold);}

  .switch{
    display:flex;align-items:center;gap:8px;margin-top:10px;color:#222
  }

  /* Waiver */
  .waiver{
    position:relative;border:1px solid var(--danger-line);
    background:var(--danger);border-radius:12px;padding:14px
  }
  .waiver .bar{
    position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--danger-line);border-radius:12px 0 0 12px
  }

  /* Signatures */
  .sigs{display:grid;grid-template-columns:1fr;gap:16px}
  .sig{
    border:2px dashed #cfcfcf;border-radius:14px;background:#fff;
    height:180px;position:relative
  }
  .sig label{position:absolute;left:12px;top:10px;font-weight:700;color:#555}
  .sig canvas{position:absolute;left:0;top:0;width:100%;height:100%}
  .sig .tools{position:absolute;right:10px;bottom:10px;display:flex;gap:8px}
  .sig .tools button{background:#f2f2f2;border:1px solid #e2e2e2;border-radius:10px;padding:6px 10px}

  /* Footer note */
  .tiny{color:#888;font-size:12px;margin-top:8px}

  /* Desktop tweaks */
  @media (min-width:740px){
    .hero{grid-template-columns:180px 1fr auto}
    .brand{height:140px}
    .sigs{grid-template-columns:1fr 1fr}
  }
</style>
</head>
<body>
  <div class="wrap" id="contractRoot">
    <!-- HEADER -->
    <section class="hero">
      <div class="brand">
        <!-- Your big logo (fills the black box) -->
        <img src="./warmupuklogo.jpg" alt="Warm Up UK Logo" onerror="this.style.display='none'">
      </div>

      <div class="addr">
        321–323 Romford High Road, Essex, RM6 6AX
      </div>

      <div class="hero-actions">
        <button id="btnPdf" class="btn btn-gold">Generate PDF</button>
        <button id="btnReset" class="btn btn-dark">Reset Form</button>
      </div>
    </section>

    <!-- CUSTOMER -->
    <section class="card">
      <h2>Customer</h2>
      <label for="custName">Customer Name</label>
      <input id="custName" placeholder="Full name">

      <label for="custPhone">Phone (WhatsApp)</label>
      <input id="custPhone" inputmode="tel" placeholder="07...">

      <label for="custEmail">Email</label>
      <input id="custEmail" type="email" placeholder="name@email.com">

      <label for="surveyDate">Install / Survey Date</label>
      <input id="surveyDate" type="date">

      <label for="addr1">Address Line 1</label>
      <input id="addr1" placeholder="Street & number">

      <label for="town">Town / City</label>
      <input id="town" placeholder="Town / City">

      <label for="postcode">Postcode</label>
      <input id="postcode" placeholder="e.g. RM6 6AX">
    </section>

    <!-- PRODUCTS -->
    <section class="card" id="productsCard">
      <h2>Products & Pricing</h2>

      <div class="switch">
        <input id="adminFee" type="checkbox" checked>
        <label for="adminFee">Include Admin Fee (£150.00)</label>
      </div>
      <div class="switch">
        <input id="vatOn" type="checkbox">
        <label for="vatOn">Apply VAT (20%)</label>
      </div>

      <button class="addline" id="addLineBtn">+ Add line</button>

      <div style="overflow-x:auto">
        <table class="table" id="linesTable" aria-label="Products table">
          <thead>
            <tr>
              <th class="product">Product</th>
              <th class="desc">Description</th>
              <th class="qty">QTY</th>
              <th class="num">Unit (£)</th>
              <th class="num">Line Total (£)</th>
              <th class="row-actions"> </th>
            </tr>
          </thead>
          <tbody id="lineBody"></tbody>
        </table>
      </div>

      <div class="totals">
        <div class="line"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
        <div class="line" id="adminRow" style="display:flex;"><span>Admin Fee</span><span id="adminFeeVal">£150.00</span></div>
        <div class="line"><span>VAT</span><span id="vatVal">£0.00</span></div>
        <div class="line grand"><span>Total</span><span id="grandTotal">£0.00</span></div>
        <div class="tiny">All prices in GBP. Figures auto-update.</div>
      </div>
    </section>

    <!-- EXPRESS WAIVER -->
    <section class="card">
      <h2>Express Waiver (Optional)</h2>
      <div class="switch">
        <input id="waiverEnable" type="checkbox">
        <label for="waiverEnable">Enable waiver text</label>
      </div>

      <div class="waiver" id="waiverBox" aria-disabled="true">
        <div class="bar" aria-hidden="true"></div>
        <textarea id="waiverText" disabled>
I am instructing Warm Up UK to proceed with works immediately. I understand my statutory cooling-off period may be waived upon my request for urgent scheduling, and I accept responsibility for any costs incurred if I cancel after materials are ordered or works are scheduled.
        </textarea>
      </div>
    </section>

    <!-- SIGNATURES -->
    <section class="card">
      <h2>Signatures</h2>
      <div class="sigs">
        <div class="sig">
          <label>Customer Signature</label>
          <canvas id="sigCustomer"></canvas>
          <div class="tools">
            <button type="button" data-clear="sigCustomer">Clear</button>
          </div>
        </div>
        <div class="sig">
          <label>Company Signature</label>
          <canvas id="sigCompany"></canvas>
          <div class="tools">
            <button type="button" data-clear="sigCompany">Clear</button>
          </div>
        </div>
      </div>
      <div class="tiny">By signing, you agree to the attached terms and pricing.</div>
    </section>

    <!-- TERMS (short) -->
    <section class="card">
      <h2>Terms & Conditions (Summary)</h2>
      <ol style="margin:0 0 0 18px; line-height:1.5">
        <li>Quoted prices valid for 30 days unless stated otherwise.</li>
        <li>Deposits are non-refundable once materials are ordered.</li>
        <li>Access, waste removal and power/water to be provided unless agreed.</li>
        <li>All works subject to survey; variations will be priced and agreed in writing.</li>
        <li>Title to goods passes on full payment.</li>
        <li>Warm Up UK reserves the right to reschedule due to H&S or weather.</li>
        <li>Standard workmanship warranty applies unless stated otherwise.</li>
        <li>UK law & jurisdiction apply.</li>
      </ol>
    </section>

    <p class="tiny" style="text-align:center;margin:22px 0 40px">
      © <span id="yr"></span> Warm Up UK • 321–323 Romford High Road, Essex, RM6 6AX
    </p>
  </div>

  <!-- libs -->
  <script src="https://unpkg.com/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-YcsIP2YVwAKf2dCExa8WlR4wVamQYw1nLk2QBTQbRZbD6Xg2oT8YzM5xkKtnhVwZqKq5kR0qkJ4S6UuG4jG6vg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/* ---------- Helpers ---------- */
const fmt = n => '£' + (Math.round(n * 100) / 100).toFixed(2);
const el  = sel => document.querySelector(sel);

document.getElementById('yr').textContent = new Date().getFullYear();

/* ---------- Products ---------- */
const body = document.getElementById('lineBody');
const addLine = () => {
  const tr = document.createElement('tr');

  tr.innerHTML = `
    <td><input class="product" placeholder="e.g. Loft insulation"></td>
    <td><input class="desc" placeholder="Brief description"></td>
    <td><input class="qty" inputmode="decimal" value="1"></td>
    <td><input class="unit num" inputmode="decimal" value="0"></td>
    <td class="num total">£0.00</td>
    <td class="row-actions"><button type="button" class="del">Delete</button></td>
  `;
  body.appendChild(tr);

  tr.querySelectorAll('input').forEach(i => i.addEventListener('input', recalc));
  tr.querySelector('.del').addEventListener('click', () => { tr.remove(); recalc(); });
  recalc();
};

document.getElementById('addLineBtn').addEventListener('click', addLine);

/* ---------- Totals / VAT / Admin fee ---------- */
const adminCb  = document.getElementById('adminFee');
const adminRow = document.getElementById('adminRow');
const adminVal = document.getElementById('adminFeeVal');
const vatCb    = document.getElementById('vatOn');

function recalc(){
  let subtotal = 0;
  body.querySelectorAll('tr').forEach(tr=>{
    const qty  = parseFloat(tr.querySelector('.qty').value)  || 0;
    const unit = parseFloat(tr.querySelector('.unit').value) || 0;
    const line = qty * unit;
    tr.querySelector('.total').textContent = fmt(line);
    subtotal += line;
  });

  el('#subtotal').textContent = fmt(subtotal);

  // Admin fee
  const admin = adminCb.checked ? 150 : 0;
  adminRow.style.display = adminCb.checked ? 'flex' : 'none';
  adminVal.textContent = fmt(150);

  // VAT
  const vat = vatCb.checked ? 0.20 * (subtotal + admin) : 0;
  el('#vatVal').textContent = fmt(vat);

  const grand = subtotal + admin + vat;
  el('#grandTotal').textContent = fmt(grand);
}

adminCb.addEventListener('change', recalc);
vatCb.addEventListener('change', recalc);

/* start with one empty line */
addLine();

/* ---------- Waiver enable ---------- */
const waiverEnable = document.getElementById('waiverEnable');
const waiverText   = document.getElementById('waiverText');
waiverEnable.addEventListener('change', () => {
  const en = waiverEnable.checked;
  waiverText.disabled = !en;
  document.getElementById('waiverBox').setAttribute('aria-disabled', String(!en));
});

/* ---------- Signatures ---------- */
function setupSig(id){
  const canvas = document.getElementById(id);
  // fit canvas to container
  const resize = () => {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * (window.devicePixelRatio || 1);
    canvas.height = rect.height * (window.devicePixelRatio || 1);
    canvas.getContext('2d').scale((window.devicePixelRatio || 1), (window.devicePixelRatio || 1));
  };
  resize(); window.addEventListener('resize', resize);
  const pad = new SignaturePad(canvas, {minWidth: 0.8, maxWidth: 2.2, penColor: "#111"});
  document.querySelector(`[data-clear="${id}"]`).addEventListener('click', ()=>pad.clear());
  return pad;
}
const sigCustomer = setupSig('sigCustomer');
const sigCompany  = setupSig('sigCompany');

/* ---------- Reset ---------- */
document.getElementById('btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('input, textarea').forEach(i=>{
    if(i.type==='checkbox'){ i.checked = (i.id==='adminFee'); }
    else if(i.type==='date'){ i.value = ''; }
    else { i.value=''; }
  });
  body.innerHTML='';
  addLine();
  sigCustomer.clear(); sigCompany.clear();
  recalc();
});

/* ---------- PDF ---------- */
document.getElementById('btnPdf').addEventListener('click', ()=>{
  // Temporary render signatures onto image elements so html2pdf picks them up crisply
  const sigImgs = [];
  [['sigCustomer','Customer Signature'], ['sigCompany','Company Signature']].forEach(([id,label])=>{
    const cv = document.getElementById(id);
    if(!cv) return;
    const img = document.createElement('img');
    img.src = cv.toDataURL('image/png');
    img.alt = label;
    img.style.width = '100%'; img.style.height='180px'; img.style.objectFit='contain';
    cv.parentElement.appendChild(img);
    cv.style.display = 'none';
    sigImgs.push({cv,img});
  });

  const file = `WarmUpUK_Contract_${(el('#custName').value||'Customer').replace(/\s+/g,'_')}.pdf`;
  const opt = {
    margin:       [10,10,10,10],
    filename:     file,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, useCORS: true, background:'#ffffff' },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
    pagebreak:    { mode: ['avoid-all','css','legacy'] }
  };
  html2pdf().from(document.getElementById('contractRoot')).set(opt).save().then(()=>{
    // restore canvases
    sigImgs.forEach(({cv,img})=>{ img.remove(); cv.style.display='block'; });
  }).catch(()=>{
    sigImgs.forEach(({cv,img})=>{ img.remove(); cv.style.display='block'; });
  });
});

/* ---------- initial calc ---------- */
recalc();
</script>
</body>
</html>
