<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK – Contract Builder</title>
<link rel="preconnect" href="https://cdnjs.cloudflare.com">
<style>
  :root{
    --bg:#ffffff;
    --card:#0f0f10;
    --gold:#d6b350;
    --gold-deep:#c29a2a;
    --ink:#111;
    --muted:#666;
    --line:#e8e8e8;
    --pill:#222;
    --danger:#cc1f1f;
    --radius:18px;
  }
  html,body{background:var(--bg); color:var(--ink); font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:0}
  .wrap{max-width:980px; margin:28px auto; padding:0 14px}
  /* Header card */
  .brand{background:linear-gradient(180deg,#111 0%, #121316 70%); border-radius:var(--radius); color:#fff; padding:20px; display:grid; grid-template-columns:auto 1fr auto; gap:16px; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,.15); border:1px solid rgba(214,179,80,.25)}
  .logo{width:88px; height:88px; border-radius:14px; overflow:hidden; flex:0 0 auto}
  .logo img{width:100%; height:100%; object-fit:cover; display:block}
  .brand h1{margin:0 0 6px 0; font-weight:800; letter-spacing:.02em; font-size:34px; line-height:1.05}
  .addr{font-size:18px; line-height:1.3}
  .addr a{color:#bcd6ff; text-decoration:underline}
  .actions{display:flex; gap:12px; flex-wrap:wrap; justify-self:end}
  .btn{border:0; border-radius:14px; padding:14px 18px; font-weight:700; cursor:pointer}
  .btn-gold{background:var(--gold); color:#111}
  .btn-gold:active{background:var(--gold-deep)}
  .btn-dark{background:#2a2a2d; color:#fff}
  /* Section cards */
  .card{background:#fff; border:1px solid var(--line); border-radius:16px; padding:18px; margin:18px 0}
  .title{font-size:28px; font-weight:800; color:var(--ink); margin:6px 8px 14px}
  .grid{display:grid; grid-template-columns:1fr; gap:12px}
  @media(min-width:680px){ .grid.two{grid-template-columns:1fr 1fr} }
  label{display:block; font-size:14px; color:#444; margin:0 6px 6px}
  input,select,textarea{width:100%; box-sizing:border-box; border:1px solid #dadada; background:#fff; color:#111;
    border-radius:12px; padding:14px 14px; font-size:16px}
  textarea{min-height:110px; resize:vertical}
  /* Products */
  .table{width:100%; border-collapse:separate; border-spacing:12px 12px}
  .th{font-weight:800; color:#996f00; letter-spacing:.02em}
  .num{text-align:right}
  .pill{display:inline-flex; align-items:center; gap:10px; background:#111; color:#fff; border-radius:14px; padding:10px 14px}
  .pill input{width:22px; height:22px}
  .totals{border-top:2px solid #111; margin-top:10px; padding-top:12px}
  .row{display:flex; justify-content:space-between; padding:4px 0}
  .total{font-size:28px; font-weight:900; color:var(--gold-deep)}
  .x{display:inline-flex; width:48px; height:48px; align-items:center; justify-content:center; background:#111; color:#fff; border-radius:14px}
  /* Terms / waiver / signatures */
  .avoid-break{break-inside:avoid-page; page-break-inside:avoid}
  .waiver-box{border:2px solid var(--danger); background:#ffe9e9; border-radius:12px; padding:14px}
  /* Flash animation (6s) */
  .flash{animation:flashRed .6s linear 10 alternate}
  @keyframes flashRed{
    from{background:#ffe9e9}
    to{background:#ffb5b5}
  }
  .sigs{display:grid; grid-template-columns:1fr; gap:12px}
  @media(min-width:700px){ .sigs{grid-template-columns:1fr 1fr} }
  .sigpad{border:2px dashed #cfcfcf; border-radius:12px; background:#fff; height:180px; position:relative}
  .sigtools{margin-top:8px; display:flex; gap:8px}
  .small{font-size:13px; color:var(--muted)}
  /* Hide in PDF */
  .no-print{ }
  @media print{
    .no-print{display:none !important}
    .card{box-shadow:none}
  }
</style>
</head>
<body>
<div class="wrap" id="contractRoot">

  <!-- Header -->
  <section class="brand avoid-break">
    <div class="logo">
      <img src="warmupuklogo.jpg" alt="Warm Up UK logo">
    </div>
    <div>
      <h1>WARM<br>UP UK</h1>
      <div class="addr">
        321–323 Romford High Road, Essex, RM6 6AX<br>
        Office: <a href="tel:01708300670">01708 300670</a>
      </div>
    </div>
    <div class="actions no-print">
      <button class="btn btn-gold" id="btnPdf">Generate PDF</button>
      <button class="btn btn-dark" id="btnReset">Reset Form</button>
    </div>
  </section>

  <!-- Customer -->
  <section class="card avoid-break">
    <div class="title">Customer</div>
    <div class="grid two">
      <div><label>Customer Name</label><input id="custName" placeholder="Full name"></div>
      <div><label>Phone (WhatsApp)</label><input id="custPhone" placeholder="07..."></div>
      <div><label>Email</label><input id="custEmail" type="email" placeholder="name@email.com"></div>
      <div><label>Install / Survey Date</label><input id="custDate" type="date"></div>
      <div><label>Address Line 1</label><input id="addr1" placeholder="Street & number"></div>
      <div><label>Town / City</label><input id="city" placeholder="Town / City"></div>
      <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX"></div>
      <div><label>Order Notes (optional)</label><input id="orderNotes" placeholder="Special instructions / access, preferred days, etc."></div>
    </div>
  </section>

  <!-- Products -->
  <section class="card avoid-break" id="productsCard">
    <div class="title">Products & Pricing</div>

    <table class="table" id="lines">
      <thead>
        <tr>
          <th class="th">Item</th>
          <th class="th num">m²</th>
          <th class="th num">£ / UNIT</th>
          <th class="th num">LINE TOTAL (£)</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="grid two" style="align-items:center; gap:14px">
      <button class="x no-print" id="addLine" title="Add line">+ Add<br>line</button>

      <div class="pill">
        <input type="checkbox" id="adminFee" checked>
        <label for="adminFee" style="margin:0;color:#fff">Include admin fee (£150)</label>
      </div>

      <div class="pill" style="background:#f3f3f5;color:#111">
        <input type="checkbox" id="addVat">
        <label for="addVat" style="margin:0;color:#111">Add VAT (20%)</label>
      </div>
    </div>

    <div class="totals">
      <div class="row"><span>Subtotal</span><span id="subtotal">£0.00</span></div>
      <div class="row"><span>Admin Fee</span><span id="adminShow">£150.00</span></div>
      <div class="row"><span>VAT</span><span id="vatShow">£0.00</span></div>
      <div class="row" style="margin-top:6px"><span class="th">Total</span><span class="total" id="grand">£0.00</span></div>
      <div class="small">All prices in GBP. Figures auto-update.</div>
    </div>
  </section>

  <!-- Terms -->
  <section class="card avoid-break">
    <div class="title">Terms & Conditions (Summary)</div>
    <ol>
      <li>All quotes are valid for 30 days unless stated otherwise.</li>
      <li>Access to the work area, clear of personal belongings, is required.</li>
      <li>Balance due on completion unless a different schedule is agreed in writing.</li>
      <li>Manufacturer warranties apply to materials used.</li>
      <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
    </ol>
  </section>

  <!-- Waiver -->
  <section class="card avoid-break" id="waiverSection">
    <div class="title">Express Waiver (Optional)</div>
    <div class="pill" style="background:#111; color:#fff; margin-bottom:10px">
      <input type="checkbox" id="waive">
      <label for="waive" style="margin:0;color:#fff">I accept the Express Waiver</label>
    </div>
    <div class="waiver-box" id="waiverBox">
      By selecting the Express Waiver, I request works to commence at my property without the standard cooling-off period.
      I acknowledge that once works begin, I may be liable for reasonable costs if I later cancel.
    </div>
  </section>

  <!-- Signatures -->
  <section class="card avoid-break" id="sigSection">
    <div class="title">Signatures</div>
    <div class="sigs">
      <div>
        <div class="small" style="margin:0 0 8px 4px">Customer Signature</div>
        <div class="sigpad"><canvas id="sig1"></canvas></div>
        <div class="sigtools no-print"><button class="btn btn-dark" id="clr1">Clear</button></div>
      </div>
      <div>
        <div class="small" style="margin:0 0 8px 4px">Company Signature</div>
        <div class="sigpad"><canvas id="sig2"></canvas></div>
        <div class="sigtools no-print"><button class="btn btn-dark" id="clr2">Clear</button></div>
      </div>
    </div>
  </section>

</div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

<script>
(function(){
  const tbody = document.getElementById('tbody');
  const subtotalEl = document.getElementById('subtotal');
  const adminFeeEl = document.getElementById('adminShow');
  const vatEl = document.getElementById('vatShow');
  const grandEl = document.getElementById('grand');
  const adminFee = document.getElementById('adminFee');
  const addVat = document.getElementById('addVat');

  function money(n){ return '£' + (Number(n||0).toFixed(2)); }

  function addRow(item='', m2=0, unit=0){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input placeholder="Item" class="itm"></td>
      <td><input type="number" min="0" step="0.01" class="m2 num" value="${m2}"></td>
      <td><input type="number" min="0" step="0.01" class="unit num" value="${unit}"></td>
      <td class="num total">0.00</td>
      <td><button class="x no-print remove" title="Remove">×</button></td>`;
    tbody.appendChild(tr);
    tr.querySelectorAll('input').forEach(i=>i.addEventListener('input', recalc));
    tr.querySelector('.remove').addEventListener('click', ()=>{ tr.remove(); recalc(); });
    recalc();
  }

  function recalc(){
    let sub = 0;
    tbody.querySelectorAll('tr').forEach(tr=>{
      const m2 = parseFloat(tr.querySelector('.m2').value||0);
      const unit = parseFloat(tr.querySelector('.unit').value||0);
      const line = m2*unit;
      tr.querySelector('.total').textContent = line.toFixed(2);
      sub += line;
    });
    const admin = adminFee.checked ? 150 : 0;
    const vat = addVat.checked ? (sub+admin)*0.20 : 0;
    const grand = sub + admin + vat;

    subtotalEl.textContent = money(sub);
    adminFeeEl.textContent = money(admin);
    vatEl.textContent = money(vat);
    grandEl.textContent = money(grand);
  }

  document.getElementById('addLine').addEventListener('click', ()=> addRow());

  adminFee.addEventListener('change', recalc);
  addVat.addEventListener('change', recalc);

  // initial line
  addRow();

  // Waiver flashing
  const waive = document.getElementById('waive');
  const waiverBox = document.getElementById('waiverBox');
  waive.addEventListener('change', ()=>{
    if(waive.checked){
      waiverBox.classList.remove('flash'); // restart animation
      // force reflow
      void waiverBox.offsetWidth;
      waiverBox.classList.add('flash');
      setTimeout(()=> waiverBox.classList.remove('flash'), 6000);
    }else{
      waiverBox.classList.remove('flash');
    }
  });

  // Signature pads (retina-ready)
  function makePad(id, clearBtnId){
    const canvas = document.getElementById(id);
    const pad = new SignaturePad(canvas, {penColor:'#111'});
    function resize(){
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      pad.clear();
      pad.scale = ratio;
    }
    window.addEventListener('resize', resize);
    setTimeout(resize, 50);
    document.getElementById(clearBtnId).addEventListener('click', ()=>pad.clear());
    return pad;
  }
  const pad1 = makePad('sig1','clr1');
  const pad2 = makePad('sig2','clr2');

  // PDF
  document.getElementById('btnPdf').addEventListener('click', ()=>{
    // Ensure big sections don't split
    document.querySelectorAll('.avoid-break').forEach(e=>{
      e.style.breakInside='avoid-page';
      e.style.pageBreakInside='avoid';
    });

    const opt = {
      margin:       [8,8,8,8],
      filename:     `WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2, useCORS:true, letterRendering:true },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak:    { mode: ['avoid-all','css','legacy'] }
    };
    html2pdf().set(opt).from(document.getElementById('contractRoot')).save();
  });

  // Reset
  document.getElementById('btnReset').addEventListener('click', ()=>{
    document.querySelectorAll('input').forEach(i=>{
      if(['checkbox','date','email','number','text'].includes(i.type)) i.value = '';
    });
    // default toggles
    adminFee.checked = true; addVat.checked = false; waive.checked = false;
    // lines -> reset to one line
    tbody.innerHTML = '';
    addRow();
    // clear pads
    pad1.clear(); pad2.clear();
    waiverBox.classList.remove('flash');
    window.scrollTo({top:0, behavior:'smooth'});
  });

})();
</script>
</body>
</html>
