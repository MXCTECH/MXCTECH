<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>WARM UP UK – Contract</title>

<!-- Libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  :root{
    --brand:#000; --accent:#d4af37; --danger:#d90000; --line:#e8e8e8; --ink:#111;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#f7f7f8;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overscroll-behavior:contain}
  input,select,textarea,button{font-size:16px}
  a{color:#0b62ff;text-decoration:none}

  .sheet{max-width:900px;margin:16px auto 64px;background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px;box-shadow:0 3px 12px rgba(0,0,0,.06)}
  header{display:grid;grid-template-columns:auto 1fr auto;gap:14px;align-items:center;border-bottom:1px solid var(--line);padding-bottom:12px}
  header img.logo{width:132px;height:auto;object-fit:contain}         /* 50% bigger */
  header h1{margin:0;font-size:34px;letter-spacing:.04em}
  .addr{font-size:14px;color:#333}

  .section{font-weight:800;margin:18px 0 10px;font-size:18px}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .box{background:#fafafa;border:1px solid var(--line);border-radius:10px;padding:12px}
  label.small{display:block;font-size:12px;color:#666;margin-bottom:6px}
  input[type=text],input[type=number],input[type=date],input[type=email],input[type=tel],textarea,select{
    width:100%;border:1px solid #ccc;border-radius:8px;padding:10px
  }
  textarea{min-height:110px}

  /* Product lines as stacked cards for mobile */
  .lines{display:grid;gap:12px}
  .line{background:#fcfcfc;border:1px solid var(--line);border-radius:10px;padding:10px}
  .row3{display:grid;grid-template-columns:1fr;gap:8px}
  .line .tot input[readonly]{background:#f1f1f1;font-weight:700}

  .controls{display:flex;gap:10px;flex-wrap:wrap}
  button{border:0;border-radius:10px;background:#111;color:#fff;padding:12px 14px;font-weight:800}
  button.secondary{background:#333}
  button.danger{background:#b00020}
  button:disabled{opacity:.55;cursor:not-allowed}

  .panel{background:#fff;border:1px solid var(--line);border-radius:10px;padding:12px}
  .totals .row{display:flex;justify-content:space-between;padding:10px 6px;border-top:1px dashed #e6e6e6}
  .totals .row:first-child{border-top:none}
  .grand{font-size:22px;font-weight:900}
  .gold{color:var(--accent);font-weight:900}

  .waiver{border:2px solid var(--danger);background:#fff7f7;border-radius:10px;padding:12px}
  .waiver h3{margin:0 0 8px;color:#b00020}
  .waiver p{margin:6px 0 10px;line-height:1.35}

  .sigs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .sig{border:1px dashed #bbb;border-radius:10px;padding:10px;background:#fafafa}
  .sig label{font-weight:800}
  canvas.sigpad{width:100%;height:200px;border:1px solid #ddd;border-radius:8px;background:#fff;touch-action:none}

  .foot{font-size:12px;color:#666;text-align:center;margin-top:8px}

  @media (max-width:740px){
    header{grid-template-columns:1fr auto}
    .grid2{grid-template-columns:1fr}
    .sigs{grid-template-columns:1fr}  /* stack signatures on mobile */
  }
</style>
</head>
<body>
  <div id="capture" class="sheet">
    <header>
      <img class="logo" src="warmupuklogo.jpg" alt="WARM UP UK" />
      <div>
        <h1>WARM UP UK</h1>
        <div class="addr">321–323 Romford High Road, Essex RM6 6AX · <strong>Tel:</strong> <a href="tel:01708300670">01708 300670</a></div>
      </div>
      <div class="box" style="min-width:220px">
        <label class="small">Contract #</label>
        <input id="contractNo" readonly />
        <label class="small" style="margin-top:8px">Date</label>
        <input id="contractDate" readonly />
      </div>
    </header>

    <div class="section">Customer</div>
    <div class="grid2">
      <div class="box">
        <label class="small">Customer Name</label>
        <input id="custName" placeholder="Full name" />
        <label class="small" style="margin-top:8px">Property Address</label>
        <textarea id="custAddr" placeholder="House/Street, Town, Postcode"></textarea>
      </div>
      <div class="box">
        <label class="small">Phone</label>
        <input id="custPhone" placeholder="07…" />
        <label class="small" style="margin-top:8px">Email</label>
        <input id="custEmail" placeholder="email@example.com" />
      </div>
    </div>

    <div class="section">Products / Services</div>
    <div class="controls" style="margin-bottom:8px">
      <button id="addLine" class="secondary">+ Add Row</button>
      <button id="removeLine" class="secondary">− Remove Last</button>
      <button id="clearLines" class="danger">Clear Lines</button>
    </div>
    <div id="lines" class="lines"></div>

    <div class="section">Options</div>
    <div class="panel">
      <label style="display:flex;gap:10px;align-items:center"><input type="checkbox" id="vat"> Apply <strong>VAT 20%</strong></label>
      <div style="font-size:13px;color:#666;margin:8px 0 10px">Admin Fee of <strong>£150</strong> is automatically applied.</div>
      <label class="small">Install Date</label>
      <input id="installDate" type="date" />
    </div>

    <div class="section">Totals</div>
    <div class="panel totals" id="totalsBox">
      <div class="row"><div>Subtotal</div><div>£ <span id="subtotal">0.00</span></div></div>
      <div class="row"><div>Admin Fee</div><div>£ <span id="admin">150.00</span></div></div>
      <div class="row"><div>VAT (20%)</div><div>£ <span id="vatAmt">0.00</span></div></div>
      <div class="row grand"><div>Grand Total</div><div><span class="gold">£</span> <span id="grand">150.00</span></div></div>
      <div class="row"><div>Less Deposit</div>
        <div style="display:flex;gap:6px;align-items:center"><span>£</span><input id="deposit" type="number" min="0" step="0.01" value="0" style="width:120px;text-align:right"></div>
      </div>
      <div class="row"><div><strong>Balance Due</strong></div><div><strong>£ <span id="balance">150.00</span></strong></div></div>
    </div>

    <div class="section">Notes</div>
    <textarea id="notes" class="box" style="width:100%;min-height:160px" placeholder="Any specific instructions or clarifications…"></textarea>

    <div class="section">Express Waiver</div>
    <div class="waiver">
      <h3>Express Waiver</h3>
      <p>I request that WARM UP UK begins work before the end of my 14-day cooling-off period. I understand this may affect my right to cancel once the work has started and materials have been ordered or installed.</p>
      <label style="display:flex;gap:10px;align-items:center"><input id="waiverAck" type="checkbox"> I acknowledge and accept the Express Waiver.</label>
    </div>

    <div class="section">Signatures</div>
    <div class="sigs">
      <div class="sig">
        <label>Customer Signature</label>
        <canvas id="sigCustomer" class="sigpad"></canvas>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="sigCustName" placeholder="Customer printed name" />
          <button type="button" id="clearCust" class="secondary">Clear</button>
        </div>
      </div>
      <div class="sig">
        <label>Company Signature</label>
        <canvas id="sigCompany" class="sigpad"></canvas>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="sigCompName" placeholder="Company representative" />
          <button type="button" id="clearComp" class="secondary">Clear</button>
        </div>
      </div>
    </div>

    <div class="controls" style="margin-top:14px">
      <button id="makePDF" disabled>Generate PDF</button>
      <button id="clearForm" class="danger">Clear Form</button>
    </div>

    <div class="foot">WARM UP UK • 321–323 Romford High Road, Essex RM6 6AX • 01708 300670</div>
  </div>

<script>
(function(){
  /* ------------------ Data ------------------ */
  const PRODUCTS = [
    "Loft Insulation 270mm Fibreglass",
    "Multifoil YBS SuperQuilt",
    "Pitched Roof TLX Silver",
    "Cavity Wall Insulation",
    "Spray Foam Removal",
    "Loft Boarding",
    "Ventilation Upgrade",
    "Vermin Treatment",
    "Timber Treatment"
  ];
  const ADMIN_FEE = 150, VAT_RATE = 0.20;

  /* ------------------ Header autofill ------------------ */
  const contractNo = document.getElementById('contractNo');
  const contractDate = document.getElementById('contractDate');
  function genContractNo(){
    const d=new Date(), p=n=>String(n).padStart(2,'0');
    return `WUU-${String(d.getFullYear()).slice(-2)}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}-${Math.floor(1000+Math.random()*9000)}`;
  }
  function today(){ const d=new Date(), p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`; }
  contractNo.value = genContractNo();
  contractDate.value = today();
  document.getElementById('installDate').valueAsDate = new Date();

  /* ------------------ Products ------------------ */
  const linesEl = document.getElementById('lines');
  const addLineBtn = document.getElementById('addLine');
  const remLineBtn = document.getElementById('removeLine');
  const clrLinesBtn = document.getElementById('clearLines');

  function selectEl(){
    const s = document.createElement('select');
    s.innerHTML = PRODUCTS.map(p=>`<option value="${p}">${p}</option>`).join('');
    return s;
  }

  function makeLine(){
    const card = document.createElement('div'); card.className='line';
    const top = document.createElement('div');
    top.innerHTML = `<label class="small">Product</label>`;
    const sel = selectEl(); top.appendChild(sel);

    const row3 = document.createElement('div'); row3.className='row3';
    const qty = document.createElement('div'); qty.innerHTML = `<label class="small">Qty</label><input type="number" min="0" step="1" value="0">`;
    const unit = document.createElement('div'); unit.innerHTML = `<label class="small">Unit (£)</label><input type="number" min="0" step="0.01" value="0">`;
    const tot = document.createElement('div'); tot.className='tot'; tot.innerHTML = `<label class="small">Line Total</label><input type="text" value="0.00" readonly>`;

    row3.append(qty, unit, tot);
    card.append(top,row3);

    function recalc(){
      const q = parseFloat(qty.querySelector('input').value)||0;
      const u = parseFloat(unit.querySelector('input').value)||0;
      tot.querySelector('input').value = (q*u).toFixed(2);
      recalcTotals();
    }
    qty.querySelector('input').addEventListener('input', recalc);
    unit.querySelector('input').addEventListener('input', recalc);
    sel.addEventListener('change', ()=>{}); // hook for future if needed
    return card;
  }

  function addLine(){ linesEl.appendChild(makeLine()); recalcTotals(); }
  function removeLine(){ if(linesEl.lastElementChild){ linesEl.removeChild(linesEl.lastElementChild); recalcTotals(); } }
  function clearLines(){ linesEl.innerHTML=''; addLine(); }

  addLineBtn.addEventListener('click', addLine);
  remLineBtn.addEventListener('click', removeLine);
  clrLinesBtn.addEventListener('click', ()=>{ linesEl.innerHTML=''; addLine(); recalcTotals(); });

  clearLines(); addLine(); addLine(); // start with 2 lines

  /* ------------------ Totals ------------------ */
  const subtotalEl = document.getElementById('subtotal');
  const adminEl = document.getElementById('admin');
  const vatAmtEl = document.getElementById('vatAmt');
  const grandEl = document.getElementById('grand');
  const balanceEl = document.getElementById('balance');
  const depositEl = document.getElementById('deposit');
  const vatToggle = document.getElementById('vat');

  function getSubtotal(){
    let s=0;
    linesEl.querySelectorAll('.line').forEach(line=>{
      const q = parseFloat(line.querySelector('.row3 div:nth-child(1) input').value)||0;
      const u = parseFloat(line.querySelector('.row3 div:nth-child(2) input').value)||0;
      s += q*u;
    });
    return s;
  }
  function recalcTotals(){
    const sub = getSubtotal();
    const admin = ADMIN_FEE;
    const beforeVat = sub + admin;
    const vat = vatToggle.checked ? beforeVat*VAT_RATE : 0;
    const grand = beforeVat + vat;
    const dep = parseFloat(depositEl.value)||0;
    const bal = Math.max(grand - dep, 0);

    subtotalEl.textContent = sub.toFixed(2);
    adminEl.textContent = admin.toFixed(2);
    vatAmtEl.textContent = vat.toFixed(2);
    grandEl.textContent = grand.toFixed(2);
    balanceEl.textContent = bal.toFixed(2);
  }
  vatToggle.addEventListener('change', recalcTotals);
  depositEl.addEventListener('input', recalcTotals);

  /* ------------------ Signature pads ------------------ */
  function SigPad(canvas){
    const ctx = canvas.getContext('2d',{willReadFrequently:true});
    let drawing=false, last=null, dpr=1, imageOnResize=null;

    function size(){
      const rect = canvas.getBoundingClientRect();
      dpr = Math.max(window.devicePixelRatio||1,1);
      // preserve image across resize/orientation change
      const data = ctx.getImageData(0,0,canvas.width||1,canvas.height||1);
      canvas.width = Math.round(rect.width*dpr);
      canvas.height = Math.round(rect.height*dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#000';
      if(data.width && data.height){ // restore
        const tmp = document.createElement('canvas');
        tmp.width=data.width; tmp.height=data.height;
        tmp.getContext('2d').putImageData(data,0,0);
        ctx.drawImage(tmp,0,0,canvas.width,canvas.height);
      }
    }
    size();
    window.addEventListener('resize', size);
    window.addEventListener('orientationchange', size);

    function pos(e){
      const r=canvas.getBoundingClientRect();
      const pt = e.touches? e.touches[0]: e;
      return {x:(pt.clientX-r.left), y:(pt.clientY-r.top)};
    }
    function start(e){ drawing=true; document.body.style.overflow='hidden'; last=pos(e); e.preventDefault(); }
    function move(e){
      if(!drawing) return;
      const p=pos(e); ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke(); last=p; e.preventDefault();
    }
    function end(){ drawing=false; document.body.style.overflow=''; }

    canvas.addEventListener('mousedown',start); window.addEventListener('mouseup',end); canvas.addEventListener('mousemove',move);
    canvas.addEventListener('touchstart',start,{passive:false}); window.addEventListener('touchend',end); canvas.addEventListener('touchmove',move,{passive:false});

    return {
      clear(){ ctx.clearRect(0,0,canvas.width,canvas.height); },
      toDataURL(){ return canvas.toDataURL('image/png'); }
    };
  }

  const padCust = SigPad(document.getElementById('sigCustomer'));
  const padComp = SigPad(document.getElementById('sigCompany'));
  document.getElementById('clearCust').addEventListener('click',()=>padCust.clear());
  document.getElementById('clearComp').addEventListener('click',()=>padComp.clear());

  /* Enable PDF only after waiver */
  const makePDFBtn = document.getElementById('makePDF');
  document.getElementById('waiverAck').addEventListener('change', e=>{
    makePDFBtn.disabled = !e.target.checked;
  });

  /* ------------------ PDF (keep signatures) ------------------ */
  function swapCanvasesForImages(){
    const swaps=[];
    document.querySelectorAll('canvas.sigpad').forEach(cv=>{
      const img=document.createElement('img');
      img.src=cv.toDataURL('image/png');
      img.style.width = getComputedStyle(cv).width;
      img.style.height= getComputedStyle(cv).height;
      img.style.border=cv.style.border; img.style.borderRadius=cv.style.borderRadius;
      cv.parentNode.insertBefore(img,cv);
      cv.style.display='none';
      swaps.push({cv,img});
    });
    return ()=>{swaps.forEach(({cv,img})=>{img.remove(); cv.style.display='';});}
  }

  async function makePDF(){
    if(makePDFBtn.disabled){ alert('Please acknowledge the Express Waiver.'); return; }
    recalcTotals();

    const restore = swapCanvasesForImages();
    const node = document.getElementById('capture');

    const canvas = await html2canvas(node,{scale:2,backgroundColor:'#ffffff',useCORS:true,windowWidth:node.scrollWidth,windowHeight:node.scrollHeight});
    restore();

    const { jsPDF } = window.jspdf;
    const pdf=new jsPDF('p','mm','a4'); const a4w=210, a4h=297;
    const img = canvas.toDataURL('image/jpeg',0.95);
    const mmPerPx = a4w / canvas.width; let topPx=0; const pageHpx = a4h / mmPerPx;

    while(topPx < canvas.height){
      const sliceH = Math.min(pageHpx, canvas.height-topPx);
      const pageCanvas=document.createElement('canvas'); pageCanvas.width=canvas.width; pageCanvas.height=sliceH;
      pageCanvas.getContext('2d').drawImage(canvas,0,topPx,canvas.width,sliceH,0,0,canvas.width,sliceH);
      const pageImg = pageCanvas.toDataURL('image/jpeg',0.95);
      if(topPx>0) pdf.addPage();
      pdf.addImage(pageImg,'JPEG',0,0,a4w,sliceH*mmPerPx);
      topPx += sliceH;
    }

    // Page 2: Terms (force in its own page)
    pdf.addPage();
    pdf.setFont('helvetica','bold'); pdf.setFontSize(14);
    pdf.text('Terms & Conditions (Summary)', 14, 16);
    pdf.setFont('helvetica','normal'); pdf.setFontSize(11);
    const terms = [
      "1. All works to be carried out by or on behalf of WARM UP UK to agreed specification.",
      "2. Customer responsible for providing safe access to all work areas.",
      "3. Any unforeseen remedial works (e.g., rotten timbers, vermin damage) will be quoted separately.",
      "4. Electrical/ventilation upgrades, if required by building guidance, may be chargeable.",
      "5. Payment terms: unless otherwise stated, balance due on completion.",
      "6. Materials remain property of WARM UP UK until paid in full.",
      "7. Cancellations within 14 days are subject to statutory rights; bespoke materials may incur charges.",
      "8. By signing, the customer confirms accuracy of details and authorises the work as described."
    ];
    const left=14,width=pdf.internal.pageSize.getWidth()-28; let y=26;
    terms.forEach(t=>{ const lines=pdf.splitTextToSize(t,width); pdf.text(lines,left,y); y+=7+(lines.length-1)*5; });

    pdf.save(`${contractNo.value || 'WarmUpUK_Contract'}.pdf`);
  }
  document.getElementById('makePDF').addEventListener('click', makePDF);

  /* ------------------ Clear ------------------ */
  document.getElementById('clearForm').addEventListener('click', ()=>{
    if(!confirm('Clear the entire form?')) return;
    ['custName','custAddr','custPhone','custEmail','notes','sigCustName','sigCompName'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';});
    document.getElementById('installDate').valueAsDate=new Date();
    vatToggle.checked=false; depositEl.value=0;
    linesEl.innerHTML=''; addLine(); addLine();
    padCust.clear(); padComp.clear();
    contractNo.value=genContractNo(); contractDate.value=today();
    recalcTotals(); window.scrollTo({top:0,behavior:'smooth'});
  });

  /* kick totals */
  recalcTotals();
})();
</script>
</body>
</html>
