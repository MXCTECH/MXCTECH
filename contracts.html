<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK • Contract Builder</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#ffffff;
    --card:#ffffff;
    --ink:#0f1115;
    --muted:#60646c;
    --gold:#c8a74a;
    --gold-strong:#b8922a;
    --line:#e9eaee;
    --danger:#c62828;
    --success:#198754;
    --radius:16px;
    --shadow:0 4px 14px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  .header{
    display:flex;gap:20px;align-items:center;justify-content:space-between;
    background:#0c0d10;color:#fff;border:1px solid rgba(200,167,74,.35);
    border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)
  }
  .left{display:flex;gap:16px;align-items:center}
  .brand{
    width:112px;height:112px;border-radius:14px;flex:0 0 112px;
    background:#fff url("./warmupuklogo.jpg") center/cover no-repeat;
    border:none;box-shadow:none; /* no outline / no fade */
  }
  .company{
    display:flex;flex-direction:column;gap:6px;color:#fff
  }
  .company .addr{font-weight:600;font-size:18px}
  .btn{
    appearance:none;border:0;border-radius:12px;padding:14px 20px;font-weight:700;
    background:linear-gradient(#e7cc74,#c8a74a);color:#111;cursor:pointer;box-shadow:var(--shadow)
  }
  .btn.secondary{background:#2a2d33;color:#fff}
  .section{
    margin-top:18px;background:var(--card);border:1px solid var(--line);
    border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)
  }
  .section h2{
    margin:0 0 14px;font-size:22px;letter-spacing:.2px;color:var(--gold-strong)
  }
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:720px){.grid{grid-template-columns:1fr}}
  label{display:block;font-size:13px;color:var(--muted);margin:4px 0 6px}
  input,select,textarea{
    width:100%;padding:14px 12px;border:1px solid var(--line);border-radius:12px;
    background:#fff;color:var(--ink);outline:none
  }
  input:focus,select:focus,textarea:focus{border-color:#c8a74a;box-shadow:0 0 0 3px rgba(200,167,74,.18)}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th{font-size:12px;color:var(--muted);text-align:left;padding:0 8px}
  td{background:#fff;border:1px solid var(--line);padding:8px;border-radius:10px}
  .t-actions{display:flex;gap:8px;align-items:center}
  .add-line{display:inline-block;margin:10px 0;font-weight:600;color:#0f1115;border:1px dashed var(--gold);padding:8px 10px;border-radius:10px;cursor:pointer;background:#fff}
  .totals{border-top:2px solid #101213;margin-top:10px;padding-top:8px}
  .totals .row{display:flex;justify-content:space-between;margin:4px 0}
  .totals .row strong{font-weight:700}
  .totals .grand{font-size:20px;color:var(--gold-strong)}
  .pill{display:inline-flex;gap:10px;align-items:center}
  .switch{appearance:none;width:46px;height:28px;border-radius:999px;background:#d9dce3;position:relative;cursor:pointer}
  .switch:before{content:"";position:absolute;width:22px;height:22px;border-radius:50%;left:3px;top:3px;background:#fff;transition:.2s}
  .switch:checked{background:#c8a74a}
  .switch:checked:before{transform:translateX(18px)}
  /* Waiver flash */
  .waiver{border:2px solid #f0caca;border-radius:12px;background:#fff6f6;padding:14px;position:relative}
  .waiver.flash{animation:flash 900ms ease-in-out 1}
  @keyframes flash{
    0%{box-shadow:0 0 0 0 rgba(198,40,40,.35)}
    60%{box-shadow:0 0 0 12px rgba(198,40,40,.00)}
    100%{box-shadow:none}
  }
  /* Signatures */
  .sig-area{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:720px){.sig-area{grid-template-columns:1fr}}
  .sig{
    border:1px dashed #c7cad3;border-radius:12px;background:#fff;position:relative
  }
  .sig canvas{width:100%;height:220px;display:block;border-radius:12px}
  .sig .sig-actions{position:absolute;right:8px;bottom:8px;display:flex;gap:8px}
  .chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer}
  footer{opacity:.7;font-size:12px;margin:18px 0;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <div class="header">
      <div class="left">
        <div class="brand" aria-label="Warm Up UK logo"></div>
        <div class="company">
          <div class="addr">321–323 Romford High Road, Essex, RM6 6AX</div>
        </div>
      </div>
      <div class="right">
        <button id="btnPdf" class="btn">Generate PDF</button>
        <button id="btnReset" class="btn secondary" style="margin-left:10px">Reset Form</button>
      </div>
    </div>

    <!-- CUSTOMER -->
    <div class="section">
      <h2>Customer</h2>
      <div class="grid">
        <div><label>Customer Name</label><input id="custName" placeholder="Full name"></div>
        <div><label>Phone (WhatsApp)</label><input id="custPhone" placeholder="07..."></div>
        <div><label>Email</label><input id="custEmail" placeholder="name@email.com" type="email"></div>
        <div><label>Install / Survey Date</label><input id="date" type="date"></div>
        <div><label>Address Line 1</label><input id="addr1" placeholder="Street & number"></div>
        <div><label>Town / City</label><input id="city" placeholder="Town / City"></div>
        <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX"></div>
        <div><label>Job Type</label>
          <select id="jobType">
            <option>Loft Insulation</option>
            <option>Multifoil Insulation</option>
            <option>Cavity Wall Insulation</option>
            <option>Spray Foam Removal</option>
          </select>
        </div>
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="section" id="pricing">
      <h2>Products & Pricing</h2>
      <div class="t-actions">
        <button id="addLine" class="add-line">+ Add line</button>
        <label class="pill" title="Toggle VAT 20%">
          <input id="vatToggle" type="checkbox" class="switch">
          <span>VAT 20%</span>
        </label>
      </div>
      <table>
        <thead>
          <tr>
            <th style="width:28%">Product</th>
            <th style="width:34%">Description</th>
            <th style="width:10%">Qty</th>
            <th style="width:14%">Unit (£)</th>
            <th style="width:14%">Line (£)</th>
            <th style="width:6%"></th>
          </tr>
        </thead>
        <tbody id="lines"></tbody>
      </table>

      <div class="totals" id="totals">
        <div class="row"><span>Subtotal</span><span id="subTotal">£0.00</span></div>
        <div class="row"><span>Admin Fee</span><span id="adminFee">£150.00</span></div>
        <div class="row"><span>VAT</span><span id="vat">£0.00</span></div>
        <div class="row grand"><strong>Total</strong><strong id="grand">£0.00</strong></div>
      </div>
      <small style="color:var(--muted)">All prices in GBP. Figures auto-update.</small>
    </div>

    <!-- EXPRESS WAIVER -->
    <div class="section">
      <h2>Express Waiver (Optional)</h2>
      <div class="pill" style="margin-bottom:10px">
        <input id="waiverChk" type="checkbox" class="switch">
        <span>I agree to the Express Waiver terms</span>
      </div>
      <div id="waiverBox" class="waiver">
        By enabling the Express Waiver, the customer requests an expedited install date and agrees that
        cooling-off rights are waived once materials are ordered and works are scheduled.
      </div>
    </div>

    <!-- SIGNATURES -->
    <div class="section">
      <h2>Signatures</h2>
      <div class="sig-area">
        <div class="sig">
          <canvas id="sig1"></canvas>
          <div class="sig-actions"><button class="chip" id="clear1">Clear</button></div>
          <div style="padding:8px 10px;color:var(--muted);font-size:12px">Customer Signature</div>
        </div>
        <div class="sig">
          <canvas id="sig2"></canvas>
          <div class="sig-actions"><button class="chip" id="clear2">Clear</button></div>
          <div style="padding:8px 10px;color:var(--muted);font-size:12px">Company Signature</div>
        </div>
      </div>
    </div>

    <footer>© Warm Up UK</footer>
  </div>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
/* ---------- UTIL ---------- */
const fmt = n => "£" + (n||0).toFixed(2);

/* ---------- LINES ---------- */
const linesEl = document.getElementById('lines');
const vatToggle = document.getElementById('vatToggle');
function addLine(data={product:"",desc:"",qty:1,unit:0}){
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="p" placeholder="Product" value="${data.product}"></td>
    <td><input class="d" placeholder="Description" value="${data.desc}"></td>
    <td><input class="q" type="number" min="0" step="1" value="${data.qty}"></td>
    <td><input class="u" type="number" min="0" step="0.01" value="${data.unit}"></td>
    <td class="lt">£0.00</td>
    <td style="text-align:center"><button class="chip del">✕</button></td>`;
  linesEl.appendChild(tr);
  const inputs = tr.querySelectorAll('input');
  inputs.forEach(i=>i.addEventListener('input',updateTotals));
  tr.querySelector('.del').addEventListener('click',()=>{ tr.remove(); updateTotals(); });
  updateTotals();
}
document.getElementById('addLine').addEventListener('click',()=>addLine());

function updateTotals(){
  let sub=0;
  [...linesEl.querySelectorAll('tr')].forEach(tr=>{
    const q = parseFloat(tr.querySelector('.q').value)||0;
    const u = parseFloat(tr.querySelector('.u').value)||0;
    const lt = q*u;
    tr.querySelector('.lt').textContent = fmt(lt);
    sub += lt;
  });
  const admin = 150;
  const vat = vatToggle.checked ? 0.20*(sub+admin) : 0;
  document.getElementById('subTotal').textContent = fmt(sub);
  document.getElementById('adminFee').textContent = fmt(admin);
  document.getElementById('vat').textContent = fmt(vat);
  document.getElementById('grand').textContent = fmt(sub+admin+vat);
}
vatToggle.addEventListener('change',updateTotals);
addLine(); // start with one empty line

/* ---------- WAIVER FLASH ---------- */
const waiverChk = document.getElementById('waiverChk');
const waiverBox = document.getElementById('waiverBox');
waiverChk.addEventListener('change',()=>{
  waiverBox.classList.remove('flash');
  void waiverBox.offsetWidth; // restart animation
  if(waiverChk.checked) waiverBox.classList.add('flash');
});

/* ---------- SIGNATURES ---------- */
function SigPad(canvasId, clearId){
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext('2d');
  let drawing=false, last=null;
  const resize=()=>{
    const r = canvas.getBoundingClientRect();
    const tmp = document.createElement('canvas');
    tmp.width = canvas.width; tmp.height = canvas.height;
    tmp.getContext('2d').drawImage(canvas,0,0);
    canvas.width = Math.floor(r.width*2);
    canvas.height = Math.floor(220*2);
    ctx.scale(2,2);
    ctx.lineWidth = 2; ctx.lineCap = 'round'; ctx.strokeStyle = '#111';
    ctx.drawImage(tmp,0,0,canvas.width/2,canvas.height/2);
  };
  new ResizeObserver(resize).observe(canvas.parentElement);
  const pos = e=>{
    const rect = canvas.getBoundingClientRect();
    const x = (e.touches?e.touches[0].clientX:e.clientX)-rect.left;
    const y = (e.touches?e.touches[0].clientY:e.clientY)-rect.top;
    return {x,y};
  };
  const start = e=>{drawing=true; last=pos(e);};
  const move = e=>{
    if(!drawing) return;
    const p = pos(e);
    ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke();
    last=p;
  };
  const end = ()=> drawing=false;

  canvas.addEventListener('mousedown',start);
  canvas.addEventListener('mousemove',move);
  window.addEventListener('mouseup',end);
  canvas.addEventListener('touchstart',e=>{start(e); e.preventDefault();},{passive:false});
  canvas.addEventListener('touchmove',e=>{move(e); e.preventDefault();},{passive:false});
  canvas.addEventListener('touchend',end);

  document.getElementById(clearId).addEventListener('click',()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); });
  resize();
  return {canvas};
}
const pad1 = SigPad('sig1','clear1');
const pad2 = SigPad('sig2','clear2');

/* ---------- PDF ---------- */
const { jsPDF } = window.jspdf;
document.getElementById('btnPdf').addEventListener('click', async ()=>{
  updateTotals();
  const doc = new jsPDF({unit:'pt',format:'a4'});
  const node = document.querySelector('.wrap');
  const canvas = await html2canvas(node,{scale:2,background:'#ffffff',useCORS:true});
  const img = canvas.toDataURL('image/png');
  const pageWidth = doc.internal.pageSize.getWidth();
  const ratio = pageWidth / canvas.width;
  doc.addImage(img,'PNG',0,0,canvas.width*ratio,canvas.height*ratio);
  doc.save('WarmUpUK-Contract.pdf');
});

/* ---------- RESET ---------- */
document.getElementById('btnReset').addEventListener('click',()=>{
  document.querySelectorAll('input').forEach(i=>{ if(i.type!=='checkbox' && i.type!=='date' && !i.classList.contains('q') && !i.classList.contains('u')) i.value=''; });
  linesEl.innerHTML=''; addLine();
  vatToggle.checked=false; updateTotals();
  waiverChk.checked=false; waiverBox.classList.remove('flash');
  [pad1,pad2].forEach(p=>{ const ctx=p.canvas.getContext('2d'); ctx.clearRect(0,0,p.canvas.width,p.canvas.height); });
});
</script>
</body>
</html>
