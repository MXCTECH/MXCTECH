<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK • Contract Builder</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Signature Pad & html2pdf (includes html2canvas & jsPDF) -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<style>
  :root{
    --gold:#d4af37;
    --gold-deep:#b69125;
    --black:#111;
    --ink:#202124;
    --muted:#6b7280;
    --panel:#ffffff;
    --ring:#e5e7eb;
    --red:#e11d48;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#fff;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .container{max-width:900px;margin:24px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid var(--ring);border-radius:16px;padding:18px;box-shadow:0 2px 12px rgba(17,17,17,.06)}
  .header{background:var(--black);color:#fff;border:1px solid rgba(212,175,55,.35)}
  .header-grid{display:grid;grid-template-columns:96px 1fr auto;gap:16px;align-items:center}
  .logo-wrap{width:96px;height:96px;border-radius:12px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
  .logo-wrap img{width:100%;height:100%;object-fit:cover} /* no outline, no fade */
  .brand-block{display:flex;flex-direction:column;gap:6px}
  .brand-title{font-weight:800;letter-spacing:.04em;color:#fff;font-size:28px;line-height:1}
  .address{color:#e5e7eb;line-height:1.3}
  .btns{display:flex;gap:12px;flex-wrap:wrap}
  .btn{appearance:none;border:none;border-radius:12px;padding:14px 18px;font-weight:700;cursor:pointer}
  .btn-gold{background:var(--gold);color:#111;box-shadow:inset 0 -3px 0 var(--gold-deep)}
  .btn-dark{background:#2b2b2b;color:#fff}
  .section-title{font-size:28px;font-weight:800;margin:18px 0 12px;color:var(--gold)}
  .grid-2{display:grid;grid-template-columns:1fr;gap:14px}
  @media(min-width:680px){.grid-2{grid-template-columns:1fr 1fr}}
  label{font-weight:600;color:#333;font-size:14px;margin-bottom:6px;display:block}
  input,select,textarea{width:100%;padding:14px;border:1px solid var(--ring);border-radius:12px;background:#fff;font-size:16px}
  textarea{min-height:110px;resize:vertical}
  .products table{width:100%;border-collapse:separate;border-spacing:10px 10px}
  .products th{font-size:14px;color:#6b7280;text-transform:uppercase;letter-spacing:.08em;text-align:left}
  .num{width:100%;text-align:center}
  .line-total{font-weight:700}
  .add-line{display:inline-flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:14px;background:#111;color:#fff;border:none;font-size:28px;line-height:0}
  .row-actions{display:flex;justify-content:flex-end}
  .chip{display:inline-flex;align-items:center;gap:10px;border:1px solid var(--ring);border-radius:14px;padding:12px 14px}
  .chip input{width:20px;height:20px}
  .totals{border-top:3px solid #111;margin-top:14px;padding-top:12px}
  .grand{font-size:28px;font-weight:800;color:var(--gold)}
  .tc-list{padding-left:20px;margin:8px 0}
  .waiver-box{border:2px solid var(--red);border-radius:12px;padding:12px;background:#fff0f3}
  .flash{animation:flashRed 1s ease-in-out 6}
  @keyframes flashRed{0%,100%{box-shadow:0 0 0 0 rgba(225,29,72,.0)}50%{box-shadow:0 0 0 6px rgba(225,29,72,.45)}}
  .sigs{page-break-inside:avoid;display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:680px){.sigs{grid-template-columns:1fr 1fr}}
  .pad{border:2px dashed #d1d5db;border-radius:12px;background:#fff;height:200px}
  .pad-actions{display:flex;justify-content:flex-end;margin-top:8px}
  .btn-sm{padding:8px 12px;border-radius:10px;font-weight:700;border:none;background:#2b2b2b;color:#fff}
  /* PDF page-break helpers */
  .no-break{page-break-inside:avoid}
  .page-break{page-break-before:always}
  /* Fix mobile checkbox overlap */
  .options-grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:620px){.options-grid{grid-template-columns:1fr 1fr}}
  .footer-note{color:var(--muted);font-size:12px;margin-top:4px}
</style>
</head>
<body>
<div class="container">
  <!-- HEADER -->
  <div class="card header no-break">
    <div class="header-grid">
      <div class="logo-wrap">
        <img src="warmupuklogo.jpg" alt="Warm Up UK logo">
      </div>
      <div class="brand-block">
        <div class="brand-title">WARM UP UK</div>
        <div class="address">
          321–323 Romford High Road, Essex, RM6 6AX<br>
          Office: <a href="tel:01708300670" style="color:#93c5fd;text-decoration:underline">01708 300670</a>
        </div>
      </div>
      <div class="btns">
        <button id="btnPdf" class="btn btn-gold">Generate PDF</button>
        <button id="btnReset" class="btn btn-dark">Reset Form</button>
      </div>
    </div>
  </div>

  <!-- CUSTOMER -->
  <div class="card">
    <div class="section-title">Customer</div>
    <div class="grid-2">
      <div><label>Customer Name</label><input id="custName" placeholder="Full name"></div>
      <div><label>Phone (WhatsApp)</label><input id="custPhone" placeholder="07..."></div>
      <div><label>Email</label><input id="custEmail" type="email" placeholder="name@email.com"></div>
      <div><label>Install / Survey Date</label><input id="custDate" type="date"></div>
      <div><label>Address Line 1</label><input id="addr1" placeholder="Street & number"></div>
      <div><label>Town / City</label><input id="city" placeholder="Town / City"></div>
      <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX"></div>
      <div><label>Order Notes (optional)</label><input id="notes" placeholder="Special instructions / access, preferred days, etc."></div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div class="card products no-break" id="products">
    <div class="section-title">Products & Pricing</div>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>m²</th>
          <th>£ / Unit</th>
          <th>Line Total (£)</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="lines"></tbody>
    </table>

    <div class="row-actions" style="margin-top:6px">
      <button class="add-line" id="btnAdd" title="Add line">+</button>
    </div>

    <div class="options-grid" style="margin-top:14px">
      <label class="chip"><input type="checkbox" id="incFee" checked> Include admin fee (£150)</label>
      <label class="chip"><input type="checkbox" id="addVat"> Add VAT (20%)</label>
    </div>

    <div class="totals">
      <div style="display:grid;grid-template-columns:1fr auto;gap:6px;margin:6px 0">
        <div>Subtotal</div><div id="subtotal">£0.00</div>
        <div>Admin Fee</div><div id="adminfee">£150.00</div>
        <div>VAT</div><div id="vat">£0.00</div>
        <div style="font-weight:800;font-size:22px">Total</div>
        <div class="grand" id="grand">£150.00</div>
      </div>
      <div class="footer-note">All prices in GBP. Figures auto-update.</div>
    </div>
  </div>

  <!-- TERMS -->
  <div class="card no-break" id="tcs">
    <div class="section-title">Terms & Conditions (Summary)</div>
    <ol class="tc-list">
      <li>All quotes are valid for 30 days unless stated otherwise.</li>
      <li>Access to the work area, clear of personal belongings, is required.</li>
      <li>Balance due on completion unless a different schedule is agreed in writing.</li>
      <li>Manufacturer warranties apply to materials used as supplied.</li>
      <li>Customer responsible for disclosing any known hazards or restrictions.</li>
      <li>Cooling-off rights apply unless the Express Waiver is selected below.</li>
    </ol>
  </div>

  <!-- WAIVER -->
  <div class="card no-break" id="waiver">
    <div class="section-title">Express Waiver (Optional)</div>
    <label class="chip" style="margin-bottom:10px">
      <input type="checkbox" id="waiverTick"> I accept the Express Waiver
    </label>
    <div id="waiverBox" class="waiver-box">
      By selecting the Express Waiver, I request works to commence at my property without the
      standard cooling-off period. I acknowledge that once works begin, I may be liable for
      reasonable costs if I later cancel.
    </div>
  </div>

  <!-- SIGNATURES -->
  <div class="card no-break" id="sigsCard">
    <div class="section-title">Signatures</div>
    <div class="sigs">
      <div>
        <label>Customer Signature</label>
        <canvas id="sigCustomer" class="pad"></canvas>
        <div class="pad-actions"><button class="btn-sm" id="clearCustomer">Clear</button></div>
      </div>
      <div>
        <label>Company Signature</label>
        <canvas id="sigCompany" class="pad"></canvas>
        <div class="pad-actions"><button class="btn-sm" id="clearCompany">Clear</button></div>
      </div>
    </div>
  </div>

</div> <!-- /container -->

<script>
  // --------- Helpers
  const fmt = n => "£" + (Math.round(n * 100)/100).toFixed(2);

  // --------- Lines
  const tbody = document.getElementById('lines');
  function addLine(item="", m2=0, unit=0){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="item" placeholder="Item" value="${item}"></td>
      <td><input class="m2 num" type="number" min="0" step="0.01" value="${m2}"></td>
      <td><input class="unit num" type="number" min="0" step="0.01" value="${unit}"></td>
      <td class="line-total">£0.00</td>
      <td style="text-align:right"><button class="btn-sm" data-remove>Remove</button></td>
    `;
    tbody.appendChild(tr);
    tr.querySelectorAll('input').forEach(i=>i.addEventListener('input',update));
    tr.querySelector('[data-remove]').addEventListener('click',()=>{ tr.remove(); update(); });
    update();
  }
  document.getElementById('btnAdd').addEventListener('click',()=>addLine());

  // initial one line
  addLine();

  // --------- Totals
  const incFee = document.getElementById('incFee');
  const addVat = document.getElementById('addVat');
  incFee.addEventListener('change',update);
  addVat.addEventListener('change',update);

  function update(){
    let sub = 0;
    Array.from(tbody.children).forEach(tr=>{
      const m2 = parseFloat(tr.querySelector('.m2').value)||0;
      const unit = parseFloat(tr.querySelector('.unit').value)||0;
      const total = m2 * unit;
      tr.querySelector('.line-total').textContent = fmt(total);
      sub += total;
    });
    const admin = incFee.checked ? 150 : 0;
    const net = sub + admin;
    const vat = addVat.checked ? net * 0.20 : 0;
    document.getElementById('subtotal').textContent = fmt(sub);
    document.getElementById('adminfee').textContent = fmt(admin);
    document.getElementById('vat').textContent = fmt(vat);
    document.getElementById('grand').textContent = fmt(net + vat);
  }

  // --------- Waiver flash
  const waiverTick = document.getElementById('waiverTick');
  const waiverBox = document.getElementById('waiverBox');
  waiverTick.addEventListener('change',()=>{
    if(waiverTick.checked){
      waiverBox.classList.remove('flash');  // reset
      void waiverBox.offsetWidth;           // reflow
      waiverBox.classList.add('flash');     // flash 6s (6 cycles)
    }else{
      waiverBox.classList.remove('flash');
    }
  });

  // --------- Signature pads
  let padCustomer, padCompany;
  function initPads(){
    const c1 = document.getElementById('sigCustomer');
    const c2 = document.getElementById('sigCompany');
    // size canvases to CSS size
    [c1,c2].forEach(c=>{
      const rect = c.getBoundingClientRect();
      c.width = rect.width * 2;  // high DPI
      c.height = rect.height * 2;
      const ctx = c.getContext('2d');
      ctx.scale(2,2);
    });
    padCustomer = new SignaturePad(c1,{penColor:"#111"});
    padCompany  = new SignaturePad(c2,{penColor:"#111"});
  }
  initPads();
  window.addEventListener('resize',()=>{ // keep signatures valid on rotate
    const data1 = padCustomer.toDataURL();
    const data2 = padCompany.toDataURL();
    initPads();
    if(data1 && !padCustomer.isEmpty()) padCustomer.fromDataURL(data1);
    if(data2 && !padCompany.isEmpty()) padCompany.fromDataURL(data2);
  });

  document.getElementById('clearCustomer').addEventListener('click',()=>padCustomer.clear());
  document.getElementById('clearCompany').addEventListener('click',()=>padCompany.clear());

  // --------- Reset
  document.getElementById('btnReset').addEventListener('click',()=>{
    document.querySelectorAll('input').forEach(i=>{
      if(i.type==='checkbox'){ i.checked = (i.id==='incFee'); }
      else if(i.type==='date'){ i.value=''; }
      else i.value='';
    });
    tbody.innerHTML='';
    addLine();
    padCustomer.clear(); padCompany.clear();
    update();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  // --------- PDF
  document.getElementById('btnPdf').addEventListener('click',()=>{
    // embed signatures into hidden <img> so html2pdf captures
    const sigsCard = document.getElementById('sigsCard');
    const imgs = sigsCard.querySelectorAll('img.sig-img');
    imgs.forEach(i=>i.remove());

    if(!padCustomer.isEmpty()){
      const img1 = document.createElement('img');
      img1.className='sig-img';
      img1.src = padCustomer.toDataURL();
      img1.style.display='block';
      img1.style.maxWidth='100%';
      img1.style.marginTop='8px';
      sigsCard.querySelector('#sigCustomer').after(img1);
    }
    if(!padCompany.isEmpty()){
      const img2 = document.createElement('img');
      img2.className='sig-img';
      img2.src = padCompany.toDataURL();
      img2.style.display='block';
      img2.style.maxWidth='100%';
      img2.style.marginTop='8px';
      sigsCard.querySelector('#sigCompany').after(img2);
    }

    const opt = {
      margin:       10,
      filename:     `WarmUpUK_Contract_${new Date().toISOString().slice(0,10)}.pdf`,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2, useCORS:true },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak:    { mode: ['css','legacy'] }
    };
    const source = document.querySelector('.container');
    html2pdf().set(opt).from(source).save().then(()=>{
      // clean temporary imgs
      sigsCard.querySelectorAll('img.sig-img').forEach(i=>i.remove());
    });
  });

  // kick calculations
  update();
</script>
</body>
</html>
