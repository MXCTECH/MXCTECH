<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MXCTECH – Contract</title>
<style>
  :root{
    --brand:#111; --brand-alt:#f5f5f7; --ink:#222; --line:#e6e6e6; --ok:#0a7f2e;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:var(--ink);background:#fff}
  .page{max-width:1000px;margin:24px auto;padding:16px}
  header.brand{display:flex;align-items:center;justify-content:space-between;gap:12px;border-bottom:1px solid var(--line);padding-bottom:12px;margin-bottom:16px}
  .logo{display:inline-grid;place-items:center;width:44px;height:44px;border-radius:8px;background:var(--brand);color:#fff;font-weight:800}
  .title{font-weight:700;font-size:20px;letter-spacing:.2px}
  .sub{color:#666;font-size:13px}
  .grid{display:grid;gap:12px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:8px;font:inherit}
  textarea{min-height:90px;resize:vertical}
  .muted{color:#666}
  .right{display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap}
  .btn{padding:10px 14px;border:1px solid var(--line);border-radius:8px;background:#fff;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
  .table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  .table th,.table td{padding:10px;border-bottom:1px solid var(--line);text-align:left}
  .table th{background:var(--brand-alt)}
  .sig-wrap{border:1px solid var(--line);border-radius:10px;background:#fff;box-shadow:0 0 0 3px #fafafa inset}
  #sigCanvas{display:block;width:100%;height:280px;touch-action:none}
  .toolrow{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .terms{font-size:12px;line-height:1.5;color:#333;background:#fcfcfd;border:1px dashed #ddd;border-radius:8px;padding:10px}
  .footer-note{font-size:12px;color:#666;margin-top:12px}
  @media print{.btn,.right{display:none!important}}
</style>
</head>
<body>
<div class="page">
  <header class="brand">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo">MXC</div>
      <div>
        <div class="title">MXCTECH — Customer Contract</div>
        <div class="sub">Energy & Insulation Services</div>
      </div>
    </div>
    <div class="muted">
      <div>Contract #: <strong id="contractNo">—</strong></div>
      <div>Date: <strong id="todayStr">—</strong></div>
    </div>
  </header>

  <!-- Client Info -->
  <section class="grid cols-2">
    <div>
      <label>Full Name<input id="clientName"></label>
      <label>Phone<input id="clientPhone" placeholder="07…"></label>
      <label>Email<input id="clientEmail" type="email"></label>
      <label>Address<textarea id="clientAddress"></textarea></label>
      <label>Postcode<input id="clientPostcode"></label>
    </div>
    <div>
      <label>Sales Rep<input id="salesRep"></label>
      <label>Booking Agent<input id="bookingAgent"></label>
      <label>Install Date<input id="installDate" type="date"></label>
      <label>Notes<textarea id="siteNotes"></textarea></label>
    </div>
  </section>

  <!-- Table -->
  <section style="margin-top:20px">
    <h3>Products & Pricing</h3>
    <table class="table" id="itemsTable">
      <thead><tr><th>Description</th><th>Qty</th><th>Unit (£)</th><th>Line (£)</th><th></th></tr></thead>
      <tbody id="itemBody"></tbody>
    </table>
    <div class="right" style="margin-top:8px">
      <button class="btn" id="addRowBtn">+ Add line</button>
    </div>
    <div class="right" style="margin-top:8px">
      <strong>Subtotal £<span id="subTotal">0.00</span></strong>
    </div>
  </section>

  <!-- Signature -->
  <section style="margin-top:20px">
    <h3>Client Signature</h3>
    <div class="toolrow">
      <label>Pen size <input id="penSize" type="range" min="1" max="10" value="3"></label>
      <label>Colour <input id="penColor" type="color" value="#000000"></label>
      <button id="undoBtn" class="btn">Undo</button>
      <button id="clearBtn" class="btn">Clear</button>
      <button id="saveSigBtn" class="btn">Download PNG</button>
    </div>
    <div class="sig-wrap"><canvas id="sigCanvas"></canvas></div>
    <input type="hidden" id="signatureData">
  </section>

  <div class="right" style="margin-top:16px">
    <button class="btn primary" onclick="window.print()">Print / Save PDF</button>
  </div>

  <p class="footer-note">© MXCTECH. Works on desktop and mobile with local autosave.</p>
</div>

<script>
/* Simple contract setup */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const fmt = n => (isNaN(n)?0:n).toLocaleString('en-GB',{minimumFractionDigits:2});
$('#contractNo').textContent = 'MXC-' + Date.now();
$('#todayStr').textContent = new Date().toLocaleDateString('en-GB');

const bodyEl = $('#itemBody');
function addRow(desc='',qty=1,unit=0,line=0){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class="desc" value="${desc}"></td>
  <td><input class="qty" type="number" value="${qty}"></td>
  <td><input class="unit" type="number" value="${unit}"></td>
  <td><input class="line" type="number" value="${line}"></td>
  <td><button class="btn" data-del>✕</button></td>`;
  bodyEl.appendChild(tr);
  tr.addEventListener('input',calc);
  tr.querySelector('[data-del]').onclick=()=>{tr.remove();calc();}
  calc();
}
$('#addRowBtn').onclick=()=>addRow();
function calc(){
  let sum=0;
  $$('#itemBody tr').forEach(tr=>{
    const q=+tr.querySelector('.qty').value||0;
    const u=+tr.querySelector('.unit').value||0;
    const l=tr.querySelector('.line');
    l.value=q*u||l.value;
    sum+=+l.value||0;
  });
  $('#subTotal').textContent=fmt(sum);
}

/* --- Signature Pad --- */
const canvas=document.getElementById('sigCanvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});
const penSize=$('#penSize'), penColor=$('#penColor');
let strokes=[],current=null,drawing=false;

canvas.style.touchAction='none';
canvas.style.cursor='crosshair';
function dpr(){return Math.max(window.devicePixelRatio||1,1);}
function resizeCanvas(){
  const r=canvas.getBoundingClientRect(),ratio=dpr();
  canvas.width=Math.round(r.width*ratio);canvas.height=Math.round(r.height*ratio);
  ctx.setTransform(ratio,0,0,ratio,0,0);
  redraw();
}
function redraw(){
  ctx.save();ctx.setTransform(1,0,0,1,0,0);
  ctx.fillStyle='#fff';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.restore();
  for(const s of strokes){
    ctx.lineJoin='round';ctx.lineCap='round';ctx.lineWidth=s.size;ctx.strokeStyle=s.color;
    ctx.beginPath();s.pts.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));ctx.stroke();
  }
  $('#signatureData').value=canvas.toDataURL('image/png');
}
function getPos(e){const r=canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top};}
function start(e){e.preventDefault();drawing=true;current={pts:[],size:+penSize.value,color:penColor.value};current.pts.push(getPos(e));strokes.push(current);redraw();}
function move(e){if(!drawing)return;current.pts.push(getPos(e));redraw();}
function end(){drawing=false;}
canvas.addEventListener('pointerdown',start);
canvas.addEventListener('pointermove',move);
['pointerup','pointercancel','pointerleave'].forEach(ev=>canvas.addEventListener(ev,end));
$('#undoBtn').onclick=()=>{strokes.pop();redraw();};
$('#clearBtn').onclick=()=>{strokes=[];redraw();};
$('#saveSigBtn').onclick=()=>{const a=document.createElement('a');a.href=canvas.toDataURL('image/png');a.download='signature.png';a.click();};
window.addEventListener('resize',resizeCanvas);
resizeCanvas();
</script>
</body>
</html>
