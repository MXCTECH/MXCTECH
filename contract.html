<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MXCTECH — Contract</title>

  <style>
    body {
      background: #0b0e13;
      color: #eef3ff;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      background: #11161f;
      color: #f5b000;
      text-align: center;
      padding: 20px;
      font-size: 22px;
      font-weight: bold;
      border-bottom: 1px solid #233247;
    }
    main { padding: 20px; max-width: 900px; margin: auto; }
    h2 { color: #f5b000; }
    label { display:block; margin-top:10px; font-size:13px; color:#9aa4bd; }
    input, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #233247;
      background: #0f141c;
      color: #eef3ff;
      margin-top:4px;
    }
    .btn {
      background: linear-gradient(180deg,#1f6bff,#1754c4);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:10px 18px;
      margin-top:15px;
      font-weight:bold;
      cursor:pointer;
    }
    .sig {
      background: #0e141d;
      border: 1px dashed #233247;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
    }
    canvas { width:100%; height:200px; background:#0b0f16; border-radius:8px; }
    footer {
      text-align:center;
      color:#888;
      margin-top:40px;
      font-size:12px;
    }
  </style>

  <script src="https://unpkg.com/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <header>MXCTECH INSULATION — Contract Form</header>

  <main>
    <label>Client Name</label>
    <input id="custName" placeholder="John Smith">
    <label>Client Phone (WhatsApp)</label>
    <input id="custPhone" placeholder="+44 7...">
    <label>Email</label>
    <input id="custEmail" placeholder="client@email.com">
    <label>Address</label>
    <input id="addr1" placeholder="123 Example St">
    <label>Postcode</label>
    <input id="postcode" placeholder="AB12 3CD">
    <label>Appointment Date</label>
    <input type="datetime-local" id="apptDate">
    <label>Representative</label>
    <input id="repName" placeholder="Rep Name">
    <label>Job Type</label>
    <input id="jobType" placeholder="Loft Insulation">
    <label>Notes</label>
    <textarea id="notes" placeholder="Enter job notes..."></textarea>
    <label>Total (£)</label>
    <input id="total" placeholder="2150.00">
    <label>Deposit (£)</label>
    <input id="deposit" placeholder="1000.00">

    <button class="btn" id="sendWA">Send via WhatsApp</button>
    <button class="btn" id="savePdf">Download PDF</button>

    <div class="sig">
      <canvas id="sigPad"></canvas>
      <button class="btn" id="clearSig">Clear Signature</button>
    </div>

    <h2>Terms & Conditions</h2>
    <p style="font-size:13px;line-height:1.5;">
      Deposit is required to secure booking. Balance due on completion. Dates may change due to supply or weather.
      Client agrees to provide access and clear work area. 12-month workmanship warranty. Manufacturer warranties
      apply to materials. Changes after acceptance may affect cost and timing. By signing, the client agrees to
      the terms, scope and total stated.
    </p>
  </main>

  <footer>© <span id="year"></span> MXCTECH INSULATION</footer>

  <script>
    const $ = id => document.getElementById(id);
    $('#year').textContent = new Date().getFullYear();

    // --- Signature Pad ---
    const canvas = $('#sigPad');
    const sigPad = new SignaturePad(canvas, {
      minWidth: 0.8,
      maxWidth: 2.2,
      penColor: 'rgba(255,255,255,0.95)'
    });
    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      canvas.getContext("2d").scale(ratio, ratio);
      sigPad.clear();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    $('#clearSig').onclick = () => sigPad.clear();

    // --- WhatsApp Send (Fixed to point to MXCTECH GitHub Pages path) ---
    $('#sendWA').onclick = () => {
      let phone = $('#custPhone').value.replace(/\D+/g, '');
      if (phone.startsWith('0')) phone = '44' + phone.slice(1);
      if (!phone.startsWith('44')) phone = '44' + phone;

      const name = $('#custName').value;
      const total = $('#total').value;
      const deposit = $('#deposit').value;

      // Hard-coded full link to avoid 404
      const CONTRACT_URL = 'https://mxctech.github.io/MXCTECH/contract.html';
      const link = `${CONTRACT_URL}?custName=${encodeURIComponent(name)}&custPhone=${encodeURIComponent(phone)}`;

      const msg = encodeURIComponent(
        `Hi ${name}, it’s our team from MXCTECH INSULATION.\nHere’s your contract link:\n${link}\n\nQuote total: £${total}\nDeposit: £${deposit}`
      );

      window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
    };

    // --- Save PDF ---
    $('#savePdf').onclick = async () => {
      if (sigPad.isEmpty() && !confirm("Signature is empty, continue?")) return;
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.text("MXCTECH INSULATION — Contract", 10, 10);
      pdf.text(`Client: ${$('#custName').value}`, 10, 20);
      pdf.text(`Phone: ${$('#custPhone').value}`, 10, 30);
      pdf.text(`Address: ${$('#addr1').value}`, 10, 40);
      pdf.text(`Total: £${$('#total').value}`, 10, 50);
      pdf.text(`Deposit: £${$('#deposit').value}`, 10, 60);
      if (!sigPad.isEmpty()) {
        pdf.addImage(sigPad.toDataURL(), 'PNG', 10, 70, 80, 40);
      }
      pdf.save('MXCTECH_Contract.pdf');
    };
  </script>
</body>
</html>
